define("domReady",[],function(){function e(e){for(var t=0,n;n=e[t];t++)n(o)}function t(){var t=u,n=a;s&&(t.length&&(u=[],e(t)),f.resourcesDone&&n.length&&(a=[],e(n)))}function n(){s||(s=!0,c&&clearInterval(c),t())}function r(e){return s?e(o):u.push(e),r}var i=typeof window!="undefined"&&window.document,s=!i,o=i?document:null,u=[],a=[],f=requirejs||require||{},l=f.resourcesReady,c;return"resourcesReady"in f&&(f.resourcesReady=function(e){l&&l(e),e&&t()}),i&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):window.attachEvent&&(window.attachEvent("onload",n),self===self.top&&(c=setInterval(function(){try{document.body&&(document.documentElement.doScroll("left"),n())}catch(e){}},30))),document.readyState==="complete"&&n()),r.withResources=function(e){return s&&f.resourcesDone?e(o):a.push(e),r},r.version="1.0.0",r.load=function(e,t,n,i){i.isBuild?n(null):r(n)},r}),function(e,t){function n(e){return H.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function r(e){if(!vn[e]){var t=_.body,n=H("<"+e+">").appendTo(t),r=n.css("display");n.remove();if(r==="none"||r===""){mn||(mn=_.createElement("iframe"),mn.frameBorder=mn.width=mn.height=0),t.appendChild(mn);if(!gn||!mn.createElement)gn=(mn.contentWindow||mn.contentDocument).document,gn.write((H.support.boxModel?"<!doctype html>":"")+"<html><body>"),gn.close();n=gn.createElement(e),gn.body.appendChild(n),r=H.css(n,"display"),t.removeChild(mn)}vn[e]=r}return vn[e]}function i(e,t){var n={};return H.each(En.concat.apply([],En.slice(0,t)),function(){n[this]=e}),n}function s(){Sn=t}function o(){return setTimeout(s,0),Sn=H.now()}function u(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function a(){try{return new e.XMLHttpRequest}catch(t){}}function f(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},s,o,u=r.length,a,f=r[0],l,c,h,p,d;for(s=1;s<u;s++){if(s===1)for(o in e.converters)typeof o=="string"&&(i[o.toLowerCase()]=e.converters[o]);l=f,f=r[s];if(f==="*")f=l;else if(l!=="*"&&l!==f){c=l+" "+f,h=i[c]||i["* "+f];if(!h){d=t;for(p in i){a=p.split(" ");if(a[0]===l||a[0]==="*"){d=i[a[1]+" "+f];if(d){p=i[p],p===!0?h=d:d===!0&&(h=p);break}}}}!h&&!d&&H.error("No conversion from "+c.replace(" "," to ")),h!==!0&&(n=h?h(n):d(p(n)))}}return n}function l(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o)a in r&&(n[o[a]]=r[a]);while(s[0]==="*")s.shift(),u===t&&(u=e.mimeType||n.getResponseHeader("content-type"));if(u)for(a in i)if(i[a]&&i[a].test(u)){s.unshift(a);break}if(s[0]in r)f=s[0];else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f)return f!==s[0]&&s.unshift(f),r[f]}function c(e,t,n,r){if(H.isArray(t))H.each(t,function(t,i){n||Ut.test(e)?r(e,i):c(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&H.type(t)==="object")for(var i in t)c(e+"["+i+"]",t[i],n,r);else r(e,t)}function h(e,n){var r,i,s=H.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&H.extend(!0,e,i)}function p(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u=e[s],a=0,f=u?u.length:0,l=e===rn,c;for(;a<f&&(l||!c);a++)c=u[a](n,r,i),typeof c=="string"&&(!l||o[c]?c=t:(n.dataTypes.unshift(c),c=p(e,n,r,i,c,o)));return(l||!c)&&!o["*"]&&(c=p(e,n,r,i,"*",o)),c}function d(e){return function(t,n){typeof t!="string"&&(n=t,t="*");if(H.isFunction(n)){var r=t.toLowerCase().split(Zt),i=0,s=r.length,o,u,a;for(;i<s;i++)o=r[i],a=/^\+/.test(o),a&&(o=o.substr(1)||"*"),u=e[o]=e[o]||[],u[a?"unshift":"push"](n)}}}function v(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?1:0,s=4;if(r>0){if(n!=="border")for(;i<s;i+=2)n||(r-=parseFloat(H.css(e,"padding"+jt[i]))||0),n==="margin"?r+=parseFloat(H.css(e,n+jt[i]))||0:r-=parseFloat(H.css(e,"border"+jt[i]+"Width"))||0;return r+"px"}r=Ft(e,t);if(r<0||r==null)r=e.style[t];if(Dt.test(r))return r;r=parseFloat(r)||0;if(n)for(;i<s;i+=2)r+=parseFloat(H.css(e,"padding"+jt[i]))||0,n!=="padding"&&(r+=parseFloat(H.css(e,"border"+jt[i]+"Width"))||0),n==="margin"&&(r+=parseFloat(H.css(e,n+jt[i]))||0);return r+"px"}function m(e){var t=_.createElement("div");return Lt.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function g(e){var t=(e.nodeName||"").toLowerCase();t==="input"?y(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&H.grep(e.getElementsByTagName("input"),y)}function y(e){if(e.type==="checkbox"||e.type==="radio")e.defaultChecked=e.checked}function b(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function w(e,t){var n;t.nodeType===1&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?t.outerHTML=e.outerHTML:n!=="input"||e.type!=="checkbox"&&e.type!=="radio"?n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text):(e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)),t.removeAttribute(H.expando),t.removeAttribute("_submit_attached"),t.removeAttribute("_change_attached"))}function E(e,t){if(t.nodeType===1&&!!H.hasData(e)){var n,r,i,s=H._data(e),o=H._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)H.event.add(t,n,u[n][r])}o.data&&(o.data=H.extend({},o.data))}}function S(e,t){return H.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function x(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function T(e,t,n){t=t||0;if(H.isFunction(t))return H.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return H.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=H.grep(e,function(e){return e.nodeType===1});if(lt.test(t))return H.filter(t,r,!n);t=H.filter(t,r)}return H.grep(e,function(e,r){return H.inArray(e,t)>=0===n})}function N(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function C(){return!0}function k(){return!1}function L(e,t,n){var r=t+"defer",i=t+"queue",s=t+"mark",o=H._data(e,r);o&&(n==="queue"||!H._data(e,i))&&(n==="mark"||!H._data(e,s))&&setTimeout(function(){!H._data(e,i)&&!H._data(e,s)&&(H.removeData(e,r,!0),o.fire())},0)}function A(e){for(var t in e){if(t==="data"&&H.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function O(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(I,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:H.isNumeric(r)?+r:F.test(r)?H.parseJSON(r):r}catch(s){}H.data(e,n,r)}else r=t}return r}function M(e){var t=B[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}var _=e.document,D=e.navigator,P=e.location,H=function(){function n(){if(!r.isReady){try{_.documentElement.doScroll("left")}catch(e){setTimeout(n,1);return}r.ready()}}var r=function(e,t){return new r.fn.init(e,t,o)},i=e.jQuery,s=e.$,o,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,a=/\S/,f=/^\s+/,l=/\s+$/,c=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,h=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,v=/(?:^|:|,)(?:\s*\[)+/g,m=/(webkit)[ \/]([\w.]+)/,g=/(opera)(?:.*version)?[ \/]([\w.]+)/,y=/(msie) ([\w.]+)/,b=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z]|[0-9])/ig,E=/^-ms-/,S=function(e,t){return(t+"").toUpperCase()},x=D.userAgent,T,N,C,k=Object.prototype.toString,L=Object.prototype.hasOwnProperty,A=Array.prototype.push,O=Array.prototype.slice,M=String.prototype.trim,P=Array.prototype.indexOf,H={};return r.fn=r.prototype={constructor:r,init:function(e,n,i){var s,o,a,f;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!n&&_.body)return this.context=_,this[0]=_.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)!=="<"||e.charAt(e.length-1)!==">"||e.length<3?s=u.exec(e):s=[null,e,null];if(s&&(s[1]||!n)){if(s[1])return n=n instanceof r?n[0]:n,f=n?n.ownerDocument||n:_,a=c.exec(e),a?r.isPlainObject(n)?(e=[_.createElement(a[1])],r.fn.attr.call(e,n,!0)):e=[f.createElement(a[1])]:(a=r.buildFragment([s[1]],[f]),e=(a.cacheable?r.clone(a.fragment):a.fragment).childNodes),r.merge(this,e);o=_.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return i.find(e);this.length=1,this[0]=o}return this.context=_,this.selector=e,this}return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e)}return r.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),r.makeArray(e,this))},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return O.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var i=this.constructor();return r.isArray(e)?A.apply(i,e):r.merge(i,e),i.prevObject=this,i.context=this.context,t==="find"?i.selector=this.selector+(this.selector?" ":"")+n:t&&(i.selector=this.selector+"."+t+"("+n+")"),i},each:function(e,t){return r.each(this,e,t)},ready:function(e){return r.bindReady(),N.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(O.apply(this,arguments),"slice",O.call(arguments).join(","))},map:function(e){return this.pushStack(r.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:A,sort:[].sort,splice:[].splice},r.fn.init.prototype=r.fn,r.extend=r.fn.extend=function(){var e,n,i,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!r.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){i=a[n],s=e[n];if(a===s)continue;c&&s&&(r.isPlainObject(s)||(o=r.isArray(s)))?(o?(o=!1,u=i&&r.isArray(i)?i:[]):u=i&&r.isPlainObject(i)?i:{},a[n]=r.extend(c,u,s)):s!==t&&(a[n]=s)}return a},r.extend({noConflict:function(t){return e.$===r&&(e.$=s),t&&e.jQuery===r&&(e.jQuery=i),r},isReady:!1,readyWait:1,holdReady:function(e){e?r.readyWait++:r.ready(!0)},ready:function(e){if(e===!0&&!--r.readyWait||e!==!0&&!r.isReady){if(!_.body)return setTimeout(r.ready,1);r.isReady=!0;if(e!==!0&&--r.readyWait>0)return;N.fireWith(_,[r]),r.fn.trigger&&r(_).trigger("ready").off("ready")}},bindReady:function(){if(!N){N=r.Callbacks("once memory");if(_.readyState==="complete")return setTimeout(r.ready,1);if(_.addEventListener)_.addEventListener("DOMContentLoaded",C,!1),e.addEventListener("load",r.ready,!1);else if(_.attachEvent){_.attachEvent("onreadystatechange",C),e.attachEvent("onload",r.ready);var t=!1;try{t=e.frameElement==null}catch(i){}_.documentElement.doScroll&&t&&n()}}},isFunction:function(e){return r.type(e)==="function"},isArray:Array.isArray||function(e){return r.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):H[k.call(e)]||"object"},isPlainObject:function(e){if(!e||r.type(e)!=="object"||e.nodeType||r.isWindow(e))return!1;try{if(e.constructor&&!L.call(e,"constructor")&&!L.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in e);return i===t||L.call(e,i)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=r.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(h.test(t.replace(p,"@").replace(d,"]").replace(v,"")))return(new Function("return "+t))();r.error("Invalid JSON: "+t)},parseXML:function(n){if(typeof n!="string"||!n)return null;var i,s;try{e.DOMParser?(s=new DOMParser,i=s.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(o){i=t}return(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)&&r.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&a.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(E,"ms-").replace(w,S)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,i){var s,o=0,u=e.length,a=u===t||r.isFunction(e);if(i){if(a){for(s in e)if(n.apply(e[s],i)===!1)break}else for(;o<u;)if(n.apply(e[o++],i)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:M?function(e){return e==null?"":M.call(e)}:function(e){return e==null?"":(e+"").replace(f,"").replace(l,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var i=r.type(e);e.length==null||i==="string"||i==="function"||i==="regexp"||r.isWindow(e)?A.call(n,e):r.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(P)return P.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,i){var s,o,u=[],a=0,f=e.length,l=e instanceof r||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||r.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,i),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,i),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var i=e[n];n=e,e=i}if(!r.isFunction(e))return t;var s=O.call(arguments,2),o=function(){return e.apply(n,s.concat(O.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||r.guid++,o},access:function(e,n,i,s,o,u,a){var f,l=i==null,c=0,h=e.length;if(i&&typeof i=="object"){for(c in i)r.access(e,n,c,i[c],1,u,s);o=1}else if(s!==t){f=a===t&&r.isFunction(s),l&&(f?(f=n,n=function(e,t,n){return f.call(r(e),n)}):(n.call(e,s),n=null));if(n)for(;c<h;c++)n(e[c],i,f?s.call(e[c],c,n(e[c],i)):s,a);o=1}return o?e:l?n.call(e):h?n(e[0],i):u},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=m.exec(e)||g.exec(e)||y.exec(e)||e.indexOf("compatible")<0&&b.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}r.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(n,i){return i&&i instanceof r&&!(i instanceof e)&&(i=e(i)),r.fn.init.call(this,n,i,t)},e.fn.init.prototype=e.fn;var t=e(_);return e},browser:{}}),r.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){H["[object "+t+"]"]=t.toLowerCase()}),T=r.uaMatch(x),T.browser&&(r.browser[T.browser]=!0,r.browser.version=T.version),r.browser.webkit&&(r.browser.safari=!0),a.test("Â ")&&(f=/^[\s\xA0]+/,l=/[\s\xA0]+$/),o=r(_),_.addEventListener?C=function(){_.removeEventListener("DOMContentLoaded",C,!1),r.ready()}:_.attachEvent&&(C=function(){_.readyState==="complete"&&(_.detachEvent("onreadystatechange",C),r.ready())}),r}(),B={};H.Callbacks=function(e){e=e?B[e]||M(e):{};var n=[],r=[],i,s,o,u,a,f,l=function(t){var r,i,s,o,u;for(r=0,i=t.length;r<i;r++)s=t[r],o=H.type(s),o==="array"?l(s):o==="function"&&(!e.unique||!h.has(s))&&n.push(s)},c=function(t,l){l=l||[],i=!e.memory||[t,l],s=!0,o=!0,f=u||0,u=0,a=n.length;for(;n&&f<a;f++)if(n[f].apply(t,l)===!1&&e.stopOnFalse){i=!0;break}o=!1,n&&(e.once?i===!0?h.disable():n=[]:r&&r.length&&(i=r.shift(),h.fireWith(i[0],i[1])))},h={add:function(){if(n){var e=n.length;l(arguments),o?a=n.length:i&&i!==!0&&(u=e,c(i[0],i[1]))}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++)for(var s=0;s<n.length;s++)if(t[r]===n[s]){o&&s<=a&&(a--,s<=f&&f--),n.splice(s--,1);if(e.unique)break}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++)if(e===n[t])return!0}return!1},empty:function(){return n=[],this},disable:function(){return n=r=i=t,this},disabled:function(){return!n},lock:function(){return r=t,(!i||i===!0)&&h.disable(),this},locked:function(){return!r},fireWith:function(t,n){return r&&(o?e.once||r.push([t,n]):(!e.once||!i)&&c(t,n)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!s}};return h};var j=[].slice;H.extend({Deferred:function(e){var t=H.Callbacks("once memory"),n=H.Callbacks("once memory"),r=H.Callbacks("memory"),i="pending",s={resolve:t,reject:n,notify:r},o={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return u.done(e).fail(t).progress(n),this},always:function(){return u.done.apply(u,arguments).fail.apply(u,arguments),this},pipe:function(e,t,n){return H.Deferred(function(r){H.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],s;H.isFunction(n)?u[e](function(){s=n.apply(this,arguments),s&&H.isFunction(s.promise)?s.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===u?r:this,[s])}):u[e](r[i])})}).promise()},promise:function(e){if(e==null)e=o;else for(var t in o)e[t]=o[t];return e}},u=o.promise({}),a;for(a in s)u[a]=s[a].fire,u[a+"With"]=s[a].fireWith;return u.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(u,u),u},when:function(e){function t(e){return function(t){o[e]=arguments.length>1?j.call(arguments,0):t,f.notifyWith(l,o)}}function n(e){return function(t){r[e]=arguments.length>1?j.call(arguments,0):t,--u||f.resolveWith(f,r)}}var r=j.call(arguments,0),i=0,s=r.length,o=Array(s),u=s,a=s,f=s<=1&&e&&H.isFunction(e.promise)?e:H.Deferred(),l=f.promise();if(s>1){for(;i<s;i++)r[i]&&r[i].promise&&H.isFunction(r[i].promise)?r[i].promise().then(n(i),f.reject,t(i)):--u;u||f.resolveWith(f,r)}else f!==e&&f.resolveWith(f,s?[e]:[]);return l}}),H.support=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p=_.createElement("div"),d=_.documentElement;p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!n.length||!r)return{};i=_.createElement("select"),s=i.appendChild(_.createElement("option")),o=p.getElementsByTagName("input")[0],t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.55/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:o.value==="on",optSelected:s.selected,getSetAttribute:p.className!=="t",enctype:!!_.createElement("form").enctype,html5Clone:_.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},H.boxModel=t.boxModel=_.compatMode==="CSS1Compat",o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,i.disabled=!0,t.optDisabled=!s.disabled;try{delete p.test}catch(v){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),o=_.createElement("input"),o.value="t",o.setAttribute("type","radio"),t.radioValue=o.value==="t",o.setAttribute("checked","checked"),o.setAttribute("name","t"),p.appendChild(o),u=_.createDocumentFragment(),u.appendChild(p.lastChild),t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=o.checked,u.removeChild(o),u.appendChild(p);if(p.attachEvent)for(c in{submit:1,change:1,focusin:1})l="on"+c,h=l in p,h||(p.setAttribute(l,"return;"),h=typeof p[l]=="function"),t[c+"Bubbles"]=h;return u.removeChild(p),u=i=s=p=o=null,H(function(){var n,r,i,s,o,u,f,l,c,d,v,m,g,y=_.getElementsByTagName("body")[0];!y||(l=1,g="padding:0;margin:0;border:",v="position:absolute;top:0;left:0;width:1px;height:1px;",m=g+"0;visibility:hidden;",c="style='"+v+g+"5px solid #000;",d="<div "+c+"display:block;'><div style='"+g+"0;display:block;overflow:hidden;'></div></div>"+"<table "+c+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",n=_.createElement("div"),n.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+l+"px",y.insertBefore(n,y.firstChild),p=_.createElement("div"),n.appendChild(p),p.innerHTML="<table><tr><td style='"+g+"0;display:none'></td><td>t</td></tr></table>",a=p.getElementsByTagName("td"),h=a[0].offsetHeight===0,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=h&&a[0].offsetHeight===0,e.getComputedStyle&&(p.innerHTML="",f=_.createElement("div"),f.style.width="0",f.style.marginRight="0",p.style.width="2px",p.appendChild(f),t.reliableMarginRight=(parseInt((e.getComputedStyle(f,null)||{marginRight:0}).marginRight,10)||0)===0),typeof p.style.zoom!="undefined"&&(p.innerHTML="",p.style.width=p.style.padding="1px",p.style.border=0,p.style.overflow="hidden",p.style.display="inline",p.style.zoom=1,t.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.style.overflow="visible",p.innerHTML="<div style='width:5px;'></div>",t.shrinkWrapBlocks=p.offsetWidth!==3),p.style.cssText=v+m,p.innerHTML=d,r=p.firstChild,i=r.firstChild,o=r.nextSibling.firstChild.firstChild,u={doesNotAddBorder:i.offsetTop!==5,doesAddBorderForTableAndCells:o.offsetTop===5},i.style.position="fixed",i.style.top="20px",u.fixedPosition=i.offsetTop===20||i.offsetTop===15,i.style.position=i.style.top="",r.style.overflow="hidden",r.style.position="relative",u.subtractsBorderForOverflowNotVisible=i.offsetTop===-5,u.doesNotIncludeMarginInBodyOffset=y.offsetTop!==l,e.getComputedStyle&&(p.style.marginTop="1%",t.pixelMargin=(e.getComputedStyle(p,null)||{marginTop:0}).marginTop!=="1%"),typeof n.style.zoom!="undefined"&&(n.style.zoom=1),y.removeChild(n),f=p=n=null,H.extend(t,u))}),t}();var F=/^(?:\{.*\}|\[.*\])$/,I=/([A-Z])/g;H.extend({cache:{},uuid:0,expando:"jQuery"+(H.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?H.cache[e[H.expando]]:e[H.expando],!!e&&!A(e)},data:function(e,n,r,i){if(!!H.acceptData(e)){var s,o,u,a=H.expando,f=typeof n=="string",l=e.nodeType,c=l?H.cache:e,h=l?e[a]:e[a]&&a,p=n==="events";if((!h||!c[h]||!p&&!i&&!c[h].data)&&f&&r===t)return;h||(l?e[a]=h=++H.uuid:h=a),c[h]||(c[h]={},l||(c[h].toJSON=H.noop));if(typeof n=="object"||typeof n=="function")i?c[h]=H.extend(c[h],n):c[h].data=H.extend(c[h].data,n);return s=o=c[h],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[H.camelCase(n)]=r),p&&!o[n]?s.events:(f?(u=o[n],u==null&&(u=o[H.camelCase(n)])):u=o,u)}},removeData:function(e,t,n){if(!!H.acceptData(e)){var r,i,s,o=H.expando,u=e.nodeType,a=u?H.cache:e,f=u?e[o]:o;if(!a[f])return;if(t){r=n?a[f]:a[f].data;if(r){H.isArray(t)||(t in r?t=[t]:(t=H.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?A:H.isEmptyObject)(r))return}}if(!n){delete a[f].data;if(!A(a[f]))return}H.support.deleteExpando||!a.setInterval?delete a[f]:a[f]=null,u&&(H.support.deleteExpando?delete e[o]:e.removeAttribute?e.removeAttribute(o):e[o]=null)}},_data:function(e,t,n){return H.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=H.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),H.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=H.data(a);if(a.nodeType===1&&!H._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")===0&&(o=H.camelCase(o.substring(5)),O(a,o,l[o]));H._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){H.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",H.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=H.data(a,e),l=O(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=H(this);t.triggerHandler("setData"+i,r),H.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){H.removeData(this,e)})}}),H.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",H._data(e,t,(H._data(e,t)||0)+1))},_unmark:function(e,t,n){e!==!0&&(n=t,t=e,e=!1);if(t){n=n||"fx";var r=n+"mark",i=e?0:(H._data(t,r)||1)-1;i?H._data(t,r,i):(H.removeData(t,r,!0),L(t,n,"mark"))}},queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=H._data(e,t),n&&(!r||H.isArray(n)?r=H._data(e,t,H.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=H.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift()),r&&(t==="fx"&&n.unshift("inprogress"),H._data(e,t+".run",i),r.call(e,function(){H.dequeue(e,t)},i)),n.length||(H.removeData(e,t+"queue "+t+".run",!0),L(e,t,"queue"))}}),H.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?H.queue(this[0],e):n===t?this:this.each(function(){var t=H.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&H.dequeue(this,e)})},dequeue:function(e){return this.each(function(){H.dequeue(this,e)})},delay:function(e,t){return e=H.fx?H.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function r(){--u||i.resolveWith(s,[s])}typeof e!="string"&&(n=e,e=t),e=e||"fx";var i=H.Deferred(),s=this,o=s.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--)if(c=H.data(s[o],a,t,!0)||(H.data(s[o],f,t,!0)||H.data(s[o],l,t,!0))&&H.data(s[o],a,H.Callbacks("once memory"),!0))u++,c.add(r);return r(),i.promise(n)}});var q=/[\n\t\r]/g,R=/\s+/,U=/\r/g,z=/^(?:button|input)$/i,W=/^(?:button|input|object|select|textarea)$/i,X=/^a(?:rea)?$/i,V=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,$=H.support.getSetAttribute,J,K,Q;H.fn.extend({attr:function(e,t){return H.access(this,H.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){H.removeAttr(this,e)})},prop:function(e,t){return H.access(this,H.prop,e,t,arguments.length>1)},removeProp:function(e){return e=H.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(H.isFunction(e))return this.each(function(t){H(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(R);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)~s.indexOf(" "+t[o]+" ")||(s+=t[o]+" ");i.className=H.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(H.isFunction(e))return this.each(function(t){H(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(R);for(r=0,i=this.length;r<i;r++){s=this[r];if(s.nodeType===1&&s.className)if(e){o=(" "+s.className+" ").replace(q," ");for(u=0,a=n.length;u<a;u++)o=o.replace(" "+n[u]+" "," ");s.className=H.trim(o)}else s.className=""}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return H.isFunction(e)?this.each(function(n){H(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=H(this),u=t,a=e.split(R);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&H._data(this,"__className__",this.className),this.className=this.className||e===!1?"":H._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!!arguments.length)return i=H.isFunction(e),this.each(function(r){var s=H(this),o;if(this.nodeType===1){i?o=e.call(this,r,s.val()):o=e,o==null?o="":typeof o=="number"?o+="":H.isArray(o)&&(o=H.map(o,function(e){return e==null?"":e+""})),n=H.valHooks[this.type]||H.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,o,"value")===t)this.value=o}});if(s)return n=H.valHooks[s.type]||H.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(U,""):r==null?"":r)}}),H.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,s=e.selectedIndex,o=[],u=e.options,a=e.type==="select-one";if(s<0)return null;n=a?s:0,r=a?s+1:u.length;for(;n<r;n++){i=u[n];if(i.selected&&(H.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!H.nodeName(i.parentNode,"optgroup"))){t=H(i).val();if(a)return t;o.push(t)}}return a&&!o.length&&u.length?H(u[s]).val():o},set:function(e,t){var n=H.makeArray(t);return H(e).find("option").each(function(){this.selected=H.inArray(H(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!!e&&a!==3&&a!==8&&a!==2){if(i&&n in H.attrFn)return H(e)[n](r);if(typeof e.getAttribute=="undefined")return H.prop(e,n,r);u=a!==1||!H.isXMLDoc(e),u&&(n=n.toLowerCase(),o=H.attrHooks[n]||(V.test(n)?K:J));if(r!==t){if(r===null){H.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,""+r),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)}},removeAttr:function(e,t){var n,r,i,s,o,u=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(R),s=r.length;for(;u<s;u++)i=r[u],i&&(n=H.propFix[i]||i,o=V.test(i),o||H.attr(e,i,""),e.removeAttribute($?i:n),o&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(z.test(e.nodeName)&&e.parentNode)H.error("type property can't be changed");else if(!H.support.radioValue&&t==="radio"&&H.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return J&&H.nodeName(e,"button")?J.get(e,t):t in e?e.value:null},set:function(e,t,n){if(J&&H.nodeName(e,"button"))return J.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!!e&&u!==3&&u!==8&&u!==2)return o=u!==1||!H.isXMLDoc(e),o&&(n=H.propFix[n]||n,s=H.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):W.test(e.nodeName)||X.test(e.nodeName)&&e.href?0:t}}}}),H.attrHooks.tabindex=H.propHooks.tabIndex,K={get:function(e,n){var r,i=H.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?H.removeAttr(e,n):(r=H.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},$||(Q={name:!0,id:!0,coords:!0},J=H.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(Q[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=_.createAttribute(n),e.setAttributeNode(r)),r.nodeValue=t+""}},H.attrHooks.tabindex.set=J.set,H.each(["width","height"],function(e,t){H.attrHooks[t]=H.extend(H.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),H.attrHooks.contenteditable={get:J.get,set:function(e,t,n){t===""&&(t="false"),J.set(e,t,n)}}),H.support.hrefNormalized||H.each(["href","src","width","height"],function(e,n){H.attrHooks[n]=H.extend(H.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),H.support.style||(H.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),H.support.optSelected||(H.propHooks.selected=H.extend(H.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),H.support.enctype||(H.propFix.enctype="encoding"),H.support.checkOn||H.each(["radio","checkbox"],function(){H.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),H.each(["radio","checkbox"],function(){H.valHooks[this]=H.extend(H.valHooks[this],{set:function(e,t){if(H.isArray(t))return e.checked=H.inArray(H(e).val(),t)>=0}})});var G=/^(?:textarea|input|select)$/i,Y=/^([^\.]*)?(?:\.(.+))?$/,Z=/(?:^|\s)hover(\.\S+)?\b/,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,it=function(e){var t=rt.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},st=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},ot=function(e){return H.event.special.hover?e:e.replace(Z,"mouseenter$1 mouseleave$1")};H.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g;if(!(e.nodeType===3||e.nodeType===8||!n||!r||!(o=H._data(e)))){r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=H.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof H=="undefined"||!!e&&H.event.triggered===e.type?t:H.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=H.trim(ot(n)).split(" ");for(f=0;f<n.length;f++){l=Y.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=H.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=H.event.special[c]||{},p=H.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,quick:s&&it(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),H.event.global[c]=!0}e=null}},global:{},remove:function(e,t,n,r,i){var s=H.hasData(e)&&H._data(e),o,u,a,f,l,c,h,p,d,v,m,g;if(!!s&&!!(p=s.events)){t=H.trim(ot(t||"")).split(" ");for(o=0;o<t.length;o++){u=Y.exec(t[o])||[],a=f=u[1],l=u[2];if(!a){for(a in p)H.event.remove(e,a+t[o],n,r,!0);continue}d=H.event.special[a]||{},a=(r?d.delegateType:d.bindType)||a,m=p[a]||[],c=m.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(h=0;h<m.length;h++)g=m[h],(i||f===g.origType)&&(!n||n.guid===g.guid)&&(!l||l.test(g.namespace))&&(!r||r===g.selector||r==="**"&&g.selector)&&(m.splice(h--,1),g.selector&&m.delegateCount--,d.remove&&d.remove.call(e,g));m.length===0&&c!==m.length&&((!d.teardown||d.teardown.call(e,l)===!1)&&H.removeEvent(e,a,s.handle),delete p[a])}H.isEmptyObject(p)&&(v=s.handle,v&&(v.elem=null),H.removeData(e,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,s){if(!i||i.nodeType!==3&&i.nodeType!==8){var o=n.type||n,u=[],a,f,l,c,h,p,d,v,m,g;if(nt.test(o+H.event.triggered))return;o.indexOf("!")>=0&&(o=o.slice(0,-1),f=!0),o.indexOf(".")>=0&&(u=o.split("."),o=u.shift(),u.sort());if((!i||H.event.customEvent[o])&&!H.event.global[o])return;n=typeof n=="object"?n[H.expando]?n:new H.Event(o,n):new H.Event(o),n.type=o,n.isTrigger=!0,n.exclusive=f,n.namespace=u.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+u.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,p=o.indexOf(":")<0?"on"+o:"";if(!i){a=H.cache;for(l in a)a[l].events&&a[l].events[o]&&H.event.trigger(n,r,a[l].handle.elem,!0);return}n.result=t,n.target||(n.target=i),r=r!=null?H.makeArray(r):[],r.unshift(n),d=H.event.special[o]||{};if(d.trigger&&d.trigger.apply(i,r)===!1)return;m=[[i,d.bindType||o]];if(!s&&!d.noBubble&&!H.isWindow(i)){g=d.delegateType||o,c=nt.test(g+o)?i:i.parentNode,h=null;for(;c;c=c.parentNode)m.push([c,g]),h=c;h&&h===i.ownerDocument&&m.push([h.defaultView||h.parentWindow||e,g])}for(l=0;l<m.length&&!n.isPropagationStopped();l++)c=m[l][0],n.type=m[l][1],v=(H._data(c,"events")||{})[n.type]&&H._data(c,"handle"),v&&v.apply(c,r),v=p&&c[p],v&&H.acceptData(c)&&v.apply(c,r)===!1&&n.preventDefault();return n.type=o,!s&&!n.isDefaultPrevented()&&(!d._default||d._default.apply(i.ownerDocument,r)===!1)&&(o!=="click"||!H.nodeName(i,"a"))&&H.acceptData(i)&&p&&i[o]&&(o!=="focus"&&o!=="blur"||n.target.offsetWidth!==0)&&!H.isWindow(i)&&(h=i[p],h&&(i[p]=null),H.event.triggered=o,i[o](),H.event.triggered=t,h&&(i[p]=h)),n.result}},dispatch:function(n){n=H.event.fix(n||e.event);var r=(H._data(this,"events")||{})[n.type]||[],i=r.delegateCount,s=[].slice.call(arguments,0),o=!n.exclusive&&!n.namespace,u=H.event.special[n.type]||{},a=[],f,l,c,h,p,d,v,m,g,y,b;s[0]=n,n.delegateTarget=this;if(!u.preDispatch||u.preDispatch.call(this,n)!==!1){if(i&&(!n.button||n.type!=="click")){h=H(this),h.context=this.ownerDocument||this;for(c=n.target;c!=this;c=c.parentNode||this)if(c.disabled!==!0){d={},m=[],h[0]=c;for(f=0;f<i;f++)g=r[f],y=g.selector,d[y]===t&&(d[y]=g.quick?st(c,g.quick):h.is(y)),d[y]&&m.push(g);m.length&&a.push({elem:c,matches:m})}}r.length>i&&a.push({elem:this,matches:r.slice(i)});for(f=0;f<a.length&&!n.isPropagationStopped();f++){v=a[f],n.currentTarget=v.elem;for(l=0;l<v.matches.length&&!n.isImmediatePropagationStopped();l++){g=v.matches[l];if(o||!n.namespace&&!g.namespace||n.namespace_re&&n.namespace_re.test(g.namespace))n.data=g.data,n.handleObj=g,p=((H.event.special[g.origType]||{}).handle||g.handler).apply(v.elem,s),p!==t&&(n.result=p,p===!1&&(n.preventDefault(),n.stopPropagation()))}}return u.postDispatch&&u.postDispatch.call(this,n),n.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,s,o=n.button,u=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||_,i=r.documentElement,s=r.body,e.pageX=n.clientX+(i&&i.scrollLeft||s&&s.scrollLeft||0)-(i&&i.clientLeft||s&&s.clientLeft||0),e.pageY=n.clientY+(i&&i.scrollTop||s&&s.scrollTop||0)-(i&&i.clientTop||s&&s.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),!e.which&&o!==t&&(e.which=o&1?1:o&2?3:o&4?2:0),e}},fix:function(e){if(e[H.expando])return e;var n,r,i=e,s=H.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=H.Event(i);for(n=o.length;n;)r=o[--n],e[r]=i[r];return e.target||(e.target=i.srcElement||_),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),s.filter?s.filter(e,i):e},special:{ready:{setup:H.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){H.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=H.extend(new H.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?H.event.trigger(i,null,t):H.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},H.event.handle=H.event.dispatch,H.removeEvent=_.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},H.Event=function(e,t){if(!(this instanceof H.Event))return new H.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?C:k):this.type=e,t&&H.extend(this,t),this.timeStamp=e&&e.timeStamp||H.now(),this[H.expando]=!0},H.Event.prototype={preventDefault:function(){this.isDefaultPrevented=C;var e=this.originalEvent;!e||(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=C;var e=this.originalEvent;!e||(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=C,this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k},H.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){H.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,s=i.selector,o;if(!r||r!==n&&!H.contains(n,r))e.type=i.origType,o=i.handler.apply(this,arguments),e.type=t;return o}}}),H.support.submitBubbles||(H.event.special.submit={setup:function(){if(H.nodeName(this,"form"))return!1;H.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=H.nodeName(n,"input")||H.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(H.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),r._submit_attached=!0)})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&H.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(H.nodeName(this,"form"))return!1;H.event.remove(this,"._submit")}}),H.support.changeBubbles||(H.event.special.change={setup:function(){if(G.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")H.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),H.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,H.event.simulate("change",this,e,!0))});return!1}H.event.add(this,"beforeactivate._change",function(e){var t=e.target;G.test(t.nodeName)&&!t._change_attached&&(H.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&H.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return H.event.remove(this,"._change"),G.test(this.nodeName)}}),H.support.focusinBubbles||H.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){H.event.simulate(t,e.target,H.event.fix(e),!0)};H.event.special[t]={setup:function(){n++===0&&_.addEventListener(e,r,!0)},teardown:function(){--n===0&&_.removeEventListener(e,r,!0)}}}),H.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=k;else if(!i)return this;return s===1&&(o=i,i=function(e){return H().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=H.guid++)),this.each(function(){H.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return H(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if(typeof e=="object"){for(var s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=k),this.each(function(){H.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return H(this.context).on(e,this.selector,t,n),this},die:function(e,t){return H(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){H.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return H.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||H.guid++,r=0,i=function(n){var i=(H._data(this,"lastToggle"+e.guid)||0)%r;return H._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),H.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){H.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},H.attrFn&&(H.attrFn[t]=!0),et.test(t)&&(H.event.fixHooks[t]=H.event.keyHooks),tt.test(t)&&(H.event.fixHooks[t]=H.event.mouseHooks)}),function(){function e(e,t,n,r,s,o){for(var u=0,a=r.length;u<a;u++){var f=r[u];if(f){var l=!1;f=f[e];while(f){if(f[i]===n){l=r[f.sizset];break}if(f.nodeType===1){o||(f[i]=n,f.sizset=u);if(typeof t!="string"){if(f===t){l=!0;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}r[u]=l}}}function n(e,t,n,r,s,o){for(var u=0,a=r.length;u<a;u++){var f=r[u];if(f){var l=!1;f=f[e];while(f){if(f[i]===n){l=r[f.sizset];break}f.nodeType===1&&!o&&(f[i]=n,f.sizset=u);if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}r[u]=l}}}var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,i="sizcache"+(Math.random()+"").replace(".",""),s=0,o=Object.prototype.toString,u=!1,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){return a=!1,0});var h=function(e,t,n,i){n=n||[],t=t||_;var s=t;if(t.nodeType!==1&&t.nodeType!==9)return[];if(!e||typeof e!="string")return n;var u,a,f,l,c,p,m,g,b=!0,w=h.isXML(t),E=[],x=e;do{r.exec(""),u=r.exec(x);if(u){x=u[3],E.push(u[1]);if(u[2]){l=u[3];break}}}while(u);if(E.length>1&&v.exec(e))if(E.length===2&&d.relative[E[0]])a=S(E[0]+E[1],t,i);else{a=d.relative[E[0]]?[t]:h(E.shift(),t);while(E.length)e=E.shift(),d.relative[e]&&(e+=E.shift()),a=S(e,a,i)}else{!i&&E.length>1&&t.nodeType===9&&!w&&d.match.ID.test(E[0])&&!d.match.ID.test(E[E.length-1])&&(c=h.find(E.shift(),t,w),t=c.expr?h.filter(c.expr,c.set)[0]:c.set[0]);if(t){c=i?{expr:E.pop(),set:y(i)}:h.find(E.pop(),E.length!==1||E[0]!=="~"&&E[0]!=="+"||!t.parentNode?t:t.parentNode,w),a=c.expr?h.filter(c.expr,c.set):c.set,E.length>0?f=y(a):b=!1;while(E.length)p=E.pop(),m=p,d.relative[p]?m=E.pop():p="",m==null&&(m=t),d.relative[p](f,m,w)}else f=E=[]}f||(f=a),f||h.error(p||e);if(o.call(f)==="[object Array]")if(!b)n.push.apply(n,f);else if(t&&t.nodeType===1)for(g=0;f[g]!=null;g++)f[g]&&(f[g]===!0||f[g].nodeType===1&&h.contains(t,f[g]))&&n.push(a[g]);else for(g=0;f[g]!=null;g++)f[g]&&f[g].nodeType===1&&n.push(a[g]);else y(f,n);return l&&(h(l,s,n,i),h.uniqueSort(n)),n};h.uniqueSort=function(e){if(w){u=a,e.sort(w);if(u)for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)}return e},h.matches=function(e,t){return h(e,null,null,t)},h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0},h.find=function(e,t,n){var r,i,s,o,u,a;if(!e)return[];for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1],o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,""),r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}return r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]),{set:r,expr:e}},h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter)if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u],c=s[1],o=!1,s.splice(1,1);if(c.substr(c.length-1)==="\\")continue;y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s)o=a=!0;else if(s===!0)continue}if(s)for(p=0;(f=y[p])!=null;p++)f&&(a=l(f,s,p,y),v=i^a,r&&a!=null?v?o=!0:y[p]=!1:v&&(g.push(f),o=!0));if(a!==t){r||(y=g),e=e.replace(d.match[u],"");if(!o)return[];break}}if(e===m){if(o!=null)break;h.error(e)}m=e}return y},h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9||r===11){if(typeof e.textContent=="string")return e.textContent;if(typeof e.innerText=="string")return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=p(e)}else if(r===3||r===4)return e.nodeValue}else for(t=0;n=e[t];t++)n.nodeType!==8&&(i+=p(n));return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++)if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1);e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++)n=e[i],n&&(e[i]=r?n.parentNode:n.parentNode===t);r&&h.filter(t,e,!0)}},"":function(t,r,i){var o,u=s++,a=e;typeof r=="string"&&!c.test(r)&&(r=r.toLowerCase(),o=r,a=n),a("parentNode",r,u,t,o,i)},"~":function(t,r,i){var o,u=s++,a=e;typeof r=="string"&&!c.test(r)&&(r=r.toLowerCase(),o=r,a=n),a("previousSibling",r,u,t,o,i)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return n.length===0?null:n}},TAG:function(e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s)return e;for(var o=0,u;(u=t[o])!=null;o++)u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1));return!1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&h.error(e[0]);return e[0]=s++,e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");return!s&&d.attrMap[o]&&(e[1]=d.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(f,""),e[2]==="~="&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,n,i,s){if(e[1]==="not"){if(!((r.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var o=h.filter(e[3],t,n,!0^s);return n||i.push.apply(i,o),!1}e[3]=h(e[3],null,null,t)}else if(d.match.POS.test(e[0])||d.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s)return s(e,n,t,r);if(i==="contains")return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++)if(o[u]===e)return!1;return!0}h.error(i)},CHILD:function(e,t){var n,r,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(l==="first")return!0;c=e;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0;case"nth":n=t[2],r=t[3];if(n===1&&r===0)return!0;s=t[0],o=e.parentNode;if(o&&(o[i]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling)c.nodeType===1&&(c.nodeIndex=++a);o[i]=s}return f=e.nodeIndex-r,n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s)return s(e,n,t,r)}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match)d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m));d.match.globalPOS=v;var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(_.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]")Array.prototype.push.apply(r,e);else if(typeof e.length=="number")for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var w,E;_.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(u=!0,0):!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1}:(w=function(e,t){if(e===t)return u=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a)return E(e,t);if(!o)return-1;if(!a)return 1;while(f)i.unshift(f),f=f.parentNode;f=a;while(f)s.unshift(f),f=f.parentNode;n=i.length,r=s.length;for(var l=0;l<n&&l<r;l++)if(i[l]!==s[l])return E(i[l],s[l]);return l===n?E(e,s[l],-1):E(i[l],t,1)},E=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=_.createElement("div"),n="script"+(new Date).getTime(),r=_.documentElement;e.innerHTML="<a name='"+n+"'/>",r.insertBefore(e,r.firstChild),_.getElementById(n)&&(d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}),r.removeChild(e),r=e=null}(),function(){var e=_.createElement("div");e.appendChild(_.createComment("")),e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++)n[i].nodeType===1&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),_.querySelectorAll&&function(){var e=h,t=_.createElement("div"),n="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(!t.querySelectorAll||t.querySelectorAll(".TEST").length!==0){h=function(t,r,i,s){r=r||_;if(!s&&!h.isXML(r)){var o=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(o&&(r.nodeType===1||r.nodeType===9)){if(o[1])return y(r.getElementsByTagName(t),i);if(o[2]&&d.find.CLASS&&r.getElementsByClassName)return y(r.getElementsByClassName(o[2]),i)}if(r.nodeType===9){if(t==="body"&&r.body)return y([r.body],i);if(o&&o[3]){var u=r.getElementById(o[3]);if(!u||!u.parentNode)return y([],i);if(u.id===o[3])return y([u],i)}try{return y(r.querySelectorAll(t),i)}catch(a){}}else if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){var f=r,l=r.getAttribute("id"),c=l||n,p=r.parentNode,v=/^\s*[+~]/.test(t);l?c=c.replace(/'/g,"\\$&"):r.setAttribute("id",c),v&&p&&(r=r.parentNode);try{if(!v||p)return y(r.querySelectorAll("[id='"+c+"'] "+t),i)}catch(m){}finally{l||f.removeAttribute("id")}}}return e(t,r,i,s)};for(var r in e)h[r]=e[r];t=null}}(),function(){var e=_.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var n=!t.call(_.createElement("div"),"div"),r=!1;try{t.call(_.documentElement,"[test!='']:sizzle")}catch(i){r=!0}h.matchesSelector=function(e,i){i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e))try{if(r||!d.match.PSEUDO.test(i)&&!/!=/.test(i)){var s=t.call(e,i);if(s||!n||e.document&&e.document.nodeType!==11)return s}}catch(o){}return h(i,null,null,[e]).length>0}}}(),function(){var e=_.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!e.getElementsByClassName&&e.getElementsByClassName("e").length!==0){e.lastChild.className="e";if(e.getElementsByClassName("e").length===1)return;d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n)return t.getElementsByClassName(e[1])},e=null}}(),_.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:_.documentElement.compareDocumentPosition?h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}:h.contains=function(){return!1},h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var S=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e))s+=r[0],e=e.replace(d.match.PSEUDO,"");e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++)h(e,o[u],i,n);return h.filter(s,i)};h.attr=H.attr,h.selectors.attrMap={},H.find=h,H.expr=h.selectors,H.expr[":"]=H.expr.filters,H.unique=h.uniqueSort,H.text=h.getText,H.isXMLDoc=h.isXML,H.contains=h.contains}();var ut=/Until$/,at=/^(?:parents|prevUntil|prevAll)/,ft=/,/,lt=/^.[^:#\[\.,]*$/,ct=Array.prototype.slice,ht=H.expr.match.globalPOS,pt={children:!0,contents:!0,next:!0,prev:!0};H.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string")return H(e).filter(function(){for(n=0,r=t.length;n<r;n++)if(H.contains(t[n],this))return!0});var i=this.pushStack("","find",e),s,o,u;for(n=0,r=this.length;n<r;n++){s=i.length,H.find(e,this[n],i);if(n>0)for(o=s;o<i.length;o++)for(u=0;u<s;u++)if(i[u]===i[o]){i.splice(o--,1);break}}return i},has:function(e){var t=H(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(H.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(T(this,e,!1),"not",e)},filter:function(e){return this.pushStack(T(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?ht.test(e)?H(e,this.context).index(this[0])>=0:H.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,s=this[0];if(H.isArray(e)){var o=1;while(s&&s.ownerDocument&&s!==t){for(r=0;r<e.length;r++)H(s).is(e[r])&&n.push({selector:e[r],elem:s,level:o});s=s.parentNode,o++}return n}var u=ht.test(e)||typeof e!="string"?H(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){s=this[r];while(s){if(u?u.index(s)>-1:H.find.matchesSelector(s,e)){n.push(s);break}s=s.parentNode;if(!s||!s.ownerDocument||s===t||s.nodeType===11)break}}return n=n.length>1?H.unique(n):n,this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?H.inArray(this[0],H(e)):H.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?H(e,t):H.makeArray(e&&e.nodeType?[e]:e),r=H.merge(this.get(),n);return this.pushStack(N(n[0])||N(r[0])?r:H.unique(r))},andSelf:function(){return this.add(this.prevObject)}}),H.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return H.dir(e,"parentNode")},parentsUntil:function(e,t,n){return H.dir(e,"parentNode",n)},next:function(e){return H.nth(e,2,"nextSibling")},prev:function(e){return H.nth(e,2,"previousSibling")},nextAll:function(e){return H.dir(e,"nextSibling")},prevAll:function(e){return H.dir(e,"previousSibling")},nextUntil:function(e,t,n){return H.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return H.dir(e,"previousSibling",n)},siblings:function(e){return H.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return H.sibling(e.firstChild)},contents:function(e){return H.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:H.makeArray(e.childNodes)}},function(e,t){H.fn[e]=function(n,r){var i=H.map(this,t,n);return ut.test(e)||(r=n),r&&typeof r=="string"&&(i=H.filter(r,i)),i=this.length>1&&!pt[e]?H.unique(i):i,(this.length>1||ft.test(r))&&at.test(e)&&(i=i.reverse()),this.pushStack(i,e,ct.call(arguments).join(","))}}),H.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?H.find.matchesSelector(t[0],e)?[t[0]]:[]:H.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!H(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n])if(e.nodeType===1&&++i===t)break;return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:\d+|null)"/g,mt=/^\s+/,gt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,yt=/<([\w:]+)/,bt=/<tbody/i,wt=/<|&#?\w+;/,Et=/<(?:script|style)/i,St=/<(?:script|object|embed|option|style)/i,xt=new RegExp("<(?:"+dt+")[\\s/>]","i"),Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/\/(java|ecma)script/i,Ct=/^\s*<!(?:\[CDATA\[|\-\-)/,kt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Lt=x(_);kt.optgroup=kt.option,kt.tbody=kt.tfoot=kt.colgroup=kt.caption=kt.thead,kt.th=kt.td,H.support.htmlSerialize||(kt._default=[1,"div<div>","</div>"]),H.fn.extend({text:function(e){return H.access(this,function(e){return e===t?H.text(this):this.empty().append((this[0]&&this[0].ownerDocument||_).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(H.isFunction(e))return this.each(function(t){H(this).wrapAll(e.call(this,t))});if(this[0]){var t=H(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return H.isFunction(e)?this.each(function(t){H(this).wrapInner(e.call(this,t))}):this.each(function(){var t=H(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=H.isFunction(e);return this.each(function(n){H(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){H.nodeName(this,"body")||H(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=H.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,H.clean(arguments)),e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++)if(!e||H.filter(e,[r]).length)!t&&r.nodeType===1&&(H.cleanData(r.getElementsByTagName("*")),H.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r);return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&H.cleanData(t.getElementsByTagName("*"));while(t.firstChild)t.removeChild(t.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return H.clone(this,e,t)})},html:function(e){return H.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(vt,""):null;if(typeof e=="string"&&!Et.test(e)&&(H.support.leadingWhitespace||!mt.test(e))&&!kt[(yt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(gt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(H.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return this[0]&&this[0].parentNode?H.isFunction(e)?this.each(function(t){var n=H(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=H(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;H(this).remove(),t?H(t).before(e):H(n).append(e)})):this.length?this.pushStack(H(H.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,s,o,u,a=e[0],f=[];if(!H.support.checkClone&&arguments.length===3&&typeof a=="string"&&Tt.test(a))return this.each(function(){H(this).domManip(e,n,r,!0)});if(H.isFunction(a))return this.each(function(i){var s=H(this);e[0]=a.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){u=a&&a.parentNode,H.support.parentNode&&u&&u.nodeType===11&&u.childNodes.length===this.length?i={fragment:u}:i=H.buildFragment(e,this,f),o=i.fragment,o.childNodes.length===1?s=o=o.firstChild:s=o.firstChild;if(s){n=n&&H.nodeName(s,"tr");for(var l=0,c=this.length,h=c-1;l<c;l++)r.call(n?S(this[l],s):this[l],i.cacheable||c>1&&l<h?H.clone(o,!0,!0):o)}f.length&&H.each(f,function(e,t){t.src?H.ajax({type:"GET",global:!1,url:t.src,async:!1,dataType:"script"}):H.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Ct,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),H.buildFragment=function(e,t,n){var r,i,s,o,u=e[0];return t&&t[0]&&(o=t[0].ownerDocument||t[0]),o.createDocumentFragment||(o=_),e.length===1&&typeof u=="string"&&u.length<512&&o===_&&u.charAt(0)==="<"&&!St.test(u)&&(H.support.checkClone||!Tt.test(u))&&(H.support.html5Clone||!xt.test(u))&&(i=!0,s=H.fragments[u],s&&s!==1&&(r=s)),r||(r=o.createDocumentFragment(),H.clean(e,o,r,n)),i&&(H.fragments[u]=s?r:1),{fragment:r,cacheable:i}},H.fragments={},H.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){H.fn[e]=function(n){var r=[],i=H(n),s=this.length===1&&this[0].parentNode;if(s&&s.nodeType===11&&s.childNodes.length===1&&i.length===1)return i[t](this[0]),this;for(var o=0,u=i.length;o<u;o++){var a=(o>0?this.clone(!0):this).get();H(i[o])[t](a),r=r.concat(a)}return this.pushStack(r,e,i.selector)}}),H.extend({clone:function(e,t,n){var r,i,s,o=H.support.html5Clone||H.isXMLDoc(e)||!xt.test("<"+e.nodeName+">")?e.cloneNode(!0):m(e);if((!H.support.noCloneEvent||!H.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!H.isXMLDoc(e)){w(e,o),r=b(e),i=b(o);for(s=0;r[s];++s)i[s]&&w(r[s],i[s])}if(t){E(e,o);if(n){r=b(e),i=b(o);for(s=0;r[s];++s)E(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var i,s,o,u=[];t=t||_,typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||_);for(var a=0,f;(f=e[a])!=null;a++){typeof f=="number"&&(f+="");if(!f)continue;if(typeof f=="string")if(!wt.test(f))f=t.createTextNode(f);else{f=f.replace(gt,"<$1></$2>");var l=(yt.exec(f)||["",""])[1].toLowerCase(),c=kt[l]||kt._default,h=c[0],p=t.createElement("div"),d=Lt.childNodes,v;t===_?Lt.appendChild(p):x(t).appendChild(p),p.innerHTML=c[1]+f+c[2];while(h--)p=p.lastChild;if(!H.support.tbody){var m=bt.test(f),y=l==="table"&&!m?p.firstChild&&p.firstChild.childNodes:c[1]==="<table>"&&!m?p.childNodes:[];for(o=y.length-1;o>=0;--o)H.nodeName(y[o],"tbody")&&!y[o].childNodes.length&&y[o].parentNode.removeChild(y[o])}!H.support.leadingWhitespace&&mt.test(f)&&p.insertBefore(t.createTextNode(mt.exec(f)[0]),p.firstChild),f=p.childNodes,p&&(p.parentNode.removeChild(p),d.length>0&&(v=d[d.length-1],v&&v.parentNode&&v.parentNode.removeChild(v)))}var b;if(!H.support.appendChecked)if(f[0]&&typeof (b=f.length)=="number")for(o=0;o<b;o++)g(f[o]);else g(f);f.nodeType?u.push(f):u=H.merge(u,f)}if(n){i=function(e){return!e.type||Nt.test(e.type)};for(a=0;u[a];a++){s=u[a];if(r&&H.nodeName(s,"script")&&(!s.type||Nt.test(s.type)))r.push(s.parentNode?s.parentNode.removeChild(s):s);else{if(s.nodeType===1){var w=H.grep(s.getElementsByTagName("script"),i);u.splice.apply(u,[a+1,0].concat(w))}n.appendChild(s)}}}return u},cleanData:function(e){var t,n,r=H.cache,i=H.event.special,s=H.support.deleteExpando;for(var o=0,u;(u=e[o])!=null;o++){if(u.nodeName&&H.noData[u.nodeName.toLowerCase()])continue;n=u[H.expando];if(n){t=r[n];if(t&&t.events){for(var a in t.events)i[a]?H.event.remove(u,a):H.removeEvent(u,a,t.handle);t.handle&&(t.handle.elem=null)}s?delete u[H.expando]:u.removeAttribute&&u.removeAttribute(H.expando),delete r[n]}}}});var At=/alpha\([^)]*\)/i,Ot=/opacity=([^)]*)/,Mt=/([A-Z]|^ms)/g,_t=/^[\-+]?(?:\d*\.)?\d+$/i,Dt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,Pt=/^([\-+])=([\-+.\de]+)/,Ht=/^margin/,Bt={position:"absolute",visibility:"hidden",display:"block"},jt=["Top","Right","Bottom","Left"],Ft,It,qt;H.fn.css=function(e,n){return H.access(this,function(e,n,r){return r!==t?H.style(e,n,r):H.css(e,n)},e,n,arguments.length>1)},H.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ft(e,"opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":H.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!!e&&e.nodeType!==3&&e.nodeType!==8&&!!e.style){var s,o,u=H.camelCase(n),a=e.style,f=H.cssHooks[u];n=H.cssProps[u]||u;if(r===t)return f&&"get"in f&&(s=f.get(e,!1,i))!==t?s:a[n];o=typeof r,o==="string"&&(s=Pt.exec(r))&&(r=+(s[1]+1)*+s[2]+parseFloat(H.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!H.cssNumber[u]&&(r+="px");if(!f||!("set"in f)||(r=f.set(e,r))!==t)try{a[n]=r}catch(l){}}},css:function(e,n,r){var i,s;n=H.camelCase(n),s=H.cssHooks[n],n=H.cssProps[n]||n,n==="cssFloat"&&(n="float");if(s&&"get"in s&&(i=s.get(e,!0,r))!==t)return i;if(Ft)return Ft(e,n)},swap:function(e,t,n){var r={},i,s;for(s in t)r[s]=e.style[s],e.style[s]=t[s];i=n.call(e);for(s in t)e.style[s]=r[s];return i}}),H.curCSS=H.css,_.defaultView&&_.defaultView.getComputedStyle&&(It=function(e,t){var n,r,i,s,o=e.style;return t=t.replace(Mt,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&(n=i.getPropertyValue(t),n===""&&!H.contains(e.ownerDocument.documentElement,e)&&(n=H.style(e,t))),!H.support.pixelMargin&&i&&Ht.test(t)&&Dt.test(n)&&(s=o.width,o.width=n,n=i.width,o.width=s),n}),_.documentElement.currentStyle&&(qt=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;return s==null&&o&&(i=o[t])&&(s=i),Dt.test(s)&&(n=o.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),o.left=t==="fontSize"?"1em":s,s=o.pixelLeft+"px",o.left=n,r&&(e.runtimeStyle.left=r)),s===""?"auto":s}),Ft=It||qt,H.each(["height","width"],function(e,t){H.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth!==0?v(e,t,r):H.swap(e,Bt,function(){return v(e,t,r)})},set:function(e,t){return _t.test(t)?t+"px":t}}}),H.support.opacity||(H.cssHooks.opacity={get:function(e,t){return Ot.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=H.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&H.trim(s.replace(At,""))===""){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=At.test(s)?s.replace(At,i):s+" "+i}}),H(function(){H.support.reliableMarginRight||(H.cssHooks.marginRight={get:function(e,t){return H.swap(e,{display:"inline-block"},function(){return t?Ft(e,"margin-right"):e.style.marginRight})}})}),H.expr&&H.expr.filters&&(H.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!H.support.reliableHiddenOffsets&&(e.style&&e.style.display||H.css(e,"display"))==="none"},H.expr.filters.visible=function(e){return!H.expr.filters.hidden(e)}),H.each({margin:"",padding:"",border:"Width"},function(e,t){H.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+jt[r]+t]=i[r]||i[r-2]||i[0];return s}}});var Rt=/%20/g,Ut=/\[\]$/,zt=/\r?\n/g,Wt=/#.*$/,Xt=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Vt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,$t=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Jt=/^(?:GET|HEAD)$/,Kt=/^\/\//,Qt=/\?/,Gt=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Yt=/^(?:select|textarea)/i,Zt=/\s+/,en=/([?&])_=[^&]*/,tn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,nn=H.fn.load,rn={},sn={},on,un,an=["*/"]+["*"];try{on=P.href}catch(fn){on=_.createElement("a"),on.href="",on=on.href}un=tn.exec(on.toLowerCase())||[],H.fn.extend({load:function(e,n,r){if(typeof e!="string"&&nn)return nn.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var s=e.slice(i,e.length);e=e.slice(0,i)}var o="GET";n&&(H.isFunction(n)?(r=n,n=t):typeof n=="object"&&(n=H.param(n,H.ajaxSettings.traditional),o="POST"));var u=this;return H.ajax({url:e,type:o,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),u.html(s?H("<div>").append(n.replace(Gt,"")).find(s):n)),r&&u.each(r,[n,t,e])}}),this},serialize:function(){return H.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?H.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Yt.test(this.nodeName)||Vt.test(this.type))}).map(function(e,t){var n=H(this).val();return n==null?null:H.isArray(n)?H.map(n,function(e,n){return{name:t.name,value:e.replace(zt,"\r\n")}}):{name:t.name,value:n.replace(zt,"\r\n")}}).get()}}),H.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){H.fn[t]=function(e){return this.on(t,e)}}),H.each(["get","post"],function(e,n){H[n]=function(e,r,i,s){return H.isFunction(r)&&(s=s||i,i=r,r=t),H.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),H.extend({getScript:function(e,n){return H.get(e,t,n,"script")},getJSON:function(e,t,n){return H.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?h(e,H.ajaxSettings):(t=e,e=H.ajaxSettings),h(e,t),e},ajaxSettings:{url:on,isLocal:$t.test(un[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":an},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":H.parseJSON,"text xml":H.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:d(rn),ajaxTransport:d(sn),ajax:function(e,n){function r(e,n,r,p){if(E!==2){E=2,b&&clearTimeout(b),y=t,m=p||"",T.readyState=e>0?4:0;var d,v,g,w=n,x=r?l(i,T,r):t,N,C;if(e>=200&&e<300||e===304){if(i.ifModified){if(N=T.getResponseHeader("Last-Modified"))H.lastModified[h]=N;if(C=T.getResponseHeader("Etag"))H.etag[h]=C}if(e===304)w="notmodified",d=!0;else try{v=f(i,x),w="success",d=!0}catch(k){w="parsererror",g=k}}else{g=w;if(!w||e)w="error",e<0&&(e=0)}T.status=e,T.statusText=""+(n||w),d?u.resolveWith(s,[v,w,T]):u.rejectWith(s,[T,w,g]),T.statusCode(c),c=t,S&&o.trigger("ajax"+(d?"Success":"Error"),[T,i,d?v:g]),a.fireWith(s,[T,w]),S&&(o.trigger("ajaxComplete",[T,i]),--H.active||H.event.trigger("ajaxStop"))}}typeof e=="object"&&(n=e,e=t),n=n||{};var i=H.ajaxSetup({},n),s=i.context||i,o=s!==i&&(s.nodeType||s instanceof H)?H(s):H.event,u=H.Deferred(),a=H.Callbacks("once memory"),c=i.statusCode||{},h,d={},v={},m,g,y,b,w,E=0,S,x,T={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=v[n]=v[n]||e,d[e]=t}return this},getAllResponseHeaders:function(){return E===2?m:null},getResponseHeader:function(e){var n;if(E===2){if(!g){g={};while(n=Xt.exec(m))g[n[1].toLowerCase()]=n[2]}n=g[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(i.mimeType=e),this},abort:function(e){return e=e||"abort",y&&y.abort(e),r(0,e),this}};u.promise(T),T.success=T.done,T.error=T.fail,T.complete=a.add,T.statusCode=function(e){if(e){var t;if(E<2)for(t in e)c[t]=[c[t],e[t]];else t=e[T.status],T.then(t,t)}return this},i.url=((e||i.url)+"").replace(Wt,"").replace(Kt,un[1]+"//"),i.dataTypes=H.trim(i.dataType||"*").toLowerCase().split(Zt),i.crossDomain==null&&(w=tn.exec(i.url.toLowerCase()),i.crossDomain=!(!w||w[1]==un[1]&&w[2]==un[2]&&(w[3]||(w[1]==="http:"?80:443))==(un[3]||(un[1]==="http:"?80:443)))),i.data&&i.processData&&typeof i.data!="string"&&(i.data=H.param(i.data,i.traditional)),p(rn,i,n,T);if(E===2)return!1;S=i.global,i.type=i.type.toUpperCase(),i.hasContent=!Jt.test(i.type),S&&H.active++===0&&H.event.trigger("ajaxStart");if(!i.hasContent){i.data&&(i.url+=(Qt.test(i.url)?"&":"?")+i.data,delete i.data),h=i.url;if(i.cache===!1){var N=H.now(),C=i.url.replace(en,"$1_="+N);i.url=C+(C===i.url?(Qt.test(i.url)?"&":"?")+"_="+N:"")}}(i.data&&i.hasContent&&i.contentType!==!1||n.contentType)&&T.setRequestHeader("Content-Type",i.contentType),i.ifModified&&(h=h||i.url,H.lastModified[h]&&T.setRequestHeader("If-Modified-Since",H.lastModified[h]),H.etag[h]&&T.setRequestHeader("If-None-Match",H.etag[h])),T.setRequestHeader("Accept",i.dataTypes[0]&&i.accepts[i.dataTypes[0]]?i.accepts[i.dataTypes[0]]+(i.dataTypes[0]!=="*"?", "+an+"; q=0.01":""):i.accepts["*"]);for(x in i.headers)T.setRequestHeader(x,i.headers[x]);if(!i.beforeSend||i.beforeSend.call(s,T,i)!==!1&&E!==2){for(x in{success:1,error:1,complete:1})T[x](i[x]);y=p(sn,i,n,T);if(!y)r(-1,"No Transport");else{T.readyState=1,S&&o.trigger("ajaxSend",[T,i]),i.async&&i.timeout>0&&(b=setTimeout(function(){T.abort("timeout")},i.timeout));try{E=1,y.send(d,r)}catch(k){if(!(E<2))throw k;r(-1,k)}}return T}return T.abort(),!1},param:function(e,n){var r=[],i=function(e,t){t=H.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=H.ajaxSettings.traditional);if(H.isArray(e)||e.jquery&&!H.isPlainObject(e))H.each(e,function(){i(this.name,this.value)});else for(var s in e)c(s,e[s],n,i);return r.join("&").replace(Rt,"+")}}),H.extend({active:0,lastModified:{},etag:{}});var ln=H.now(),cn=/(\=)\?(&|$)|\?\?/i;H.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return H.expando+"_"+ln++}}),H.ajaxPrefilter("json jsonp",function(t,n,r){var i=typeof t.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(t.contentType);if(t.dataTypes[0]==="jsonp"||t.jsonp!==!1&&(cn.test(t.url)||i&&cn.test(t.data))){var s,o=t.jsonpCallback=H.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u=e[o],a=t.url,f=t.data,l="$1"+o+"$2";return t.jsonp!==!1&&(a=a.replace(cn,l),t.url===a&&(i&&(f=f.replace(cn,l)),t.data===f&&(a+=(/\?/.test(a)?"&":"?")+t.jsonp+"="+o))),t.url=a,t.data=f,e[o]=function(e){s=[e]},r.always(function(){e[o]=u,s&&H.isFunction(u)&&e[o](s[0])}),t.converters["script json"]=function(){return s||H.error(o+" was not called"),s[0]},t.dataTypes[0]="json","script"}}),H.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return H.globalEval(e),e}}}),H.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),H.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=_.head||_.getElementsByTagName("head")[0]||_.documentElement;return{send:function(i,s){n=_.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||s(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var hn=e.ActiveXObject?function(){for(var e in dn)dn[e](0,1)}:!1,pn=0,dn;H.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&a()||u()}:a,function(e){H.extend(H.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(H.ajaxSettings.xhr()),H.support.ajax&&H.ajaxTransport(function(n){if(!n.crossDomain||H.support.cors){var r;return{send:function(i,s){var o=n.xhr(),u,a;n.username?o.open(n.type,n.url,n.async,n.username,n.password):o.open(n.type,n.url,n.async);if(n.xhrFields)for(a in n.xhrFields)o[a]=n.xhrFields[a];n.mimeType&&o.overrideMimeType&&o.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(a in i)o.setRequestHeader(a,i[a])}catch(f){}o.send(n.hasContent&&n.data||null),r=function(e,i){var a,f,l,c,h;try{if(r&&(i||o.readyState===4)){r=t,u&&(o.onreadystatechange=H.noop,hn&&delete dn[u]);if(i)o.readyState!==4&&o.abort();else{a=o.status,l=o.getAllResponseHeaders(),c={},h=o.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=o.responseText}catch(e){}try{f=o.statusText}catch(p){f=""}!a&&n.isLocal&&!n.crossDomain?a=c.text?200:404:a===1223&&(a=204)}}}catch(d){i||s(-1,d)}c&&s(a,f,c,l)},!n.async||o.readyState===4?r():(u=++pn,hn&&(dn||(dn={},H(e).unload(hn)),dn[u]=r),o.onreadystatechange=r)},abort:function(){r&&r(0,1)}}}});var vn={},mn,gn,yn=/^(?:toggle|show|hide)$/,bn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,wn,En=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],Sn;H.fn.extend({show:function(e,t,n){var s,o;if(e||e===0)return this.animate(i("show",3),e,t,n);for(var u=0,a=this.length;u<a;u++)s=this[u],s.style&&(o=s.style.display,!H._data(s,"olddisplay")&&o==="none"&&(o=s.style.display=""),(o===""&&H.css(s,"display")==="none"||!H.contains(s.ownerDocument.documentElement,s))&&H._data(s,"olddisplay",r(s.nodeName)));for(u=0;u<a;u++){s=this[u];if(s.style){o=s.style.display;if(o===""||o==="none")s.style.display=H._data(s,"olddisplay")||""}}return this},hide:function(e,t,n){if(e||e===0)return this.animate(i("hide",3),e,t,n);var r,s,o=0,u=this.length;for(;o<u;o++)r=this[o],r.style&&(s=H.css(r,"display"),s!=="none"&&!H._data(r,"olddisplay")&&H._data(r,"olddisplay",s));for(o=0;o<u;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:H.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";return H.isFunction(e)&&H.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:H(this).is(":hidden");H(this)[t?"show":"hide"]()}):this.animate(i("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,i){function s(){o.queue===!1&&H._mark(this);var t=H.extend({},o),n=this.nodeType===1,i=n&&H(this).is(":hidden"),s,u,a,f,l,c,h,p,d,v,m;t.animatedProperties={};for(a in e){s=H.camelCase(a),a!==s&&(e[s]=e[a],delete e[a]);if((l=H.cssHooks[s])&&"expand"in l){c=l.expand(e[s]),delete e[s];for(a in c)a in e||(e[a]=c[a])}}for(s in e){u=e[s],H.isArray(u)?(t.animatedProperties[s]=u[1],u=e[s]=u[0]):t.animatedProperties[s]=t.specialEasing&&t.specialEasing[s]||t.easing||"swing";if(u==="hide"&&i||u==="show"&&!i)return t.complete.call(this);n&&(s==="height"||s==="width")&&(t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],H.css(this,"display")==="inline"&&H.css(this,"float")==="none"&&(!H.support.inlineBlockNeedsLayout||r(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}t.overflow!=null&&(this.style.overflow="hidden");for(a in e)f=new H.fx(this,t,a),u=e[a],yn.test(u)?(m=H._data(this,"toggle"+a)||(u==="toggle"?i?"show":"hide":0),m?(H._data(this,"toggle"+a,m==="show"?"hide":"show"),f[m]()):f[u]()):(h=bn.exec(u),p=f.cur(),h?(d=parseFloat(h[2]),v=h[3]||(H.cssNumber[a]?"":"px"),v!=="px"&&(H.style(this,a,(d||1)+v),p=(d||1)/f.cur()*p,H.style(this,a,p+v)),h[1]&&(d=(h[1]==="-="?-1:1)*d+p),f.custom(p,d,v)):f.custom(p,u,""));return!0}var o=H.speed(t,n,i);return H.isEmptyObject(e)?this.each(o.complete,[!1]):(e=H.extend({},e),o.queue===!1?this.each(s):this.queue(o.queue,s))},stop:function(e,n,r){return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function t(e,t,n){var i=t[n];H.removeData(e,n,!0),i.stop(r)}var n,i=!1,s=H.timers,o=H._data(this);r||H._unmark(!0,this);if(e==null)for(n in o)o[n]&&o[n].stop&&n.indexOf(".run")===n.length-4&&t(this,o,n);else o[n=e+".run"]&&o[n].stop&&t(this,o,n);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(r?s[n](!0):s[n].saveState(),i=!0,s.splice(n,1));(!r||!i)&&H.dequeue(this,e)})}}),H.each({slideDown:i("show",1),slideUp:i("hide",1),slideToggle:i("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){H.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),H.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?H.extend({},e):{complete:n||!n&&t||H.isFunction(e)&&e,duration:e,easing:n&&t||t&&!H.isFunction(t)&&t};r.duration=H.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in H.fx.speeds?H.fx.speeds[r.duration]:H.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(e){H.isFunction(r.old)&&r.old.call(this),r.queue?H.dequeue(this,r.queue):e!==!1&&H._unmark(this)},r},easing:{linear:function(e){return e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),H.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(H.fx.step[this.prop]||H.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=H.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function i(e){return s.step(e)}var s=this,u=H.fx;this.startTime=Sn||o(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(H.cssNumber[this.prop]?"":"px"),i.queue=this.options.queue,i.elem=this.elem,i.saveState=function(){H._data(s.elem,"fxshow"+s.prop)===t&&(s.options.hide?H._data(s.elem,"fxshow"+s.prop,s.start):s.options.show&&H._data(s.elem,"fxshow"+s.prop,s.end))},i()&&H.timers.push(i)&&!wn&&(wn=setInterval(u.tick,u.interval))},show:function(){var e=H._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||H.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),H(this.elem).show()},hide:function(){this.options.orig[this.prop]=H._data(this.elem,"fxshow"+this.prop)||H.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=Sn||o(),s=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties)a.animatedProperties[t]!==!0&&(s=!1);if(s){a.overflow!=null&&!H.support.shrinkWrapBlocks&&H.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]}),a.hide&&H(u).hide();if(a.hide||a.show)for(t in a.animatedProperties)H.style(u,t,a.orig[t]),H.removeData(u,"fxshow"+t,!0),H.removeData(u,"toggle"+t,!0);r=a.complete,r&&(a.complete=!1,r.call(u))}return!1}return a.duration==Infinity?this.now=i:(n=i-this.startTime,this.state=n/a.duration,this.pos=H.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},H.extend(H.fx,{tick:function(){var e,t=H.timers,n=0;for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||H.fx.stop()},interval:13,stop:function(){clearInterval(wn),wn=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){H.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),H.each(En.concat.apply([],En),function(e,t){t.indexOf("margin")&&(H.fx.step[t]=function(e){H.style(e.elem,t,Math.max(0,e.now)+e.unit)})}),H.expr&&H.expr.filters&&(H.expr.filters.animated=function(e){return H.grep(H.timers,function(t){return e===t.elem}).length});var xn,Tn=/^t(?:able|d|h)$/i,Nn=/^(?:body|html)$/i;"getBoundingClientRect"in _.documentElement?xn=function(e,t,r,i){try{i=e.getBoundingClientRect()}catch(s){}if(!i||!H.contains(r,e))return i?{top:i.top,left:i.left}:{top:0,left:0};var o=t.body,u=n(t),a=r.clientTop||o.clientTop||0,f=r.clientLeft||o.clientLeft||0,l=u.pageYOffset||H.support.boxModel&&r.scrollTop||o.scrollTop,c=u.pageXOffset||H.support.boxModel&&r.scrollLeft||o.scrollLeft,h=i.top+l-a,p=i.left+c-f;return{top:h,left:p}}:xn=function(e,t,n){var r,i=e.offsetParent,s=e,o=t.body,u=t.defaultView,a=u?u.getComputedStyle(e,null):e.currentStyle,f=e.offsetTop,l=e.offsetLeft;while((e=e.parentNode)&&e!==o&&e!==n){if(H.support.fixedPosition&&a.position==="fixed")break;r=u?u.getComputedStyle(e,null):e.currentStyle,f-=e.scrollTop,l-=e.scrollLeft,e===i&&(f+=e.offsetTop,l+=e.offsetLeft,H.support.doesNotAddBorder&&(!H.support.doesAddBorderForTableAndCells||!Tn.test(e.nodeName))&&(f+=parseFloat(r.borderTopWidth)||0,l+=parseFloat(r.borderLeftWidth)||0),s=i,i=e.offsetParent),H.support.subtractsBorderForOverflowNotVisible&&r.overflow!=="visible"&&(f+=parseFloat(r.borderTopWidth)||0,l+=parseFloat(r.borderLeftWidth)||0),a=r}if(a.position==="relative"||a.position==="static")f+=o.offsetTop,l+=o.offsetLeft;return H.support.fixedPosition&&a.position==="fixed"&&(f+=Math.max(n.scrollTop,o.scrollTop),l+=Math.max(n.scrollLeft,o.scrollLeft)),{top:f,left:l}},H.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){H.offset.setOffset(this,e,t)});var n=this[0],r=n&&n.ownerDocument;return r?n===r.body?H.offset.bodyOffset(n):xn(n,r,r.documentElement):null},H.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return H.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(H.css(e,"marginTop"))||0,n+=parseFloat(H.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=H.css(e,"position");r==="static"&&(e.style.position="relative");var i=H(e),s=i.offset(),o=H.css(e,"top"),u=H.css(e,"left"),a=(r==="absolute"||r==="fixed")&&H.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),H.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},H.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Nn.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(H.css(e,"marginTop"))||0,n.left-=parseFloat(H.css(e,"marginLeft"))||0,r.top+=parseFloat(H.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(H.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||_.body;while(e&&!Nn.test(e.nodeName)&&H.css(e,"position")==="static")e=e.offsetParent;return e})}}),H.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,r){var i=/Y/.test(r);H.fn[e]=function(s){return H.access(this,function(e,s,o){var u=n(e);if(o===t)return u?r in u?u[r]:H.support.boxModel&&u.document.documentElement[s]||u.document.body[s]:e[s];u?u.scrollTo(i?H(u).scrollLeft():o,i?o:H(u).scrollTop()):e[s]=o},e,s,arguments.length,null)}}),H.each({Height:"height",Width:"width"},function(e,n){var r="client"+e,i="scroll"+e,s="offset"+e;H.fn["inner"+e]=function(){var e=this[0];return e?e.style?parseFloat(H.css(e,n,"padding")):this[n]():null},H.fn["outer"+e]=function(e){var t=this[0];return t?t.style?parseFloat(H.css(t,n,e?"margin":"border")):this[n]():null},H.fn[n]=function(e){return H.access(this,function(e,n,o){var u,a,f,l;if(H.isWindow(e))return u=e.document,a=u.documentElement[r],H.support.boxModel&&a||u.body&&u.body[r]||a;if(e.nodeType===9)return u=e.documentElement,u[r]>=u[i]?u[r]:Math.max(e.body[i],u[i],e.body[s],u[s]);if(o===t)return f=H.css(e,n),l=parseFloat(f),H.isNumeric(l)?l:f;H(e).css(n,o)},n,e,arguments.length,null)}}),e.jQuery=e.$=H,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return H})}(window),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.3";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t){return x.isEmpty(t)?[]:x.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0==t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=M(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),x.isFunction=function(e){return"function"==typeof e},x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=""+ ++P;return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){n=x.defaults({},n,x.templateSettings);var r=RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=u+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,x);var a=function(e){return o.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),define("roles",[],function(){"use strict";return{SUPERVISOR:"supervisor",USER:"user"}}),define("prototypes/player_adapter",[],function(){"use strict";var e=function(){this._init()};return e.STATUS={INITIALIZING:0,LOADING:1,SEEKING:2,PAUSED:3,PLAYING:4,ENDED:5,ERROR_NETWORK:6,ERROR_UNSUPPORTED_MEDIA:7},e.EVENTS={PLAY:"pa_play",PAUSE:"pa_pause",SEEKING:"pa_seeking",READY:"pa_ready",TIMEUPDATE:"pa_timeupdate",ERROR:"pa_error",ENDED:"pa_ended"},e.prototype._listeners={},e.prototype._init=function(){this._listeners={}},e.prototype.play=function(){throw"Function 'play' must be implemented in player adapter!"},e.prototype.pause=function(){throw"Function 'pause' must be implemented in player adapter!"},e.prototype.setCurrentTime=function(){throw"Function 'setCurrentTime' must be implemented in player adapter!"},e.prototype.getCurrentTime=function(){throw"Function 'getCurrentTime' must be implemented in player adapter!"},e.prototype.getDuration=function(){throw"Function 'getDuration' must be implemented in player adapter!"},e.prototype.getStatus=function(){throw"Function 'getDuration' must be implemented in player adapter!"},e.prototype._getListeners=function(e,t){var n=(t?"1":"0")+e;return n in this.__proto__._listeners||(this.__proto__._listeners[n]=[]),this.__proto__._listeners[n]},e.prototype.addEventListener=function(e,t,n){var r=this._getListeners(e,n),i=r.indexOf(t);i===-1&&r.push(t)},e.prototype.removeEventListener=function(e,t,n){var r=this._getListeners(e,n),i=r.indexOf(t);i!==-1&&r.splice(i,1)},e.prototype.dispatchEvent=function(e,t){var n=t,r,i;typeof t!="undefined"&&(n=e.type),r=this._getListeners(n,!1).slice();for(i=0;i<r.length;i++)r[i].call(this,e);return!e.defaultPrevented},e.prototype.triggerEvent=function(e){var t;return document.createEventObject?(t=document.createEventObject(),t.type=e,!this.dispatchEvent(t,e)):(t=document.createEvent("CustomEvent"),t.initEvent(e,!0,!0),!this.dispatchEvent(t,e))},e.prototype.isValid=function(){var e="",t={play:"function",pause:"function",setCurrentTime:"function",getCurrentTime:"function",getDuration:"function",getStatus:"function"},n;for(n in t){if(typeof t[n]!="string")continue;typeof this[n]=="undefined"&&(e+="-"+n+" is not implemented! \n"),typeof this[n]!==t[n]&&(e+="-"+n+" is not a valid implementation, type should be "+t[n]+"! \n")}return e!==""?(console.warn("Player adapter implementation not valid! \n"+e),!1):!0},e}),define("player_adapter_HTML5",["jquery","prototypes/player_adapter"],function(e,t){"use strict";var n=function(n){var r,i=this;r||(r=Element);if(typeof n!="undefined"&&n!==null&&n instanceof r)return this.id="PlayerAdapter"+n.id,this.htmlElement=null,this.status=t.STATUS.INITIALIZING,this.waitToPlay=!1,this.initialized=!1,this.init=function(){e(n).wrap(i.getHTMLTemplate(i.id));if(e("#"+i.id).length===0)throw"Cannot create HTML representation of the adapter";return i.htmlElement=document.getElementById(i.id),e.extend(!0,this,i.htmlElement),this.__proto__=new t,this.dispatchEvent=this.__proto__.dispatchEvent,this.triggerEvent=this.__proto__.triggerEvent,this.addEventListener=this.__proto__.addEventListener,this.removeEventListener=this.__proto__.removeEventListener,this._getListeners=this.__proto__._getListeners,e(n).bind("canplay durationchange",function(){if(isNaN(i.getDuration())||n.readyState<1)return;i.initialized||(i.initialized=!0),i.status=t.STATUS.PAUSED,i.triggerEvent(t.EVENTS.READY),i.waitToPlay&&i.play()}),e(n).bind("play",function(){if(!i.initialized)return;i.status=t.STATUS.PLAYING,i.triggerEvent(t.EVENTS.PLAY)}),e(n).bind("pause",function(){if(!i.initialized)return;i.status=t.STATUS.PAUSED,i.triggerEvent(t.EVENTS.PAUSE)}),e(n).bind("ended",function(){i.status=t.STATUS.ENDED,i.triggerEvent(t.EVENTS.ENDED)}),e(n).bind("seeking",function(){i.status=t.STATUS.SEEKING,i.triggerEvent(t.EVENTS.SEEKING)}),e(n).bind("timeupdate",function(){i.triggerEvent(t.EVENTS.TIMEUPDATE)}),e(n).bind("error",function(){i.status=t.STATUS.ERROR_NETWORK,i.triggerEvent(t.EVENTS.ERROR)}),this},this.play=function(){switch(i.status){case t.STATUS.INITIALIZING:case t.STATUS.LOADING:i.waitToPlay=!0;break;case t.STATUS.SEEKING:case t.STATUS.PAUSED:case t.STATUS.PLAYING:case t.STATUS.ENDED:n.play(),i.status=t.STATUS.PLAYING,i.waitToPlay=!1}},this.pause=function(){n.pause()},this.load=function(){i.initialized=!1,i.status=t.STATUS.INITIALIZING,n.load(),n.load()},this.setCurrentTime=function(e){n.currentTime=e},this.getCurrentTime=function(){return n.currentTime},this.getDuration=function(){return n.duration},this.getStatus=function(){return i.status},this.getHTMLTemplate=function(e){return'<div id="'+e+'"></div>'},i.init();throw"The given target element must not be null and have to be a vaild HTMLElement!"};return n}),define("annotations-tool-configuration",["jquery","underscore","roles","player_adapter_HTML5"],function(e,t,n,r){"use strict";var i={LAYOUT_CONFIGURATION:{DEFAULT:{timeline:!0,list:!0,annotate:!0}},localStorage:!0,localStorageOnlyModel:[],plugins:{Loop:function(e){require(["views/loop"],function(e){annotationsTool.loopView=new e})}},restEndpointsUrl:"../../extended-annotations",logoutUrl:undefined,exportUrl:"",playerAdapter:undefined,getLayoutConfiguration:function(){return this.LAYOUT_CONFIGURATION.DEFAULT},isStructuredAnnotationEnabled:function(){return!0},isFreeTextEnabled:function(){return!0},getVideoExtId:function(){return e("video")[0].id},getUserExtId:function(){return"default"},getUserRole:function(){return n.USER},getUserAuthToken:function(){return undefined},loadVideo:function(){annotationsTool.playerAdapter=new r(e("video")[0])}};return i}),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;o="undefined"!=typeof exports?exports:e.Backbone={},o.VERSION="0.9.9";var u=e._;!u&&"undefined"!=typeof require&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if("object"==typeof n)for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!a.test(n))return!0;n=n.split(a),i=0;for(var s=n.length;i<s;i++)e[t].apply(e,[n[i]].concat(r))}},l=function(e,t,n){var r,e=-1,i=t.length;switch(n.length){case 0:for(;++e<i;)(r=t[e]).callback.call(r.ctx);break;case 1:for(;++e<i;)(r=t[e]).callback.call(r.ctx,n[0]);break;case 2:for(;++e<i;)(r=t[e]).callback.call(r.ctx,n[0],n[1]);break;case 3:for(;++e<i;)(r=t[e]).callback.call(r.ctx,n[0],n[1],n[2]);break;default:for(;++e<i;)(r=t[e]).callback.apply(r.ctx,n)}},n=o.Events={on:function(e,t,n){return!f(this,"on",e,[t,n])||!t?this:(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this)},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events),a=0;for(l=o.length;a<l;a++)if(e=o[a],r=this._events[e]){s=[];if(t||n){c=0;for(h=r.length;c<h;c++)i=r[c],(t&&t!==(i.callback._callback||i.callback)||n&&n!==i.context)&&s.push(i)}this._events[e]=s}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(this,n,t),r&&l(this,r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,n||this,this),this},stopListening:function(e,t,n){var r=this._listeners;if(r){if(e)e.off(t,n,this),!t&&!n&&delete r[e._listenerId];else{for(var i in r)r[i].off(null,null,this);this._listeners={}}return this}}};n.bind=n.on,n.unbind=n.off,u.extend(o,n);var c=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.changed={},this.attributes={},this._changes=[],t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r)),(n=u.result(this,"defaults"))&&u.defaults(r,n),this.set(r,{silent:!0}),this._currentAttributes=u.clone(this.attributes),this._previousAttributes=u.clone(this.attributes),this.initialize.apply(this,arguments)};u.extend(c.prototype,n,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i;if(null==e)return this;u.isObject(e)?(i=e,n=t):(i={})[e]=t;var e=n&&n.silent,s=n&&n.unset;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var o=this.attributes;for(r in i)t=i[r],s?delete o[r]:o[r]=t,this._changes.push(r,t);return this._hasComputed=!1,e||this.change(n),this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={},n;for(n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},fetch:function(e){e=e?u.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r),e))return!1;n&&n(t,r,e)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s;null==e||u.isObject(e)?(r=e,n=t):null!=e&&((r={})[e]=t),n=n?u.clone(n):{};if(n.wait){if(r&&!this._validate(r,n))return!1;i=u.clone(this.attributes)}e=u.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?e:n)||!r&&!this._validate(null,n))return!1;var o=this,a=n.success;return n.success=function(e){s=!0;var t=o.parse(e);n.wait&&(t=u.extend(r||{},t));if(!o.set(t,n))return!1;a&&a(o,e,n)},t=this.isNew()?"create":n.patch?"patch":"update","patch"==t&&(n.attrs=r),t=this.sync(t,this,n),!s&&n.wait&&(this.clear(e),this.set(i,e)),t},destroy:function(e){var e=e?u.clone(e):{},t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e)};if(this.isNew())return e.success(),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||k();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(e){var t=this._changing;this._changing=!0;var n=this._computeChanges(!0);this._pending=!!n.length;for(var r=n.length-2;0<=r;r-=2)this.trigger("change:"+n[r],this,n[r+1],e);if(t)return this;for(;this._pending;)this._pending=!1,this.trigger("change",this,e),this._previousAttributes=u.clone(this.attributes);return this._changing=!1,this},hasChanged:function(e){return this._hasComputed||this._computeChanges(),null==e?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes,i;for(i in e)u.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},_computeChanges:function(e){this.changed={};for(var t={},n=[],r=this._currentAttributes,i=this._changes,s=i.length-2;0<=s;s-=2){var o=i[s],u=i[s+1];t[o]||(t[o]=!0,r[o]!==u&&(this.changed[o]=u,e&&(n.push(o,u),r[o]=u)))}return e&&(this._changes=[]),this._hasComputed=!0,n},previous:function(e){return null==e||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},_validate:function(e,t){if(!this.validate)return!0;var e=u.extend({},this.attributes,e),n=this.validate(e,t);return n?(t&&t.error&&t.error(this,n,t),this.trigger("error",this,n,t),!1):!0}});var h=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(h.prototype,n,{model:c,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){var n,i,o,a,f=t&&t.at,l=null==(t&&t.sort)?!0:t.sort,e=u.isArray(e)?e.slice():[e];for(n=e.length-1;0<=n;n--)(i=this._prepareModel(e[n],t))?(e[n]=i,(o=null!=i.id&&this._byId[i.id])||this._byCid[i.cid]?(t&&t.merge&&o&&(o.set(i.attributes,t),a=l),e.splice(n,1)):(i.on("all",this._onModelEvent,this),this._byCid[i.cid]=i,null!=i.id&&(this._byId[i.id]=i))):(this.trigger("error",this,e[n],t),e.splice(n,1));e.length&&(a=l),this.length+=e.length,n=[null!=f?f:this.models.length,0],r.apply(n,e),s.apply(this.models,n),a&&this.comparator&&null==f&&this.sort({silent:!0});if(t&&t.silent)return this;for(;i=e.shift();)i.trigger("add",i,this,t);return this},remove:function(e,t){var n,r,i,s;t||(t={}),e=u.isArray(e)?e.slice():[e],n=0;for(r=e.length;n<r;n++)if(s=this.get(e[n]))delete this._byId[s.id],delete this._byCid[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s);return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e]||this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return u.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),(!e||!e.silent)&&this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){var n,r,i,s,o=[],a=[],f={},l=this.model.prototype.idAttribute,t=u.extend({add:!0,merge:!0,remove:!0},t);t.parse&&(e=this.parse(e)),u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);r=0;for(i=e.length;r<i;r++)n=e[r],s=this.get(n.id||n.cid||n[l]),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove){r=0;for(i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||a.push(n)}return a.length&&this.remove(a,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){t[e.update?"update":"reset"](r,e),n&&n(t,r,e)},this.sync("read",this,e)},create:function(e,t){var n=this,t=t?u.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return u(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof c)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"===e||"remove"===e)&&n!==this||("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}}),u.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min sortedIndex toArray size first head take initial rest tail last without indexOf shuffle lastIndexOf isEmpty".split(" "),function(e){h.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}}),u.each(["groupBy","countBy","sortBy"],function(e){h.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var p=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},d=/\((.*?)\)/g,v=/:\w+/g,m=/\*\w+/g,g=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(p.prototype,n,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){r=this._extractParameters(e,r),n&&n.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r)),o.history.trigger("route",this,t,r)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes)for(var e,t=u.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(g,"\\$&").replace(d,"(?:$1)?").replace(v,"([^/]+)").replace(m,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var y=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},b=/^[#\/]|\s+$/g,w=/^\/+|\/+$/g,E=/msie [\w.]+/,S=/\/$/;y.started=!1,u.extend(y.prototype,n,{interval:50,getHash:function(e){return(e=(e||this).location.href.match(/#(.*)$/))?e[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){var e=this.location.pathname,n=this.root.replace(S,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(b,"")},start:function(e){if(y.started)throw Error("Backbone.history has already been started");y.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState);var e=this.getFragment(),t=document.documentMode,t=E.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t);this.root=("/"+this.root+"/").replace(w,"/"),t&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?o.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?o.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,e=this.location,t=e.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=this.getHash().replace(b,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),y.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe)));if(e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!y.started)return!1;if(!t||!0===t)t={trigger:t};e=this.getFragment(e||"");if(this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){n?(n=e.href.replace(/(javascript:|#).*$/,""),e.replace(n+"#"+t)):e.hash="#"+t}}),o.history=new y;var x=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},T=/^(\S+)\s*(.*)$/,N="model collection el id attributes className tagName events".split(" ");u.extend(x.prototype,n,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},make:function(e,t,n){return e=document.createElement(e),t&&o.$(e).attr(t),null!=n&&o.$(e).html(n),e},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=u.result(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw Error('Method "'+e[t]+'" does not exist');var r=t.match(T),i=r[1],r=r[2],n=u.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.bind(i,n):this.$el.delegate(r,i,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,N)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(u.result(this,"el"),!1);else{var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className")),this.setElement(this.make(u.result(this,"tagName"),e),!1)}}});var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=C[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||k()),null==n.data&&t&&("create"===e||"update"===e||"patch"===e)&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}"GET"!==i.type&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e,r,i){a&&a(e,r,i),t.trigger("sync",t,e,n)};var f=n.error;return n.error=function(e){f&&f(t,e,n),t.trigger("error",t,e,n)},e=o.ajax(u.extend(i,n)),t.trigger("request",t,e,n),e},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)},c.extend=h.extend=p.extend=x.extend=y.extend=function(e,t){var n=this,r;r=e&&u.has(e,"constructor")?e.constructor:function(){n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};var k=function(){throw Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),define("access",[],function(){"use strict";return{PRIVATE:0,PUBLIC:1,GROUP:2}}),define("models/comment",["jquery","access","backbone"],function(e,t,n){"use strict";var r=n.Model.extend({defaults:{created_at:null,created_by:null,updated_at:null,updated_by:null,deleted_at:null,deleted_by:null,access:t.PUBLIC},initialize:function(e){if(!e||_.isUndefined(e.text))throw"'text' attribute is required";e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),window.annotationsTool.localStorage&&(e.created_by||(e.created_by=annotationsTool.user.get("id")),e.created_by_nickname||(e.created_by_nickname=annotationsTool.user.get("nickname"))),e.tags&&(e.tags=this.parseJSONString(e.tags)),this.set(e)},parse:function(e){var t=e.attributes?e.attributes:e;return t.created_at=t.created_at!==null?Date.parse(t.created_at):null,t.updated_at=t.updated_at!==null?Date.parse(t.updated_at):null,t.deleted_at=t.deleted_at!==null?Date.parse(t.deleted_at):null,t.tags&&(t.tags=this.parseJSONString(t.tags)),e.attributes?e.attributes=t:e=t,e},validate:function(e){var n;e.id&&this.get("id")!==e.id&&(this.id=e.id,this.attributes.id=e.id,this.toCreate=!1);if(e.text&&!_.isString(e.text))return'"text" attribute must be a string!';if(e.tags&&_.isUndefined(this.parseJSONString(e.tags)))return'"tags" attribute must be a string or a JSON object';if(e.access&&!_.include(t,e.access))return'"access" attribute is not valid.';if(e.created_at){if((n=this.get("created_at"))&&n!==e.created_at)return'"created_at" attribute can not be modified after initialization!';if(!_.isNumber(e.created_at))return'"created_at" attribute must be a number!'}if(e.updated_at&&!_.isNumber(e.updated_at))return'"updated_at" attribute must be a number!';if(e.deleted_at&&!_.isNumber(e.deleted_at))return'"deleted_at" attribute must be a number!'},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn("Can not parse parameter '"+e+"': "+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e},toJSON:function(){var t=e.proxy(n.Model.prototype.toJSON,this)();return t.tags&&(t.tags=JSON.stringify(t.tags)),t}});return r}),function(e,t){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}function r(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}t.LocalStorage=window.Store=function(e){this.name=e;var t=this.localStorage().getItem(this.name);this.records=t&&t.split(",")||[]},e.extend(t.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||(e.id=r(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.records.push(e.id.toString()),this.save(),e.toJSON()},update:function(t){return this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),e.include(this.records,t.id.toString())||this.records.push(t.id.toString()),this.save(),t.toJSON()},find:function(e){return JSON.parse(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){return e(this.records).chain().map(function(e){return JSON.parse(this.localStorage().getItem(this.name+"-"+e))},this).compact().value()},destroy:function(t){return this.localStorage().removeItem(this.name+"-"+t.id),this.records=e.reject(this.records,function(e){return e==t.id.toString()}),this.save(),t},localStorage:function(){return localStorage}}),t.LocalStorage.sync=window.Store.sync=t.localSync=function(e,t,n){var r=t.localStorage||t.collection.localStorage,i,s=$.Deferred&&$.Deferred();switch(e){case"read":i=t.id!=undefined?r.find(t):r.findAll();break;case"create":i=r.create(t);break;case"update":i=r.update(t);break;case"delete":i=r.destroy(t)}return i?(n&&n.success&&n.success(i),s&&s.resolve()):(n&&n.error&&n.error("Record not found"),s&&s.reject()),s&&s.promise()},t.ajaxSync=t.sync,t.getSyncMethod=function(e){return e.localStorage||e.collection&&e.collection.localStorage?t.localSync:t.ajaxSync},t.sync=function(e,n,r){return t.getSyncMethod(n).apply(this,[e,n,r])}}(_,Backbone),define("localstorage",["backbone"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),define("collections/comments",["jquery","models/comment","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Comments"),initialize:function(e,t){_.bindAll(this,"setUrl"),this.setUrl(t)},parse:function(e){return e.comments&&_.isArray(e.comments)?e.comments:_.isArray(e)?e:null},setUrl:function(e){if(!e)throw"The parent annotation of the comments must be given!";e.collection&&(this.url=e.url()+"/comments"),window.annotationsTool&&annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url))}});return r}),define("models/annotation",["jquery","collections/comments","access","backbone","localstorage"],function(e,t,n,r){"use strict";var i=r.Model.extend({defaults:{access:n.PRIVATE,start:0,duration:0},initialize:function(e){var n;if(!e||_.isUndefined(e.start))throw'"start" attribute is required';e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),e.comments&&_.isArray(e.comments)?(this.attributes.comments=new t(e.comments,this),delete e.comments):e.comments?(this.attributes.comments=e.comments,delete e.comments):this.attributes.comments=new t([],this),e.id&&this.attributes.comments.fetch({async:!1}),window.annotationsTool.localStorage&&(e.created_by||(e.created_by=annotationsTool.user.get("id")),e.created_by_nickname||(e.created_by_nickname=annotationsTool.user.get("nickname")),n=function(){this.save()},this.attributes.comments.bind("change",n,this),this.attributes.comments.bind("remove",n,this)),e.tags&&(e.tags=this.parseJSONString(e.tags)),_.extend(this,r.Events),this.set(e)},parse:function(e){var n=e.attributes?e.attributes:e,r,i,s,o;n.created_at=n.created_at!==null?Date.parse(n.created_at):null,n.updated_at=n.updated_at!==null?Date.parse(n.updated_at):null,n.deleted_at=n.deleted_at!==null?Date.parse(n.deleted_at):null,n.tags&&(n.tags=this.parseJSONString(n.tags)),n.scaleValue&&(n.scalevalue=n.scaleValue,delete n.scaleValue),annotationsTool.user.get("id")===n.created_by?n.isMine=!0:n.isMine=!1;if(n.label){n.label.category&&(r=this.parseJSONString(n.label.category.settings))&&(n.label.category.settings=r);if(r=this.parseJSONString(n.label.settings))n.label.settings=r}return annotationsTool.localStorage&&_.isArray(n.comments)&&(n.comments=new t(n.comments,this)),!annotationsTool.localStorage&&n.label_id&&(_.isNumber(n.label_id)||_.isString(n.label_id))&&(i=annotationsTool.video.get("categories"),i.each(function(e){if(s=e.attributes.labels.get(n.label_id))return o=s,!0},this),n.label=o),!annotationsTool.localStorage&&n.scalevalue&&(n.scaleValue=n.scalevalue),e.attributes?e.attributes=n:e=n,e},validate:function(e){var t,r;e.id&&this.get("id")!==e.id&&(this.id=e.id,this.attributes.id=e.id,this.toCreate=!1,this.trigger("ready",this),this.setUrl(),r=this.attributes.comments,r&&r.length===0&&r.fetch({async:!1})),!annotationsTool.localStorage&&e.label&&(e.label.id?this.attributes.label_id=e.label.id:e.label.attributes&&(this.attributes.label_id=e.label.get("id")));if(e.start&&!_.isNumber(e.start))return'"start" attribute must be a number!';if(e.tags&&_.isUndefined(this.parseJSONString(e.tags)))return'"tags" attribute must be a string or a JSON object';if(e.text&&!_.isString(e.text))return'"text" attribute must be a string!';if(e.duration&&(!_.isNumber(e.duration)||_.isNumber(e.duration)&&e.duration<0))return'"duration" attribute must be a positive number';if(e.access&&!_.include(n,e.access))return'"access" attribute is not valid.';if(e.created_at){if((t=this.get("created_at"))&&t!==e.created_at)return'"created_at" attribute can not be modified after initialization!';if(!_.isNumber(e.created_at))return'"created_at" attribute must be a number!'}if(e.updated_at&&!_.isNumber(e.updated_at))return'"updated_at" attribute must be a number!';if(e.deleted_at&&!_.isNumber(e.deleted_at))return'"deleted_at" attribute must be a number!'},setUrl:function(){this.get("comments")&&this.get("comments").setUrl(this)},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn('Can not parse parameter "'+e+'": '+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e},toJSON:function(){var t=e.proxy(r.Model.prototype.toJSON,this)();return delete t.comments,t.tags&&(t.tags=JSON.stringify(t.tags)),t.label&&t.label.toJSON&&(t.label=t.label.toJSON()),t.scalevalue&&(t.scalevalue.attributes?t.scale_value_id=t.scalevalue.attributes.id:t.scalevalue.id&&(t.scale_value_id=t.scalevalue.id)),delete t.annotations,t}});return i}),define("collections/annotations",["jquery","models/annotation","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Annotations"),initialize:function(e,t){_.bindAll(this,"setUrl"),this.setUrl(t)},parse:function(e){return e.annotations&&_.isArray(e.annotations)?e.annotations:_.isArray(e)?e:null},setUrl:function(e){if(!e)throw"The parent track of the annotations must be given!";e.collection&&(this.url=e.url()+"/annotations"),window.annotationsTool&&annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url))}});return r}),define("models/label",["jquery","access","backbone"],function(e,t,n){"use strict";var r=n.Model.extend({defaults:{access:t.PUBLIC},initialize:function(e){if(!e||_.isUndefined(e.value))throw"'value' attribute is required";if(!e||_.isUndefined(e.abbreviation))throw"'abbreviation' attribute is required";if(!e||_.isUndefined(e.category))throw"'category' attribute is required";e.settings=this.parseSettings(e.settings),e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),e.category&&e.category.attributes&&(e.category=e.category.toJSON()),e.tags&&(e.tags=this.parseJSONString(e.tags)),this.set("category",e.category),this.set(e)},parse:function(e){var t=e.attributes?e.attributes:e;return t.created_at=t.created_at!==null?Date.parse(t.created_at):null,t.updated_at=t.updated_at!==null?Date.parse(t.updated_at):null,t.deleted_at=t.deleted_at!==null?Date.parse(t.deleted_at):null,t.settings=this.parseSettings(t.settings),t.category&&t.category.settings&&(t.category.settings=this.parseSettings(t.category.settings)),e.attributes?e.attributes=t:e=t,e},validate:function(e){var n;e.id&&this.get("id")!==e.id&&(this.id=e.id);if(e.value&&!_.isString(e.value))return"'value' attribute must be a string!";if(e.abbreviation&&!_.isString(e.abbreviation))return"'abbreviation' attribute must be a string!";if(e.description&&!_.isString(e.description))return"'description' attribute must be a string!";if(e.settings&&!_.isString(e.settings))return"'settings' attribute must be a string!";if(e.category&&!_.isObject(e.category))return"'category' attribute must be a JSON Object!";if(e.access&&!_.include(t,e.access))return"'access' attribute is not valid.";if(e.created_at){if((n=this.get("created_at"))&&n!==e.created_at)return"'created_at' attribute can not be modified after initialization!";if(!_.isNumber(e.created_at))return"'created_at' attribute must be a number!"}if(e.updated_at&&!_.isNumber(e.updated_at))return"'updated_at' attribute must be a number!";if(e.deleted_at&&!_.isNumber(e.deleted_at))return"'deleted_at' attribute must be a number!"},toJSON:function(){var t=e.proxy(n.Model.prototype.toJSON,this)();return t.tags&&(t.tags=JSON.stringify(t.tags)),t.category&&t.category.toJSON&&(t.category=t.category.toJSON()),t},toExportJSON:function(){var e={value:this.attributes.value,abbreviation:this.attributes.abbreviation};return this.attributes.tags&&(e.tags=JSON.stringify(this.attributes.tags)),this.attributes.description&&(e.description=this.attributes.description),this.attributes.settings&&(e.settings=this.attributes.settings),this.attributes.tags&&(e.tags=this.attributes.tags),e},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn("Can not parse parameter '"+e+"': "+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e},parseSettings:function(e){return e&&_.isString(e)&&(e=JSON.parse(e)),e}});return r}),define("collections/labels",["jquery","models/label","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Labels"),initialize:function(e,t){_.bindAll(this,"setUrl","toExportJSON"),this.setUrl(t)},parse:function(e){return e.labels&&_.isArray(e.labels)?e.labels:_.isArray(e)?e:null},toExportJSON:function(){var e=[];return this.each(function(t){e.push(t.toExportJSON())}),e},setUrl:function(e){if(!e)throw"The parent category of the labels must be given!";e.collection&&(this.url=e.url()+"/labels"),window.annotationsTool&&annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url))}});return r}),define("models/category",["jquery","collections/labels","access","backbone","localstorage"],function(e,t,n,r){"use strict";var i=r.Model.extend({defaults:{access:n.PRIVATE,created_at:null,created_by:null,updated_at:null,updated_by:null,deleted_at:null,deleted_by:null,has_duration:!0},initialize:function(e){_.bindAll(this,"setUrl","validate","toExportJSON");if(!e||_.isUndefined(e.name))throw'"name" attribute is required';e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),window.annotationsTool.localStorage&&(e.created_by||(e.created_by=annotationsTool.user.get("id"),e.created_by_nickname=annotationsTool.user.get("nickname"))),e.tags&&(e.tags=this.parseJSONString(e.tags)),e.settings?(e.settings=this.parseJSONString(e.settings),e.settings.hasScale===undefined&&(e.settings.hasScale=!0)):e.settings={hasScale:!0},annotationsTool.user.get("id")===e.created_by?e.isMine=!0:e.isMine=!1,e.access===n.PUBLIC?e.isPublic=!0:e.isPublic=!1,e.labels&&_.isArray(e.labels)?(this.attributes.labels=new t(e.labels,this),delete e.labels):e.labels?_.isObject(e.labels)&&e.labels.model&&(this.attributes.labels=new t(e.labels.models,this),delete e.labels):this.attributes.labels=new t([],this),e.id&&this.attributes.labels.fetch({async:!1}),this.set(e)},parse:function(e){var r=e.attributes?e.attributes:e;return r.created_at=r.created_at!==null?Date.parse(r.created_at):null,r.updated_at=r.updated_at!==null?Date.parse(r.updated_at):null,r.deleted_at=r.deleted_at!==null?Date.parse(r.deleted_at):null,r.settings&&(r.settings=this.parseJSONString(r.settings)),annotationsTool.user.get("id")===r.created_by?r.isMine=!0:r.isMine=!1,r.access===n.PUBLIC?r.isPublic=!0:r.isPublic=!1,r.tags&&(r.tags=this.parseJSONString(r.tags)),r.category&&(r.category=this.parseJSONString(r.category.settings)),r.tags&&(r.tags=this.parseJSONString(r.tags)),annotationsTool.localStorage&&_.isArray(r.labels)&&(r.labels=new t(r.labels,this)),!annotationsTool.localStorage&&r.scale_id&&(_.isNumber(r.scale_id)||_.isString(r.scale_id))&&(r.scale=annotationsTool.video.get("scales").get(r.scale_id)),e.attributes?e.attributes=r:e=r,e},validate:function(e){var t,r=this;e.id&&(this.get("id")!==e.id&&(this.id=e.id,this.setUrl(e.labels)),!this.ready&&e.labels&&e.labels.url&&e.labels.length===0&&e.labels.fetch({async:!1,success:function(){r.ready=!0}}));if(e.description&&!_.isString(e.description))return'"description" attribute must be a string';if(e.settings&&!_.isObject(e.settings)&&!_.isString(e.settings))return'"description" attribute must be a string or a JSON object';if(e.tags&&_.isUndefined(this.parseJSONString(e.tags)))return'"tags" attribute must be a string or a JSON object';if(!_.isUndefined(e.access)){if(!_.include(n,e.access))return'"access" attribute is not valid.';this.attributes.access!==e.access&&(e.access===n.PUBLIC?this.attributes.isPublic=!0:this.attributes.isPublic=!1)}if(e.created_at){if((t=this.get("created_at"))&&t!==e.created_at)return'"created_at" attribute can not be modified after initialization!';if(!_.isNumber(e.created_at))return'"created_at" attribute must be a number!'}if(e.updated_at&&!_.isNumber(e.updated_at))return'"updated_at" attribute must be a number!';if(e.deleted_at&&!_.isNumber(e.deleted_at))return'"deleted_at" attribute must be a number!';e.labels&&e.labels.each(function(e){var t=e.parse({category:this.toJSON()});t.category&&(t=t.category),e.category=t},this)},setColor:function(e){var t=this.attributes.settings;t.color=e,this.set("settings",t)},setUrl:function(e){e&&e.setUrl(this)},toJSON:function(){var e=r.Model.prototype.toJSON.call(this);return e.tags&&(e.tags=JSON.stringify(e.tags)),delete e.labels,this.attributes.scale&&(this.attributes.scale.attributes?e.scale_id=this.attributes.scale.get("id"):e.scale_id=this.attributes.scale.id,annotationsTool.localStorage||delete e.scale),e},toExportJSON:function(){var e={name:this.attributes.name,labels:this.attributes.labels.toExportJSON()};return this.attributes.tags&&(e.tags=JSON.stringify(this.attributes.tags)),this.attributes.description&&(e.description=this.attributes.description),this.attributes.has_duration&&(e.has_duration=this.attributes.has_duration),this.attributes.scale_id&&(e.scale_id=this.attributes.scale_id),this.attributes.settings&&(e.settings=this.attributes.settings),this.attributes.tags&&(e.tags=this.attributes.tags),e},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn('Can not parse parameter "'+e+'": '+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e},save:function(e){this.attributes.settings=JSON.stringify(this.attributes.settings),r.Model.prototype.save.call(this,e)}});return i}),define("collections/categories",["jquery","models/category","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Categories"),initialize:function(e,t){_.bindAll(this,"setUrl","addCopyFromTemplate","toExportJSON"),this.setUrl(t)},parse:function(e){return e.categories&&_.isArray(e.categories)?e.categories:_.isArray(e)?e:null},setUrl:function(e){!e||!e.collection?(this.url=window.annotationsTool.restEndpointsUrl+"/categories",this.isTemplate=!0):(this.url=e.url()+"/categories",this.isTemplate=!1),annotationsTool&&annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url)),this.each(function(e){e.setUrl()})},getMine:function(){return this.where({isMine:!0})},getPublic:function(){return this.where({isPublic:!0})},toExportJSON:function(){var e=[];return this.each(function(t){e.push(t.toExportJSON())}),e},addCopyFromTemplate:function(e){if(!this.isTemplate&&!_.isArray(e)&&e.id){var t=e.toJSON();return delete t.id,delete t.created_at,delete t.created_by,delete t.updated_at,delete t.updated_by,delete t.deleted_by,delete t.deleted_at,delete t.labels,t.copyUrl="?category_id="+e.id,annotationsTool.localStorage?this.create(t):this.create(t,{wait:!0})}return null}});return r}),define("models/scalevalue",["jquery","access","backbone"],function(e,t,n){"use strict";var r=n.Model.extend({defaults:{access:t.PRIVATE,created_at:null,created_by:null,updated_at:null,updated_by:null,deleted_at:null,deleted_by:null},initialize:function(e){if(!e||_.isUndefined(e.name)||e.name===""||_.isUndefined(e.value)||!_.isNumber(e.value)||_.isUndefined(e.order)||!_.isNumber(e.order))throw"'name, value, order' attributes are required";e.id||(this.toCreate=!0),e.id||(window.annotationsTool.localStorage&&this.set({id:this.cid}),this.toCreate=!0),this.set(e)},parse:function(e){return e.created_at=e.created_at!==null?Date.parse(e.created_at):null,e.updated_at=e.updated_at!==null?Date.parse(e.updated_at):null,e.deleted_at=e.deleted_at!==null?Date.parse(e.deleted_at):null,e},validate:function(e){var n;e.id&&this.get("id")!==e.id&&(e.id=this.cid);if(e.name&&!_.isString(e.name))return"'name' attribute must be a string";if(e.value&&!_.isNumber(e.value))return"'value' attribute must be a number";if(e.order&&!_.isNumber(e.order))return"'order' attribute must be a number";if(e.access&&!_.include(t,e.access))return"'access' attribute is not valid.";if(e.created_at){if((n=this.get("created_at"))&&n!==e.created_at)return"'created_at' attribute can not be modified after initialization!";if(!_.isNumber(e.created_at))return"'created_at' attribute must be a number!"}if(e.updated_at&&!_.isNumber(e.updated_at))return"'updated_at' attribute must be a number!";if(e.deleted_at&&!_.isNumber(e.deleted_at))return"'deleted_at' attribute must be a number!"},toJSON:function(){var t=e.proxy(n.Model.prototype.toJSON,this)();return t.scale&&t.scale.attributes&&(t.scale=this.attributes.scale.toJSON()),t},toExportJSON:function(){var e={name:this.attributes.name,value:this.attributes.value,order:this.attributes.order};return e.scale&&e.scale.attributes&&(e.scale=this.attributes.scale.toJSON()),e}});return r}),define("collections/scalevalues",["jquery","models/scalevalue","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("ScaleValue"),initialize:function(e,t){_.bindAll(this,"setUrl","toExportJSON"),this.scale=t,this.setUrl(t)},parse:function(e){return e.scaleValues&&_.isArray(e.scaleValues)?e.scaleValues:_.isArray(e)?e:null},comparator:function(e){return e.get("order")},toExportJSON:function(){var e=[];return this.each(function(t){e.push(t.toExportJSON())}),e},setUrl:function(e){if(!e&&!this.scale)throw"The parent scale of the scale value must be given!";e&&e.collection?this.url=e.url()+"/scalevalues":this.scale.collection&&(this.url=this.scale.url()+"/scalevalues"),annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url))}});return r}),define("models/scale",["jquery","access","collections/scalevalues","backbone"],function(e,t,n,r){"use strict";var i=r.Model.extend({defaults:{created_at:null,created_by:null,updated_at:null,updated_by:null,deleted_at:null,deleted_by:null,access:t.PRIVATE},initialize:function(e){_.bindAll(this,"toExportJSON");if(!e||_.isUndefined(e.name)||e.name==="")throw"'name' attribute is required";e.scaleValues&&_.isArray(e.scaleValues)?this.set({scaleValues:new n(e.scaleValues,this)}):this.set({scaleValues:new n([],this)}),e.id&&this.attributes.scaleValues.fetch({async:!1}),window.annotationsTool.localStorage&&(e.created_by||(e.created_by=annotationsTool.user.get("id")),e.created_by_nickname||(e.created_by_nickname=annotationsTool.user.get("nickname"))),annotationsTool.user.get("id")===e.created_by?e.isMine=!0:e.isMine=!1,e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),e.tags&&(e.tags=this.parseJSONString(e.tags)),this.set(e)},parse:function(e){return e.created_at=e.created_at!==null?Date.parse(e.created_at):null,e.updated_at=e.updated_at!==null?Date.parse(e.updated_at):null,e.deleted_at=e.deleted_at!==null?Date.parse(e.deleted_at):null,annotationsTool.user.get("id")===e.created_by?e.isMine=!0:e.isMine=!1,e.tags&&(e.tags=this.parseJSONString(e.tags)),e},validate:function(e){var n,r;e.id&&this.get("id")!==e.id&&(this.id=e.id,this.setUrl(),r=this.attributes.scaleValues,r&&r.length===0&&r.fetch({async:!1}));if(e.name&&!_.isString(e.name))return"'name' attribute must be a string";if(e.description&&!_.isString(e.description))return"'description' attribute must be a string";if(e.access&&!_.include(t,e.access))return"'access' attribute is not valid.";if(e.created_at){if((n=this.get("created_at"))&&n!==e.created_at)return"'created_at' attribute can not be modified after initialization!";if(!_.isNumber(e.created_at))return"'created_at' attribute must be a number!"}if(e.updated_at&&!_.isNumber(e.updated_at))return"'updated_at' attribute must be a number!";if(e.deleted_at&&!_.isNumber(e.deleted_at))return"'deleted_at' attribute must be a number!"},toJSON:function(){var e=r.Model.prototype.toJSON.call(this);return e.tags&&(e.tags=JSON.stringify(e.tags)),delete e.scaleValues,e},toExportJSON:function(){var e={id:this.id,name:this.attributes.name,scaleValues:this.attributes.scaleValues.toExportJSON()};return this.attributes.tags&&(e.tags=JSON.stringify(this.attributes.tags)),this.attributes.description&&(e.description=this.attributes.description),e},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn("Can not parse parameter '"+e+"': "+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e},setUrl:function(){this.attributes.scaleValues&&this.attributes.scaleValues.setUrl(this)}});return i}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){var n=l.readFileSync(e,"utf8");n.indexOf("ï»¿")===0&&(n=n.substring(1)),t(n)}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"1.0.6",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&(u[e]=n),r(n)},load:function(e,t,n,u){if(u.isBuild&&!u.inlineText)n();else{var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})}},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("text!templates/annotate-label.tmpl",[],function(){return'<span class="item-abbreviation read-only" title="{{abbreviation}}">{{abbreviation}}</span>\n<input class="item-abbreviation edit" type="text" value="{{abbreviation}}" {{#if notEdit}}disabled=\'disabled\'{{/if}}/> \n<input class="item-value edit" type="text" value="{{value}}" placeholder="Label value..." {{#if notEdit}}disabled=\'disabled\'{{/if}}/> \n<span class="item-icon">{{icon}}</span>\n<i class="icon-trash delete edit"></i>\n<ul class="scaling">\n{{#each scaleValues}}\n	<li value="{{this.id}}" title="{{this.name}}" >{{this.name}}</li>\n{{/each}}\n</ul>\n'});var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(e,t,n){n&&(t.not=n),this.helpers[e]=t},Handlebars.registerPartial=function(e,t){this.partials[e]=t},Handlebars.registerHelper("helperMissing",function(e){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+e+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(e,t){var n=t.inverse||function(){},r=t.fn,i="",s=toString.call(e);s===functionType&&(e=e.call(this));if(e===!0)return r(this);if(e===!1||e==null)return n(this);if(s==="[object Array]"){if(e.length>0)for(var o=0,u=e.length;o<u;o++)i+=r(e[o]);else i=n(this);return i}return r(e)}),Handlebars.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i="";if(e&&e.length>0)for(var s=0,o=e.length;s<o;s++)i+=n(e[s]);else i=r(this);return i}),Handlebars.registerHelper("if",function(e,t){var n=toString.call(e);return n===functionType&&(e=e.call(this)),!e||Handlebars.Utils.isEmpty(e)?t.inverse(this):t.fn(this)}),Handlebars.registerHelper("unless",function(e,t){var n=t.fn,r=t.inverse;return t.fn=r,t.inverse=n,Handlebars.helpers["if"].call(this,e,t)}),Handlebars.registerHelper("with",function(e,t){return t.fn(e)}),Handlebars.registerHelper("log",function(e){Handlebars.log(e)});var handlebars=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:return o[a-1];case 2:this.$=new i.ProgramNode(o[a-2],o[a]);break;case 3:this.$=new i.ProgramNode(o[a]);break;case 4:this.$=new i.ProgramNode([]);break;case 5:this.$=[o[a]];break;case 6:o[a-1].push(o[a]),this.$=o[a-1];break;case 7:this.$=new i.InverseNode(o[a-2],o[a-1],o[a]);break;case 8:this.$=new i.BlockNode(o[a-2],o[a-1],o[a]);break;case 9:this.$=o[a];break;case 10:this.$=o[a];break;case 11:this.$=new i.ContentNode(o[a]);break;case 12:this.$=new i.CommentNode(o[a]);break;case 13:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 14:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 15:this.$=o[a-1];break;case 16:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 17:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1],!0);break;case 18:this.$=new i.PartialNode(o[a-1]);break;case 19:this.$=new i.PartialNode(o[a-2],o[a-1]);break;case 20:break;case 21:this.$=[[o[a-2]].concat(o[a-1]),o[a]];break;case 22:this.$=[[o[a-1]].concat(o[a]),null];break;case 23:this.$=[[o[a-1]],o[a]];break;case 24:this.$=[[o[a]],null];break;case 25:o[a-1].push(o[a]),this.$=o[a-1];break;case 26:this.$=[o[a]];break;case 27:this.$=o[a];break;case 28:this.$=new i.StringNode(o[a]);break;case 29:this.$=new i.IntegerNode(o[a]);break;case 30:this.$=new i.BooleanNode(o[a]);break;case 31:this.$=new i.HashNode(o[a]);break;case 32:o[a-1].push(o[a]),this.$=o[a-1];break;case 33:this.$=[o[a]];break;case 34:this.$=[o[a-2],o[a]];break;case 35:this.$=[o[a-2],new i.StringNode(o[a])];break;case 36:this.$=[o[a-2],new i.IntegerNode(o[a])];break;case 37:this.$=[o[a-2],new i.BooleanNode(o[a])];break;case 38:this.$=new i.IdNode(o[a]);break;case 39:o[a-2].push(o[a]),this.$=o[a-2];break;case 40:this.$=[o[a]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function(t,n){throw new Error(t)},parse:function(t){function d(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function v(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var m,g,y,b,w,E,S={},x,T,N,C;for(;;){y=r[r.length-1],this.defaultActions[y]?b=this.defaultActions[y]:(m==null&&(m=v()),b=o[y]&&o[y][m]);if(typeof b=="undefined"||!b.length||!b[0])if(!l){C=[];for(x in o[y])this.terminals_[x]&&x>2&&C.push("'"+this.terminals_[x]+"'");var k="";this.lexer.showPosition?k="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+C.join(", ")+", got '"+this.terminals_[m]+"'":k="Parse error on line "+(a+1)+": Unexpected "+(m==1?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:p,expected:C})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+m);switch(b[0]){case 1:r.push(m),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(b[1]),m=null,g?(m=g,g=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:T=this.productions_[b[1]][1],S.$=i[i.length-T],S._$={first_line:s[s.length-(T||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(T||1)].first_column,last_column:s[s.length-1].last_column},E=this.performAction.call(S,u,f,a,this.yy,b[1],i,s);if(typeof E!="undefined")return E;T&&(r=r.slice(0,-1*T*2),i=i.slice(0,-1*T),s=s.slice(0,-1*T)),r.push(this.productions_[b[1]][0]),i.push(S.$),s.push(S._$),N=o[r[r.length-2]][r[r.length-1]],r.push(N);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e;var t=e.match(/\n/);return t&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r;this._more||(this.yytext="",this.match="");var i=this._currentRules();for(var s=0;s<i.length;s++){t=this._input.match(this.rules[i[s]]);if(t){r=t[0].match(/\n.*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,i[s],this.conditionStack[this.conditionStack.length-1]);if(e)return e;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:n.yytext.slice(-1)!=="\\"&&this.begin("mu"),n.yytext.slice(-1)==="\\"&&(n.yytext=n.yytext.substr(0,n.yyleng-1),this.begin("emu"));if(n.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return n.yytext=n.yytext.substr(3,n.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return n.yytext=n.yytext.substr(1,n.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return n.yytext=n.yytext.substr(1,n.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},e.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],e.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},e}();return e.lexer=t,e}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");if(typeof process!="undefined")var n=require("fs").readFileSync(require("path").join(process.cwd(),t[1]),"utf8");else var r=require("file").path(require("file").cwd()),n=r.join(t[1]).read({charset:"utf-8"});return exports.parser.parse(n)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(e){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(e)},Handlebars.print=function(e){return(new Handlebars.PrintVisitor).accept(e)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){}},Handlebars.log=function(e,t){Handlebars.logger.log(e,t)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(e,t){this.type="program",this.statements=e,t&&(this.inverse=new Handlebars.AST.ProgramNode(t))},Handlebars.AST.MustacheNode=function(e,t,n){this.type="mustache",this.id=e[0],this.params=e.slice(1),this.hash=t,this.escaped=!n},Handlebars.AST.PartialNode=function(e,t){this.type="partial",this.id=e,this.context=t};var e=function(e,t){if(e.original!==t.original)throw new Handlebars.Exception(e.original+" doesn't match "+t.original)};Handlebars.AST.BlockNode=function(t,n,r){e(t.id,r),this.type="block",this.mustache=t,this.program=n},Handlebars.AST.InverseNode=function(t,n,r){e(t.id,r),this.type="inverse",this.mustache=t,this.program=n},Handlebars.AST.ContentNode=function(e){this.type="content",this.string=e},Handlebars.AST.HashNode=function(e){this.type="hash",this.pairs=e},Handlebars.AST.IdNode=function(e){this.type="ID",this.original=e.join(".");var t=[],n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];s===".."?n++:s==="."||s==="this"?this.isScoped=!0:t.push(s)}this.parts=t,this.string=t.join("."),this.depth=n,this.isSimple=t.length===1&&n===0},Handlebars.AST.StringNode=function(e){this.type="STRING",this.string=e},Handlebars.AST.IntegerNode=function(e){this.type="INTEGER",this.integer=e},Handlebars.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e},Handlebars.AST.CommentNode=function(e){this.type="comment",this.comment=e}}(),Handlebars.Exception=function(e){var t=Error.prototype.constructor.apply(this,arguments);for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);this.message=t.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(e){this.string=e},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,r=function(t){return e[t]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){return e instanceof Handlebars.SafeString?e.toString():e==null||e===!1?"":n.test(e)?e.replace(t,r):e},isEmpty:function(e){return typeof e=="undefined"?!0:e===null?!0:e===!1?!0:Object.prototype.toString.call(e)==="[object Array]"&&e.length===0?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(e,t){e.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16},e.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1},e.DISASSEMBLE_MAP={};for(var n in e.OPCODE_MAP){var r=e.OPCODE_MAP[n];e.DISASSEMBLE_MAP[r]=n}e.multiParamSize=function(t){return e.MULTI_PARAM_OPCODES[e.DISASSEMBLE_MAP[t]]},e.prototype={compiler:e,disassemble:function(){var t=this.opcodes,n,r,i=[],s,o,u;for(var a=0,f=t.length;a<f;a++){n=t[a];if(n==="DECLARE")o=t[++a],u=t[++a],i.push("DECLARE "+o+" = "+u);else{s=e.DISASSEMBLE_MAP[n];var l=e.multiParamSize(n),c=[];for(var h=0;h<l;h++)r=t[++a],typeof r=="string"&&(r='"'+r.replace("\n","\\n")+'"'),c.push(r);s=s+" "+c.join(" "),i.push(s)}}return i.join("\n")},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t=e.statements,n;this.opcodes=[];for(var r=0,i=t.length;r<i;r++)n=t[r],this[n.type](n);return this.isSimple=i===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var r=0,i=t.depths.list.length;r<i;r++){depth=t.depths.list[r];if(depth<2)continue;this.addDepth(depth-1)}return n},block:function(e){var t=e.mustache,n,r,i,s,o=this.setupStackForMustache(t),u=this.compileProgram(e.program);e.program.inverse&&(s=this.compileProgram(e.program.inverse),this.declare("inverse",s)),this.opcode("invokeProgram",u,o.length,!!t.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(e){var t=this.setupStackForMustache(e.mustache),n=this.compileProgram(e.program);this.declare("inverse",n),this.opcode("invokeProgram",null,t.length,!!e.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("push","{}");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.accept(r),this.opcode("assignToHash",n[0])},partial:function(e){var t=e.id;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.original),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.setupStackForMustache(e);this.opcode("invokeMustache",t.length,e.id.original,!!e.hash),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("lookupWithHelpers",e.parts[0]||null,e.isScoped||!1);for(var t=1,n=e.parts.length;t<n;t++)this.opcode("lookup",e.parts[t])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("push",e.integer)},BOOLEAN:function(e){this.opcode("push",e.bool)},comment:function(){},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.string)):this[n.type](n)},opcode:function(t,n,r,i){this.opcodes.push(e.OPCODE_MAP[t]),n!==undefined&&this.opcodes.push(n),r!==undefined&&this.opcodes.push(r),i!==undefined&&this.opcodes.push(i)},declare:function(e,t){this.opcodes.push("DECLARE"),this.opcodes.push(e),this.opcodes.push(t)},addDepth:function(e){if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},setupStackForMustache:function(e){var t=e.params;return this.pushParams(t),e.hash&&this.hash(e.hash),this.ID(e.id),t}},t.prototype={nameLookup:function(e,n,r){return/^[0-9]+$/.test(n)?e+"["+n+"]":t.isValidJavaScriptVariableName(n)?e+"."+n:e+"['"+n+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":"buffer += "+e+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(e,t);var i=e.opcodes,s;this.i=0;for(u=i.length;this.i<u;this.i++)s=this.nextOpcode(0),s[0]==="DECLARE"?(this.i=this.i+2,this[s[1]]=s[2]):(this.i=this.i+s[1].length,this[s[0]].apply(this,s[1]));return this.createFunctionContext(r)},nextOpcode:function(t){var n=this.environment.opcodes,r=n[this.i+t],i,s,o,u;if(r==="DECLARE")return i=n[this.i+1],s=n[this.i+2],["DECLARE",i,s];i=e.DISASSEMBLE_MAP[r],o=e.multiParamSize(r),u=[];for(var a=0;a<o;a++)u.push(n[this.i+a+1+t]);return[i,u]},eat:function(e){this.i=this.i+e.length},preamble:function(){var e=[];this.useRegister("foundHelper");if(!this.isChild){var t=this.namespace,n="helpers = helpers || "+t+".helpers;";this.environment.usePartial&&(n=n+" partials = partials || "+t+".partials;"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars;this.isChild||(t=t.concat(this.context.registers.list)),t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", "));if(!this.isChild){var n=[];for(var r in this.context.aliases)this.source[1]=this.source[1]+", "+r+"="+this.context.aliases[r]}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var s=0,o=this.environment.depths.list.length;s<o;s++)i.push("depth"+this.environment.depths.list[s]);if(e)return i.push(this.source.join("\n  ")),Function.apply(this,i);var u="function "+(this.name||"")+"("+i.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,u+"\n\n"),u},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var e=this.nextOpcode(1),t="";this.context.aliases.escapeExpression="this.escapeExpression",e[0]==="appendContent"&&(t=" + "+this.quotedString(e[1][0]),this.eat(e)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+t))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupWithHelpers:function(e,t){if(e){var n=this.nextStack();this.usingKnownHelper=!1;var r;!t&&this.options.knownHelpers[e]?(r=n+" = "+this.nameLookup("helpers",e,"helper"),this.usingKnownHelper=!0):t||this.options.knownHelpersOnly?r=n+" = "+this.nameLookup("depth"+this.lastContext,e,"context"):(this.register("foundHelper",this.nameLookup("helpers",e,"helper")),r=n+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,e,"context")),r+=";",this.source.push(r)}else this.pushStack("depth"+this.lastContext)},lookup:function(e){var t=this.topStack();this.source.push(t+" = ("+t+" === null || "+t+" === undefined || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")+");")},pushStringParam:function(e){this.pushStack("depth"+this.lastContext),this.pushString(e)},pushString:function(e){this.pushStack(this.quotedString(e))},push:function(e){this.pushStack(e)},invokeMustache:function(e,t,n){this.populateParams(e,this.quotedString(t),"{}",null,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+n+"=== undef) { "+e+" = helperMissing.call("+t+"); }"),e!==n&&this.source.push("else { "+e+" = "+n+"; }"))})},invokeProgram:function(e,t,n){var r=this.programExpression(this.inverse),i=this.programExpression(e);this.populateParams(t,null,i,r,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+e+" = blockHelperMissing.call("+t+"); }"))})},populateParams:function(e,t,n,r,i,s){var o=i||this.options.stringParams||r||this.options.data,u=this.popStack(),a,f=[],l,c,h;o?(this.register("tmp1",n),h="tmp1"):h="{ hash: {} }";if(o){var p=i?this.popStack():"{}";this.source.push("tmp1.hash = "+p+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var d=0;d<e;d++)l=this.popStack(),f.push(l),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");r&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+r+";")),this.options.data&&this.source.push("tmp1.data = data;"),f.push(h),this.populateCall(f,u,t||u,s,n!=="{}")},populateCall:function(e,t,n,r,i){var s=["depth0"].concat(e).join(", "),o=["depth0"].concat(n).concat(e).join(", "),u=this.nextStack();if(this.usingKnownHelper)this.source.push(u+" = "+t+".call("+s+");");else{this.context.aliases.functionType='"function"';var a=i?"foundHelper && ":"";this.source.push("if("+a+"typeof "+t+" === functionType) { "+u+" = "+t+".call("+s+"); }")}r.call(this,u,o,t),this.usingKnownHelper=!1},invokePartial:function(e){params=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(e){var t=this.popStack(),n=this.topStack();this.source.push(n+"['"+e+"'] = "+t+";")},compiler:t,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler,this.context.programs.push("");var u=this.context.programs.length;r.index=u,r.name="program"+u,this.context.programs[u]=i.compile(r,t,this.context)}},programExpression:function(e){if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r=[t.index,t.name,"data"];for(var i=0,s=n.length;i<s;i++)depth=n[i],depth===1?r.push("depth0"):r.push("depth"+(depth-1));return n.length===0?"self.program("+r.join(", ")+")":(r.shift(),"self.programWithDepth("+r.join(", ")+")")},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.context.registers[e]||(this.context.registers[e]=!0,this.context.registers.list.push(e))},pushStack:function(e){return this.source.push(this.nextStack()+" = "+e+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),s=t.RESERVED_WORDS={};for(var o=0,u=i.length;o<u;o++)s[i[o]]=!0;t.isValidJavaScriptVariableName=function(e){return!t.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(e,t){t=t||{};var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t);return(new Handlebars.JavaScriptCompiler).compile(r,t)},Handlebars.compile=function(e,t){function r(){var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t),i=(new Handlebars.JavaScriptCompiler).compile(r,t,undefined,!0);return Handlebars.template(i)}t=t||{};var n;return function(e,t){return n||(n=r()),n.call(this,e,t)}},Handlebars.VM={template:function(e){var t={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(e,t,n){var r=this.programs[e];return n?Handlebars.VM.program(t,n):r?r:(r=this.programs[e]=Handlebars.VM.program(t),r)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(n,r){return r=r||{},e.call(t,Handlebars,n,r.helpers,r.partials,r.data)}},programWithDepth:function(e,t,n){var r=Array.prototype.slice.call(arguments,2);return function(n,i){return i=i||{},e.apply(this,[n,i.data||t].concat(r))}},program:function(e,t){return function(n,r){return r=r||{},e(n,r.data||t)}},noop:function(){return""},invokePartial:function(e,t,n,r,i,s){options={helpers:r,partials:i,data:s};if(e===undefined)throw new Handlebars.Exception("The partial "+t+" could not be found");if(e instanceof Function)return e(n,options);if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+t+" could not be compiled when running in runtime-only mode");return i[t]=Handlebars.compile(e),i[t](n,options)}},Handlebars.template=Handlebars.VM.template,define("handlebars",function(e){return function(){var t,n;return t||e.Handlebars}}(this)),define("views/annotate-label",["jquery","models/annotation","text!templates/annotate-label.tmpl","handlebars","backbone"],function(e,t,n,r,i){"use strict";var s=i.View.extend({CLASS_SCALE:{ENABLED:"scale-enabled",DISABLED:"scale-disabled"},tagName:"div",className:"label-item",ID_PREFIX:"labelItem-",deleted:!1,editModus:!1,labels:[],template:r.compile(n),events:{click:"annotate","click i.delete":"onDeleteLabel","focusout .item-value":"onFocusOut","keydown .item-value":"onKeyDown","focusout .item-abbreviation":"onFocusOut","keydown .item-abbreviation":"onKeyDown","click .scaling li":"annnotateWithScaling"},initialize:function(e){var t;if(!e.label||!_.isObject(e.label))throw"Label object must be given as constuctor attribute!";return _.bindAll(this,"render","annotate","switchEditModus","onSwitchEditModus","onFocusOut","onKeyDown","onDeleteLabel","annnotateWithScaling","changeCategory"),this.typeForDelete=annotationsTool.deleteOperation.targetTypes.LABEL,e.editModus&&(this.editModus=e.editModus),this.model=e.label,this.roles=e.roles,this.isScaleEnable=e.isScaleEnable,_.extend(this.model,i.Events),this.el.id=this.ID_PREFIX+this.model.get("id"),this.listenTo(this.model,"change",this.render),t=this.model.get("category").scale_id,!t&&this.model.get("category").scale&&(t=this.model.get("category").scale.id),this.scaleValues=annotationsTool.video.get("scales").get(t),this.scaleValues&&(this.scaleValues=this.scaleValues.get("scaleValues")),_.contains(this.roles,annotationsTool.user.get("role"))&&this.listenTo(annotationsTool.video,"switchEditModus",this.onSwitchEditModus),this.render()},annnotateWithScaling:function(e){e.stopImmediatePropagation();var t=e.target.getAttribute("value"),n=this.scaleValues.get(t),r=Math.round(annotationsTool.playerAdapter.getCurrentTime()),i,s={},o={text:this.model.get("value"),start:r,label:this.model,scalevalue:n.toJSON()};if(this.editModus||!_.isNumber(r)||r<0)return;annotationsTool.user&&(o.created_by=annotationsTool.user.id),annotationsTool.localStorage||(s.wait=!0),i=annotationsTool.selectedTrack.get("annotations").create(o,s),annotationsTool.setSelection([i],!0)},annotate:function(e){e.stopImmediatePropagation();if(this.editModus||this.isScaleEnable)return;var t=Math.round(annotationsTool.playerAdapter.getCurrentTime()),n={},r,i;if(!_.isNumber(t)||t<0)return;r={text:this.model.get("value"),start:t,label:this.model},annotationsTool.user&&(r.created_by=annotationsTool.user.id,r.created_by_nickname=annotationsTool.user.get("nickname")),i=annotationsTool.selectedTrack.get("annotations").create(r,n),annotationsTool.setSelection([i],!0)},onSwitchEditModus:function(e){this.switchEditModus(e)},switchEditModus:function(e){this.editModus=e,e?this.$el.find("input[disabled='disabled']").removeAttr("disabled"):this.$el.find("input").attr("disabled","disabled")},changeCategory:function(e){var t;e.scale_id&&(t=annotationsTool.video.get("scales").get(e.scale_id),t&&(this.scaleValues=t.get("scaleValues"))),this.isScaleEnable=e.settings&&e.settings.hasScale,this.model.set("category",e),this.model.save()},onFocusOut:function(e){var t=e.target.className.replace("item-","").replace(" edit","");this.model.set(t,_.escape(e.target.value),{silent:!0}),this.model.save()},onKeyDown:function(e){e.stopImmediatePropagation();if(e.keyCode===13){var t=e.target.className.replace("item-","").replace(" edit","");this.model.set(t,_.escape(e.target.value)),this.model.save()}else(e.keyCode===39&&this.getCaretPosition(e.target)===e.target.value.length||e.keyCode===37&&this.getCaretPosition(e.target)===0)&&e.preventDefault()},getCaretPosition:function(e){var t=0,n;if(document.selection)e.focus(),n=document.selection.createRange(),n.moveStart("character",-e.value.length),t=n.text.length;else if(e.selectionStart||e.selectionStart==="0")t=e.selectionStart;return t},deleteView:function(){this.remove(),this.undelegateEvents(),this.deleted=!0},onDeleteLabel:function(){annotationsTool.deleteOperation.start(this.model,this.typeForDelete)},render:function(){var e=this.model.toJSON();return e.notEdit=!this.editModus,this.isScaleEnable?this.scaleValues&&(e.scaleValues=this.scaleValues.sort().toJSON()):e.scale_id&&delete e.scale_id,this.$el.html(this.template(e)),this.isScaleEnable?(this.$el.removeClass(this.CLASS_SCALE.DISABLED),this.$el.addClass(this.CLASS_SCALE.ENABLED)):(this.$el.removeClass(this.CLASS_SCALE.ENABLED),this.$el.addClass(this.CLASS_SCALE.DISABLED)),this.delegateEvents(this.events),this}});return s}),define("text!templates/annotate-category.tmpl",[],function(){return'<div class="catItem-header" {{#if settings.color}}style="background-color:{{settings.color}}"{{/if}}>\n    <input type="text" title="{{name}}" value="{{name}}" {{#if notEdit}}disabled=\'disabled\'{{/if}}/> \n   <i class="icon-pencil scale edit" title="Edit scaling for this category"></i> \n    <i class="icon-trash delete edit"></i>\n    <div class="colorpicker">\n        <input id="color-{{name}}" type="text" class="colorpicker edit" value="{{#if settings}}{{settings.color}}{{/if}}" /></div>\n    </div>\n</div>\n<div class="catItem-labels" {{#if settings.color}}style="background-color:{{settings.color}}"{{/if}}></div>\n<div class="catItem-add edit"><i class="icon-plus-sign"></i>Create a label</div>'}),function(e){var t,n,r=0,i={control:e('<div class="colorPicker-picker">&nbsp;</div>'),palette:e('<div id="colorPicker_palette" class="colorPicker-palette" />'),swatch:e('<div class="colorPicker-swatch">&nbsp;</div>'),hexLabel:e('<label for="colorPicker_hex">Hex</label>'),hexField:e('<input type="text" id="colorPicker_hex" />')},s="transparent",o;e.fn.colorPicker=function(t){return this.each(function(){var n=e(this),o=e.extend({},e.fn.colorPicker.defaults,t),u=e.fn.colorPicker.toHex(n.val().length>0?n.val():o.pickerDefault),l=i.control.clone(),c=i.palette.clone().attr("id","colorPicker_palette-"+r),h=i.hexLabel.clone(),p=i.hexField.clone(),v=c[0].id,m;e.each(o.colors,function(t){m=i.swatch.clone(),o.colors[t]===s?(m.addClass(s).text("X"),e.fn.colorPicker.bindPalette(p,m,s)):(m.css("background-color","#"+this),e.fn.colorPicker.bindPalette(p,m)),m.appendTo(c)}),h.attr("for","colorPicker_hex-"+r),p.attr({id:"colorPicker_hex-"+r,value:u}),p.bind("keydown",function(t){if(t.keyCode===13){var r=e.fn.colorPicker.toHex(e(this).val());e.fn.colorPicker.changeColor(r?r:n.val())}t.keyCode===27&&e.fn.colorPicker.hidePalette()}),p.bind("keyup",function(t){var r=e.fn.colorPicker.toHex(e(t.target).val());e.fn.colorPicker.previewColor(r?r:n.val())}),e('<div class="colorPicker_hexWrap" />').append(h).appendTo(c),c.find(".colorPicker_hexWrap").append(p),e("body").append(c),c.hide(),l.css("background-color",u),l.bind("click",function(){e.fn.colorPicker.togglePalette(e("#"+v),e(this))}),t&&t.onColorChange?l.data("onColorChange",t.onColorChange):l.data("onColorChange",function(){}),n.after(l),n.bind("change",function(){n.next(".colorPicker-picker").css("background-color",e.fn.colorPicker.toHex(e(this).val()))}),n.val(u).hide(),r++})},e.extend(!0,e.fn.colorPicker,{toHex:function(e){if(e.match(/[0-9A-F]{6}|[0-9A-F]{3}$/i))return e.charAt(0)==="#"?e:"#"+e;if(!e.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/))return!1;var t=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],n=function(e){if(e.length<2)for(var t=0,n=2-e.length;t<n;t++)e="0"+e;return e};if(t.length===3){var r=n(t[0].toString(16)),i=n(t[1].toString(16)),s=n(t[2].toString(16));return"#"+r+i+s}},checkMouse:function(r,i){var s=n,o=e(r.target).parents("#"+s.attr("id")).length;if(r.target===e(s)[0]||r.target===t[0]||o>0)return;e.fn.colorPicker.hidePalette()},hidePalette:function(){e(document).unbind("mousedown",e.fn.colorPicker.checkMouse),e(".colorPicker-palette").hide()},showPalette:function(n){var r=t.prev("input").val();n.css({top:t.offset().top+t.outerHeight(),left:t.offset().left}),e("#color_value").val(r),n.show(),e(document).bind("mousedown",e.fn.colorPicker.checkMouse)},togglePalette:function(r,i){i&&(t=i),n=r,n.is(":visible")?e.fn.colorPicker.hidePalette():e.fn.colorPicker.showPalette(r)},changeColor:function(n){t.css("background-color",n),t.prev("input").val(n).change(),e.fn.colorPicker.hidePalette(),t.data("onColorChange").call(t,e(t).prev("input").attr("id"),n)},previewColor:function(e){t.css("background-color",e)},bindPalette:function(n,r,i){i=i?i:e.fn.colorPicker.toHex(r.css("background-color")),r.bind({click:function(t){o=i,e.fn.colorPicker.changeColor(i)},mouseover:function(t){o=n.val(),e(this).css("border-color","#598FEF"),n.val(i),e.fn.colorPicker.previewColor(i)},mouseout:function(r){e(this).css("border-color","#000"),n.val(t.css("background-color")),n.val(o),e.fn.colorPicker.previewColor(o)}})}}),e.fn.colorPicker.defaults={pickerDefault:"FFFFFF",colors:["000000","993300","333300","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFFF","99CCFF","FFFFFF"],addColors:[]}}(jQuery),define("jquery.colorPicker",["jquery"],function(e){return function(){var t,n;return t||e.jQuery.fn.colorPicker}}(this)),define("views/annotate-category",["jquery","views/annotate-label","text!templates/annotate-category.tmpl","handlebars","jquery.colorPicker","backbone"],function(e,t,n,r){"use strict";var i=Backbone.View.extend({tagName:"div",className:"span1 category-item",ID_PREFIX:"catItem-",deleted:!1,editModus:!1,template:r.compile(n),events:{"click .catItem-header i.delete":"onDeleteCategory","click .catItem-header i.scale":"editScale","focusout .catItem-header input":"onFocusOut","keydown .catItem-header input":"onKeyDown","click   .catItem-add":"onCreateLabel"},initialize:function(t){var n;if(!t.category||!_.isObject(t.category))throw"Category object must be given as constuctor attribute!";return _.bindAll(this,"onDeleteCategory","deleteView","addLabels","addLabel","render","switchEditModus","onSwitchEditModus","onChange","onFocusOut","onKeyDown","onColorChange","removeOne","onCreateLabel","editScale"),e.fn.colorPicker.defaults.colors=["ffff99","ffd800","ffcc99","ffa800","ff7800","c36e00","d5d602","d9be6c","ff99cc","ff5d7c","da0000","d15c49","969601","adfded","8fc7c7","a4d2ff","00ccff","64b0e8","61ae24","9ded0a","92ffaa","c0adfd","ac5bff","6569ff"],this.typeForDelete=annotationsTool.deleteOperation.targetTypes.CATEGORY,this.roles=t.roles,this.labelViews=[],t.editModus&&(this.editModus=t.editModus),this.el.id=this.ID_PREFIX+t.category.get("id"),this.model=t.category,this.addLabels(this.model.get("labels")),n=this.model.get("labels"),this.listenTo(n,"add",this.addLabel),this.listenTo(n,"remove",this.removeOne),this.listenTo(n,"destroy",this.removeOne),this.listenTo(this.model,"change",this.onChange),_.contains(this.roles,annotationsTool.user.get("role"))&&this.listenTo(annotationsTool.video,"switchEditModus",this.onSwitchEditModus),this.render(),this.nameInput=this.$el.find(".catItem-header input"),this},onSwitchEditModus:function(e){this.switchEditModus(e)},onChange:function(){_.each(this.labelViews,function(e){e.changeCategory(this.model.toJSON())},this),this.render()},switchEditModus:function(e){this.editModus=e,e?this.$el.find('input[disabled="disabled"]').removeAttr("disabled"):this.$el.find("input").attr("disabled","disabled")},editScale:function(){annotationsTool.scaleEditor.show(this.model,this.model.get("access"))},onDeleteCategory:function(){annotationsTool.deleteOperation.start(this.model,this.typeForDelete)},deleteView:function(){this.remove(),this.undelegateEvents(),this.deleted=!0},addLabels:function(e){e.each(function(e){this.addLabel(e,!1)},this)},addLabel:function(e,n){var r=new t({label:e,editModus:this.editModus,roles:this.roles,isScaleEnable:this.model.get("settings").hasScale});this.labelViews.push(r),n&&this.render()},onCreateLabel:function(){var e=this.model.get("labels").create({value:"LB",abbreviation:"New",category:this.model},{wait:!0});e.save(),this.model.save(),annotationsTool.localStorage&&annotationsTool.video.save()},removeOne:function(e){_.find(this.labelViews,function(t,n){if(e===t.model){t.remove(),this.labelViews.splice(n,1);return}},this)},onFocusOut:function(){this.model.set("name",_.escape(this.nameInput.val()),{silent:!0}),this.model.save()},onKeyDown:function(e){e.keyCode===13?(this.model.set("name",_.escape(this.nameInput.val())),this.model.save()):(e.keyCode===39&&this.getCaretPosition(e.target)===e.target.value.length||e.keyCode===37&&this.getCaretPosition(e.target)===0)&&e.preventDefault()},getCaretPosition:function(e){var t=0,n;if(document.selection)e.focus(),n=document.selection.createRange(),n.moveStart("character",-e.value.length),t=n.text.length;else if(e.selectionStart||e.selectionStart=="0")t=e.selectionStart;return t},onColorChange:function(e,t){this.model.setColor(t),this.model.save()},render:function(){var e=this.model.toJSON();return e.notEdit=!this.editModus,this.$el.html(this.template(e)),_.each(this.labelViews,function(e){this.$el.find(".catItem-labels").append(e.render().$el)},this),this.nameInput=this.$el.find(".catItem-header input"),this.$el.find(".colorpicker").colorPicker({pickerDefault:this.model.attributes.settings.color.replace("#",""),onColorChange:this.onColorChange}),this.$el.find(".colorPicker-picker").addClass("edit"),this.delegateEvents(this.events),this}});return i}),define("text!templates/annotate-tab.tmpl",[],function(){return'<!-- Carousel nav -->\n<div class="controls">\n	<div class="pagination pagination-centered" style="display:none">\n  	<ul>\n    	<li><a href="#" id="carousel-prev">&lt;</a></li>\n    	<li><a href="#" id="carousel-next">&gt;</a></li>\n  	</ul>\n	</div>\n</div>\n\n\n<div id="{{id}}}" class="carousel slide">\n  <!-- Carousel items -->\n  <div class="carousel-inner">\n\n  </div>\n\n</div>\n'}),define("default_scale_set",[],function(){return[{name:"default",values:[{name:"--",value:-2,order:0},{name:"-",value:-1,order:1},{name:"0",value:0,order:2},{name:"+",value:1,order:3},{name:"++",value:2,order:4}]}]});if(typeof Blob!="function")var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(t,n,r){this.data=t,this.size=t.length,this.type=n,this.encoding=r},i=n.prototype,s=r.prototype,o=e.FileReaderSync,u=function(e){this.code=this[this.name=e]},a="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),f=a.length,l=e.URL||e.webkitURL||e,c=l.createObjectURL,h=l.revokeObjectURL,p=l,d=e.btoa,v=e.atob,m=!1,g=function(e){m=!e},y=e.ArrayBuffer,b=e.Uint8Array;r.fake=s.fake=!0;while(f--)u.prototype[a[f]]=f+1;try{b&&g.apply(0,new b(1))}catch(w){}return l.createObjectURL||(p=e.URL={}),p.createObjectURL=function(e){var t=e.type,n;t===null&&(t="application/octet-stream");if(e instanceof r)return n="data:"+t,e.encoding==="base64"?n+";base64,"+e.data:e.encoding==="URI"?n+","+decodeURIComponent(e.data):d?n+";base64,"+d(e.data):n+","+encodeURIComponent(e.data);if(c)return c.call(l,e)},p.revokeObjectURL=function(e){e.substring(0,5)!=="data:"&&h&&h.call(l,e)},i.append=function(e){var n=this.data;if(b&&e instanceof y)if(m)n.push(String.fromCharCode.apply(String,new b(e)));else{var i="",s=new b(e),a=0,f=s.length;for(;a<f;a++)i+=String.fromCharCode(s[a])}else if(t(e)==="Blob"||t(e)==="File"){if(!o)throw new u("NOT_READABLE_ERR");var l=new o;n.push(l.readAsBinaryString(e))}else e instanceof r?e.encoding==="base64"&&v?n.push(v(e.data)):e.encoding==="URI"?n.push(decodeURIComponent(e.data)):e.encoding==="raw"&&n.push(e.data):(typeof e!="string"&&(e+=""),n.push(unescape(encodeURIComponent(e))))},i.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},i.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,n){var i=arguments.length;return i<3&&(n=null),new r(this.data.slice(e,i>1?t:this.data.length),n,this.encoding)},s.toString=function(){return"[object Blob]"},n}(e);return function(n,r){var i=r?r.type||"":"",s=new t;if(n)for(var o=0,u=n.length;o<u;o++)s.append(n[o]);return s.getBlob(i)}}(self);define("libs/Blob",function(){});var BlobBuilder=BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder||function(e){"use strict";var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},i=n.prototype,s=r.prototype,o=e.FileReaderSync,u=function(e){this.code=this[this.name=e]},a="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),f=a.length,l=e.URL||e.webkitURL||e,c=l.createObjectURL,h=l.revokeObjectURL,p=l,d=e.btoa,v=e.atob,m=!1,g=function(e){m=!e},y=e.ArrayBuffer,b=e.Uint8Array;n.fake=s.fake=!0;while(f--)u.prototype[a[f]]=f+1;try{b&&g.apply(0,new b(1))}catch(w){}return l.createObjectURL||(p=e.URL={}),p.createObjectURL=function(e){var t=e.type,n;t===null&&(t="application/octet-stream");if(e instanceof r)return n="data:"+t,e.encoding==="base64"?n+";base64,"+e.data:e.encoding==="URI"?n+","+decodeURIComponent(e.data):d?n+";base64,"+d(e.data):n+","+encodeURIComponent(e.data);if(c)return c.call(l,e)},p.revokeObjectURL=function(e){e.substring(0,5)!=="data:"&&h&&h.call(l,e)},i.append=function(e){var n=this.data;if(b&&e instanceof y)if(m)n.push(String.fromCharCode.apply(String,new b(e)));else{var i="",s=new b(e),a=0,f=s.length;for(;a<f;a++)i+=String.fromCharCode(s[a])}else if(t(e)==="Blob"||t(e)==="File"){if(!o)throw new u("NOT_READABLE_ERR");var l=new o;n.push(l.readAsBinaryString(e))}else e instanceof r?e.encoding==="base64"&&v?n.push(v(e.data)):e.encoding==="URI"?n.push(decodeURIComponent(e.data)):e.encoding==="raw"&&n.push(e.data):(typeof e!="string"&&(e+=""),n.push(unescape(encodeURIComponent(e))))},i.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},i.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,n){var i=arguments.length;return i<3&&(n=null),new r(this.data.slice(e,i>1?t:this.data.length),n,this.encoding)},s.toString=function(){return"[object Blob]"},n}(self);define("libs/BlobBuilder",function(){});var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n(),t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}else if(o<10){o++,setTimeout(arguments.callee,10);return}n.removeChild(r),s=null,M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312))V(r,!0),i&&(s.success=!0,s.ref=_(r),i(s));else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall,u.width=o.getAttribute("width")||"0",u.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(u.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else H(o),i&&i(s)}else{V(r,!0);if(i){var p=_(r);p&&typeof p.SetVariable!=e&&(s.success=!0,s.ref=p),i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0,g=i||null,y={success:!1,id:r};var o=R(r);if(o){o.nodeName=="OBJECT"?(v=B(o),m=null):(v=o,m=r),t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew",c.setAttribute("id",r),o.parentNode.insertBefore(c,o),o.style.display="none",function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(B(e),t),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>",p[p.length]=n.id,o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u),o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function I(e){var t=R(e);t&&t.nodeName=="OBJECT"&&(T.ie&&T.win?(t.style.display="none",function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n),d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";s&&(E=null,S=null);if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css"),f.setAttribute("media",u),E=o.appendChild(f),T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]),S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t)g=f.plugins[n].description,g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)&&(l=!0,v=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);y&&(g=y.GetVariable("$version"),g&&(v=!0,g=g.split(" ")[1].split(","),m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]))}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C(),b||(typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1),T.ie&&T.win&&(a.attachEvent(o,function(){a.readyState=="complete"&&(a.detachEvent(o,arguments.callee),C())}),u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()),T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}(),L(C))}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,h[h.length]=i,V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o?(V(r,!1),k(function(){i+="",s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n,p.width=i,p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0),h.success=!0,h.ref=y}else{if(u&&D()){p.data=u,P(p,v,r,c);return}V(r,!0)}c&&c(h)})):c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);e&&v&&(e.parentNode.replaceChild(v,e),m&&(V(m,!0),T.ie&&T.win&&(v.style.display="block")),g&&g(y)),w=!1}}}}();define("libs/swfobject",function(){});var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,o=function(n){var r=t.createEvent("MouseEvents");return r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];typeof t=="string"?r.revokeObjectURL(t):t.remove()}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i=="function")try{i.call(e,n||e)}catch(s){f(s)}}},v=function(t,r){var f=this,p=t.type,v=!1,m,g,y=function(){var e=n().createObjectURL(t);return h.push(e),e},b=function(){d(f,"writestart progress write writeend".split(" "))},w=function(){if(v||!m)m=y(t);g.location.href=m,f.readyState=f.DONE,b()},E=function(e){return function(){if(f.readyState!==f.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1},x;f.readyState=f.INIT,r||(r="download");if(s){m=y(t),i.href=m,i.download=r;if(o(i)){f.readyState=f.DONE,b();return}}e.chrome&&p&&p!==l&&(x=t.slice||t.webkitSlice,t=x.call(t,0,t.size,l),v=!0),u&&r!=="download"&&(r+=".download"),p===l||u?g=e:g=e.open();if(!a){w();return}c+=t.size,a(e.TEMPORARY,c,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),h.push(e),f.readyState=f.DONE,d(f,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=f["on"+e]}),n.write(t),f.abort=function(){n.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():w()}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};return m.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,e.addEventListener("unload",p,!1),g}(self);define("libs/FileSaver",function(){}),function(e){var t=e.Callbacks("once unique memory"),n=0,r=null;if(window.FileReader){e.fn.fileReader=function(){return this};return}e.fn.fileReader=function(n){n=e.extend(e.fn.fileReader.defaults,n);var r=this;return t.add(function(){return i(r,n)}),e.isFunction(n.callback)&&t.add(n.callback),FileAPIProxy.ready||FileAPIProxy.init(n),this},e.fn.fileReader.defaults={id:"fileReaderSWFObject",multiple:null,accept:null,label:null,extensions:null,filereader:"files/filereader.swf",expressInstall:null,debugMode:!1,callback:!1};var i=function(t,i){return t.each(function(t,s){s=e(s);var o=s.attr("id");o||(o="flashFileInput"+n,s.attr("id",o),n++),i.multiple=i.multiple===null?!!s.attr("multiple"):!!i.multiple,i.accept=i.accept===null?s.attr("accept"):i.accept,FileAPIProxy.inputs[o]=s,FileAPIProxy.swfObject.add(o,i.multiple,i.accept,i.label,i.extensions),s.css("z-index",0).mouseover(function(e){o!==r&&(e=e||window.event,r=o,FileAPIProxy.swfObject.mouseover(o),FileAPIProxy.container.height(s.outerHeight()).width(s.outerWidth()).css(s.offset()))}).click(function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1})})};window.FileAPIProxy={ready:!1,init:function(n){var i=this;this.debugMode=n.debugMode,this.container=e("<div>").attr("id",n.id).wrap("<div>").parent().css({position:"fixed",width:"1px",height:"1px",display:"inline-block",background:"transparent","z-index":99999}).on("mouseover mouseout mousedown mouseup",function(t){r&&e("#"+r).trigger(t.type)}).appendTo("body"),swfobject.embedSWF(n.filereader,n.id,"100%","100%","10",n.expressInstall,{debugMode:n.debugMode?!0:""},{wmode:"transparent",allowScriptAccess:"sameDomain"},{},function(n){i.swfObject=n.ref,e(i.swfObject).css({display:"block",outline:0}).attr("tabindex",0),i.ready&&t.fire(),i.ready=n.success&&typeof n.ref.add=="function"})},swfObject:null,container:null,inputs:{},readers:{},onFileInputEvent:function(e){this.debugMode&&console.info("FileInput Event ",e.type,e);if(e.target in this.inputs){var t=this.inputs[e.target];e.target=t[0],e.type==="change"&&(e.files=new FileList(e.files),e.target={files:e.files}),t.trigger(e)}window.focus()},onFileReaderEvent:function(e){this.debugMode&&console.info("FileReader Event ",e.type,e,e.target in this.readers);if(e.target in this.readers){var t=this.readers[e.target];e.target=t,t._handleFlashEvent.call(t,e)}},onFileReaderError:function(e){this.debugMode&&console.log(e)},onSWFReady:function(){return this.container.css({position:"absolute"}),this.ready=typeof this.swfObject.add=="function",this.ready&&t.fire(),!0}},window.FileReader=function(){this.EMPTY=0,this.LOADING=1,this.DONE=2,this.readyState=0,this.result=null,this.error=null,this.onloadstart=null,this.onprogress=null,this.onload=null,this.onabort=null,this.onerror=null,this.onloadend=null,this._callbacks={loadstart:e.Callbacks("unique"),progress:e.Callbacks("unique"),abort:e.Callbacks("unique"),error:e.Callbacks("unique"),load:e.Callbacks("unique"),loadend:e.Callbacks("unique")},this._id=null},window.FileReader.prototype={readAsBinaryString:function(e){this._start(e),FileAPIProxy.swfObject.read(e.input,e.name,"readAsBinaryString")},readAsText:function(e,t){this._start(e),FileAPIProxy.swfObject.read(e.input,e.name,"readAsText")},readAsDataURL:function(e){this._start(e),FileAPIProxy.swfObject.read(e.input,e.name,"readAsDataURL")},readAsArrayBuffer:function(e){throw"Whoops FileReader.readAsArrayBuffer is unimplemented"},abort:function(){this.result=null;if(this.readyState===this.EMPTY||this.readyState===this.DONE)return;FileAPIProxy.swfObject.abort(this._id)},addEventListener:function(e,t){e in this._callbacks&&this._callbacks[e].add(t)},removeEventListener:function(e,t){e in this._callbacks&&this._callbacks[e].remove(t)},dispatchEvent:function(t){t.target=this;if(t.type in this._callbacks){var n=this["on"+t.type];e.isFunction(n)&&n(t),this._callbacks[t.type].fire(t)}return!0},_register:function(e){this._id=e.input+"."+e.name,FileAPIProxy.readers[this._id]=this},_start:function(e){this._register(e);if(this.readyState===this.LOADING)throw{type:"InvalidStateError",code:11,message:"The object is in an invalid state."}},_handleFlashEvent:function(e){switch(e.type){case"loadstart":this.readyState=this.LOADING;break;case"loadend":this.readyState=this.DONE;break;case"load":this.readyState=this.DONE,this.result=FileAPIProxy.swfObject.result(this._id);break;case"error":this.result=null,this.error={name:"NotReadableError",message:"The File cannot be read!"}}this.dispatchEvent(new FileReaderEvent(e))}},FileReaderEvent=function(e){this.initEvent(e)},FileReaderEvent.prototype={initEvent:function(t){e.extend(this,{type:null,target:null,currentTarget:null,eventPhase:2,bubbles:!1,cancelable:!1,defaultPrevented:!1,isTrusted:!1,timeStamp:(new Date).getTime()},t)},stopPropagation:function(){},stopImmediatePropagation:function(){},preventDefault:function(){}},FileList=function(e){if(e){for(var t=0;t<e.length;t++)this[t]=e[t];this.length=e.length}else this.length=0},FileList.prototype={item:function(e){return e in this?this[e]:null}}}(jQuery),define("jquery.FileReader",["jquery"],function(e){return function(){var t,n;return t||e.jQuery.fn.fileReader}}(this)),define("views/annotate-tab",["jquery","underscore","models/category","models/label","models/scale","models/scalevalue","collections/categories","collections/labels","collections/scalevalues","views/annotate-category","text!templates/annotate-tab.tmpl","default_scale_set","handlebars","backbone","access","libs/Blob","libs/BlobBuilder","libs/swfobject","libs/FileSaver","jquery.FileReader"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";var v=p.View.extend({tagName:"div",className:"tab-pane",ID_PREFIX:"labelTab-",editModus:!1,categories:undefined,categoryViews:undefined,template:h.compile(l),itemContainerTemplate:h.compile('<div class="item row-fluid" id="item-{{number}}">                                                        <div class="span12">                                                          <div class="row-fluid">                                                          </div>                                                        </div>                                                      </div>'),paginationBulletTemplate:h.compile('<li><a href="#" class="page-link" title="{{frame}}" id="page-{{number}}">{{number}}</a></li>'),carouselElement:undefined,carouselPagination:undefined,categoriesContainer:undefined,itemsCurrentContainer:undefined,titleLink:undefined,events:{"click #carousel-prev":"moveCarouselPrevious","click #carousel-next":"moveCarouselNext","click .page-link":"moveCarouselToFrame","mouseleave .carousel":"pauseCarousel"},DEFAULT_CAT_COLOR:"#61ae24",initialize:function(e){if(!e.id||!e.name||!e.categories)throw"Tab id,name and categories must be given as constuctor attributes!";return t.bindAll(this,"addCategories","addCategory","onAddCategory","removeOne","addCarouselItem","generateScales","moveCarouselToFrame","moveCarouselPrevious","moveCarouselNext","onCarouselSlid","onSwitchEditModus","onExport","onImport","chooseFile","switchEditModus","insertCategoryView","initCarousel","render"),this.categories=e.categories,this.filter=e.filter,this.roles=e.roles,this.defaultCategoryAttributes=e.attributes,this.categoryViews=[],e.edit&&(this.edit=!0),this.el.id=this.ID_PREFIX+e.id,this.$el.append(this.template({id:e.id})),this.carouselElement=this.$("#"+e.id),this.carouselPagination=this.$(".pagination ul"),this.categoriesContainer=this.carouselElement.find(".carousel-inner"),this.addCategories(this.categories,this.filter),this.generateScales(),this.initCarousel(),this.titleLink=e.button,this.titleLink.find("i.add").bind("click",this.onAddCategory),this.titleLink.find("i.export").bind("click",this.onExport),this.titleLink.find("i.import").bind("click",this.chooseFile),this.titleLink.find(".file").fileReader({id:"fileReaderSWFObject",filereader:"js/libs/filereader.swf",expressInstall:"js/libs/expressInstall.swf",debugMode:!1,callback:function(){},multiple:!1,label:"JSON files",extensions:"*.json"}),this.titleLink.find(".file").bind("change",this.onImport),this.listenTo(this.categories,"add",this.addCategory),this.listenTo(this.categories,"remove",this.removeOne),this.listenTo(this.categories,"destroy",this.removeOne),this.listenTo(annotationsTool.video,"switchEditModus",this.onSwitchEditModus),this.hasEditMode=t.contains(this.roles,annotationsTool.user.get("role")),this.delegateEvents(this.events),this.carouselElement.carousel(0).carousel("pause"),this},addCategories:function(e,n){var r;if(e.models)n?r=e.where(n):r=e.models;else{if(!t.isArray(e))return;n?t.where(e,n):r=e}t.each(r,function(t){this.addCategory(t,e,{skipTests:!0})},this)},addCategory:function(n,r,i){var s=n,o,u=!1,a=function(){return t.every(this.filter,function(e,t){return n.has(t)&&n.get(t)===e?!0:!1})};if(!i.skipTests&&!e.proxy(a,this)())return;if(i&&i.isTemplate)s=this.categories.addCopyFromTemplate(n);else if(!this.categories.get(n.get("id")))this.categories.add(s,{silent:!0});else{t.find(this.categoryViews,function(e){if(n===e.model)return u=!0,!0},this);if(u)return}s.save(),annotationsTool.localStorage&&annotationsTool.video.save(),o=new f({category:s,editModus:this.editModus,roles:this.roles}),this.categoryViews.push(o),this.insertCategoryView(o)},onAddCategory:function(){var e={name:"NEW CATEGORY",settings:{color:this.DEFAULT_CAT_COLOR,hasScale:!1}};this.categories.create(t.extend(e,this.defaultCategoryAttributes))},removeOne:function(e){t.find(this.categoryViews,function(t,n){if(e===t.model){t.remove(),this.categoryViews.splice(n,1),this.initCarousel(),this.render();return}},this)},insertCategoryView:function(e){var t=this.categoriesContainer.find("div.category-item").length;t%12===0&&this.addCarouselItem(),t===0&&this.initCarousel(),this.itemsCurrentContainer.append(e.render().$el),this.carouselElement.carousel(parseInt(t/12,10)).carousel("pause")},addCarouselItem:function(){var e=this.categoriesContainer.find("div.category-item").length,t=(e-e%12)/12;this.categoriesContainer.append(this.itemContainerTemplate({number:t+1})),this.itemsCurrentContainer=this.categoriesContainer.find("div div div.row-fluid").last(),e>=12&&this.carouselPagination.parent().css("display","block"),this.carouselPagination.find("li:last").before(this.paginationBulletTemplate({number:t+1,frame:t}))},initCarousel:function(){var e=this.categoriesContainer.find(".active").length>0;e||(this.categoriesContainer.find(".item:first-child").addClass("active"),this.carouselPagination.find(".page-link:first").parent().addClass("active")),this.carouselElement.carousel({interval:!1,pause:""}).bind("slid",this.onCarouselSlid).carousel("pause"),e||this.carouselElement.carousel(0)},pauseCarousel:function(){this.carouselElement.carousel("pause")},generateScales:function(){var e,n,r=function(e){return c[0].name===e.get("name")},i={wait:!0};annotationsTool.video.get("scales").find(r)||(e=annotationsTool.video.get("scales").create({name:c[0].name,access:d.PRIVATE},i),n=e.get("scaleValues"),t.each(c[0].values,function(t){n.create({name:t.name,value:t.value,order:t.order,scale:e},i)}))},moveCarouselToFrame:function(t){var n=e(t.target);this.carouselElement.carousel(parseInt(n.attr("title"),10)).carousel("pause"),this.carouselPagination.find(".page-link").parent().removeClass("active"),n.parent().addClass("active")},moveCarouselNext:function(){this.carouselElement.carousel("next").carousel("pause")},moveCarouselPrevious:function(){this.carouselElement.carousel("prev").carousel("pause")},onCarouselSlid:function(){var e=this.carouselElement.find("div.active").attr("id");e=e.replace("item-",""),this.carouselPagination.find(".page-link").parent().removeClass("active"),this.carouselPagination.find("#page-"+e).parent().addClass("active"),this.delegateEvents(this.events)},onExport:function(){var e={categories:[],scales:[]},n={},r;if(annotationsTool.isBrowserSafari6()){annotationsTool.alertWarning("This version of Safari does not currently support the export function. Try it on another browser.");return}if(annotationsTool.isBrowserIE9()){annotationsTool.alertWarning("This version of Internet Explorer does not support the export function. Try it on another browser.");return}t.each(this.categories.where(this.filter),function(t){r=t.attributes.scale_id,r&&!n[r]&&(n[r]=annotationsTool.video.get("scales").get(r)),e.categories.push(t.toExportJSON())},this),t.each(n,function(t){t&&e.scales.push(t.toExportJSON())}),saveAs(new Blob([JSON.stringify(e)],{type:"application/octet-stream"}),"export-categories.json")},onImport:function(e){var t=new FileReader,n=e.target.files[0],r=this.defaultCategoryAttributes;t.onload=function(){return function(e){var t=e.target.result,n;try{n=JSON.parse(t),annotationsTool.importCategories(n,r)}catch(i){console.warn("The uploaded file is not valid!")}}}(n),t.readAsText(n)},onSwitchEditModus:function(e){this.hasEditMode?this.switchEditModus(e):e?this.titleLink.css("visibility","hidden"):this.titleLink.css("visibility","visible")},chooseFile:function(e){e.preventDefault(),e.stopImmediatePropagation(),this.titleLink.find(".file").click()},switchEditModus:function(e){this.titleLink.toggleClass("edit-on",e),this.$el.toggleClass("edit-on",e),this.editModus=e},render:function(){var e=this.categoriesContainer.find("div.item.active").attr("id"),n;return this.categoriesContainer.empty(),this.carouselPagination.find("li:not(:last,:first)").remove(),t.each(this.categoryViews,function(e){this.insertCategoryView(e)},this),e&&(n=parseInt(e.replace("item-",""),10),this.categoriesContainer.find("#"+e).length===0&&n--,this.categoriesContainer.find("#item-"+n).addClass("active"),this.carouselPagination.find("#page-"+n).parent().addClass("active")),this.delegateEvents(this.events),this}});return v}),define("text!templates/annotate-tab-title.tmpl",[],function(){return'<li class=\'tab-button\'>\n    <a href=\'#labelTab-{{id}}\'>{{name}}\n        <i class=\'icon-download import edit\' title="Import" ></i>\n        <input class="file" type="file" id="file-{{id}}">\n        <i class=\'icon-upload export edit\' title="export" ></i>\n        <i class=\'icon-plus-sign add edit\'></i>\n</a></li>"'}),define("views/annotate",["jquery","underscore","prototypes/player_adapter","models/annotation","collections/annotations","collections/categories","views/annotate-tab","text!templates/annotate-tab-title.tmpl","roles","access","handlebars","backbone"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";var h="#labelTab-",p={ALL:{id:"all",name:"All",roles:[]},PUBLIC:{id:"public",name:"Public",filter:{isPublic:!0},roles:[a.SUPERVISOR],attributes:{access:f.PUBLIC}},MINE:{id:"mine",name:"Mine",filter:{isPublic:!1},roles:[a.SUPERVISOR,a.USER],attributes:{access:f.PRIVATE}}},d=c.View.extend({el:e("div#annotate-container"),events:{"keyup #new-annotation":"keydownOnAnnotate","click #insert":"insert","click #annotate-full":"setLayoutFull","click #annotate-text":"setLayoutText","click #annotate-categories":"setLayoutCategories","click .toggle-collapse":"toggleVisibility","keydown #new-annotation":"onFocusIn","focusout #new-annotation":"onFocusOut","click #label-tabs-buttons a":"showTab","click #editSwitch":"onSwitchEditModus"},tabsButtonTemplate:l.compile(u),tabsButtonsElement:e("ul#label-tabs-buttons"),tabsContainerElement:e("div#label-tabs-contents"),editModus:!1,categoriesTabs:{},DEFAULT_TAB_ON_EDIT:p.MINE.id,initialize:function(e){var n;t.bindAll(this,"insert","reset","onFocusIn","onFocusOut","changeTrack","addTab","onSwitchEditModus","checkToContinueVideo","switchEditModus","keydownOnAnnotate","setLayoutCategories","setLayoutText","setLayoutFull","toggleVisibility"),this.continueVideo=!1,this.input=this.$("#new-annotation"),this.trackDIV=this.$el.find("div.currentTrack span.content"),this.changeTrack(annotationsTool.selectedTrack),this.tracks=annotationsTool.video.get("tracks"),this.tracks.bind("selected_track",this.changeTrack,this),this.playerAdapter=e.playerAdapter,annotationsTool.isStructuredAnnotationEnabled()?(n=annotationsTool.video.get("categories"),t.each(p,function(e){this.addTab(n,e)},this)):(this.$el.find("#categories").hide(),this.$el.find("#annotate-categories").parent().hide()),annotationsTool.isFreeTextEnabled()||(this.$el.find("#input-container").hide(),this.$el.find("#annotate-text").parent().hide()),this.$el.find("#annotate-full").addClass("checked"),this.tabsContainerElement.find("div.tab-pane:first-child").addClass("active"),this.tabsButtonsElement.find("a:first-child").parent().first().addClass("active"),t.extend(this,c.Events)},keydownOnAnnotate:function(e){e.keyCode===13&&!e.shiftKey&&this.insert()},insert:function(e){e&&e.stopImmediatePropagation();var n=this.input.val(),r=Math.round(this.playerAdapter.getCurrentTime()),i={},s,o;if(!n||!t.isNumber(r)||r<0)return;s={text:n,start:r},annotationsTool.user&&(s.created_by=annotationsTool.user.id),annotationsTool.localStorage||(i.wait=!0),o=annotationsTool.selectedTrack.get("annotations").create(s,i),annotationsTool.setSelection([o],!1,!0),this.continueVideo&&annotationsTool.playerAdapter.play(),this.input.val(""),this.input.focus()},changeTrack:function(e){e?(this.input.attr("disabled",!1),this.trackDIV.html(e.get("name"))):(this.input.attr("disabled",!0),this.trackDIV.html("<span class='notrack'>Select a track!</span>"))},onFocusIn:function(){if(!this.$el.find("#pause-video").attr("checked")||annotationsTool.playerAdapter.getStatus()===n.STATUS.PAUSED)return;this.continueVideo=!0,this.playerAdapter.pause(),e(annotationsTool.playerAdapter).one(n.EVENTS.TIMEUPDATE,function(){this.continueVideo=!1})},onFocusOut:function(){setTimeout(this.checkToContinueVideo,200)},checkToContinueVideo:function(){annotationsTool.playerAdapter.getStatus()===n.STATUS.PAUSED&&this.continueVideo&&(this.continueVideo=!1,this.playerAdapter.play())},showTab:function(t){var n=t.currentTarget.attributes.getNamedItem("href").value;n=n.replace(h,""),e(t.currentTarget).one("shown",e.proxy(function(){this.categoriesTabs[n].initCarousel()},this)),e(t.currentTarget).tab("show")},addTab:function(t,n){var r={id:n.id,name:n.name,categories:t,filter:n.filter,roles:n.roles,attributes:n.attributes},i=this.tabsButtonTemplate(r),s;i=e(i).appendTo(this.tabsButtonsElement),r.button=i,s=new o(r),this.categoriesTabs[n.id]=s,this.tabsContainerElement.append(s.$el)},onSwitchEditModus:function(t){var n=e(t.target).attr("checked")==="checked";this.switchEditModus(n),n&&this.showTab({currentTarget:this.categoriesTabs[this.DEFAULT_TAB_ON_EDIT].titleLink.find("a")[0]})},switchEditModus:function(e){this.editModus=e,this.$el.toggleClass("edit-on",e),annotationsTool.video.trigger("switchEditModus",e)},setLayoutFull:function(t){e(t.target).hasClass("checked")||(annotationsTool.isStructuredAnnotationEnabled()&&this.$el.find("#categories").show(),annotationsTool.isFreeTextEnabled()&&this.$el.find("#input-container").show(),this.$el.find("#annotate-text").removeClass("checked"),this.$el.find("#annotate-categories").removeClass("checked"),e(t.target).addClass("checked"),this.trigger("change-layout"))},setLayoutText:function(t){e(t.target).hasClass("checked")||(this.$el.find("#categories").hide(),this.$el.find("#input-container").show(),this.$el.find("#annotate-full").removeClass("checked"),this.$el.find("#annotate-categories").removeClass("checked"),e(t.target).addClass("checked"),this.trigger("change-layout"))},setLayoutCategories:function(t){e(t.target).hasClass("checked")||(this.$el.find("#categories").show(),this.$el.find("#input-container").hide(),this.$el.find("#annotate-text").removeClass("checked"),this.$el.find("#annotate-full").removeClass("checked"),e(t.target).addClass("checked"),this.trigger("change-layout"))},toggleVisibility:function(t){var n=this.$el.find(".control-group");n.css("display")==="none"?(n.show(),e("div#annotate-container").toggleClass("expanded"),e(t.target).html("Collapse")):(n.hide(),e("div#annotate-container").toggleClass("expanded"),e(t.target).html("Expand")),this.trigger("change-layout")},reset:function(){this.$el.hide(),delete this.tracks,this.undelegateEvents(),annotationsTool.isStructuredAnnotationEnabled()&&(this.tabsContainerElement.empty(),this.$el.find("#editSwitch input").attr("checked",!1),this.tabsButtonsElement.find(".tab-button").remove())}});return d}),define("models/user",["jquery","roles","access","backbone"],function(e,t,n,r){"use strict";var i=r.Model.extend({defaults:{role:t.USER,access:n.PUBLIC},initialize:function(e){if(_.isUndefined(e.user_extid)||e.user_extid===""||_.isUndefined(e.nickname)||e.nickname==="")throw"'user_extid' and 'nickanme' attributes are required";e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),!e.role&&annotationsTool.getUserRole&&(e.role=annotationsTool.getUserRole(),e.role||delete e.role),this.set(e),this.noPOST=!0},parse:function(e){var t=e.attributes?e.attributes:e;return t.created_at=t.created_at!==null?Date.parse(t.created_at):null,t.updated_at=t.updated_at!==null?Date.parse(t.updated_at):null,t.deleted_at=t.deleted_at!==null?Date.parse(t.deleted_at):null,e.attributes?e.attributes=t:e=t,e},validate:function(e){var t;e.id&&this.get("id")!==e.id&&(this.id=e.id);if(_.isUndefined(e.user_extid)||!_.isString(e.user_extid)&&!_.isNumber(e.user_extid))return{attribute:"user_extid",message:"'user_extid' must be a valid string or number."};if(_.isUndefined(e.nickname)||!_.isString(e.nickname))return{attribute:"nickname",message:"'nickanme' must be a valid string!"};if(e.email&&!i.validateEmail(e.email))return{attribute:"email",message:"Given email is not valid!"};if(e.created_by&&!(_.isNumber(e.created_by)||e.created_by instanceof i))return"'created_by' attribute must be a number or an instance of 'User'";if(e.updated_by&&!(_.isNumber(e.updated_by)||e.updated_by instanceof i))return"'updated_by' attribute must be a number or an instance of 'User'";if(e.deleted_by&&!(_.isNumber(e.deleted_by)||e.deleted_by instanceof i))return"'deleted_by' attribute must be a number or an instance of 'User'";if(e.created_at){if((t=this.get("created_at"))&&t!==e.created_at)return"'created_at' attribute can not be modified after initialization!";if(!_.isNumber(e.created_at))return"'created_at' attribute must be a number!"}if(e.updated_at&&!_.isNumber(e.updated_at))return"'updated_at' attribute must be a number!";if(e.deleted_at&&!_.isNumber(e.deleted_at))return"'deleted_at' attribute must be a number!"}},{validateEmail:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}});return i}),define("text!templates/comment.tmpl",[],function(){return'<span class="comments header">\n	<span class="username">{{creator}}</span>\n	<span class="date">added on the {{creationdate}}{{#if updateddate}}	and modified on the {{updateddate}}{{/if}}</span>\n</span>\n{{#if canEdit}}\n<i class="delete-comment icon-trash" title="Delete comment"></i>\n<i class="edit-comment icon-pencil" title="Edit comment"></i>\n{{/if}}\n<span class="text">{{{text}}}</span>'}),define("text!templates/edit-comment.tmpl",[],function(){return'<textarea class="input-block-level focused hide" id="focusedInput">{{text}}</textarea>\n<div class="button-bar">\n	<button type="button" class="btn">Cancel</button>\n	<button type="submit" class="btn btn-primary">Save</button>	\n</div>'}),define("views/comment",["jquery","underscore","text!templates/comment.tmpl","text!templates/edit-comment.tmpl","handlebars","backbone"],function(e,t,n,r,i,s){"use strict";var o=s.View.extend({tagName:"div",template:i.compile(n),editTemplate:i.compile(r),events:{"click i.delete-comment":"onDeleteComment","click i.edit-comment":"onEditComment","click button[type=submit]":"onSubmit","click button[type=button]":"onCancel"},initialize:function(e){return this.model=e.model,this.commentId=e.model.get("id"),this.id="comment"+this.commentId,this.el.id=this.id,t.bindAll(this,"render","onDeleteComment","onEditComment","onSubmit","onCancel"),this},onDeleteComment:function(){this.model.destroy(),this.remove()},onEditComment:function(){this.isEditEnable||(this.$el.append(this.editTemplate({text:this.model.get("text")})),this.isEditEnable=!0)},onSubmit:function(){var e=this.$el.find("textarea").val();if(e==="")return;this.model.set("text",e),this.model.save(),this.cancel(),this.render()},onCancel:function(){event.stopImmediatePropagation(),this.cancel()},cancel:function(){this.isEditEnable=!1,this.$el.find("textarea").remove(),this.$el.find("button").remove()},render:function(){var e=this.model.toJSON(),n={creator:e.created_by_nickname,creationdate:(new Date(e.created_at)).toLocaleString(),text:t.escape(e.text).replace(/\n/g,"<br/>"),canEdit:annotationsTool.user.get("id")===e.created_by};return e.created_at!==e.updated_at&&(n.updator=e.updated_by_nickname,n.updateddate=(new Date(e.updated_at)).toLocaleString()),this.$el.html(this.template(n)),this.delegateEvents(this.events),this}});return o}),define("text!templates/comments-container.tmpl",[],function(){return'<div class="comment-header">\n	<span class="add-comment"><a href="#" class="add-comment">add comment</a></span>\n	<textarea style="display: none;" class="input-block-level focused hide" id="focusedInput" placeholder="Write a comment for this annotation."></textarea>\n	<div class="button-bar">\n		<button type="button" class="btn hide">Cancel</button>\n		<button type="submit" class="btn btn-primary hide">Insert</button>\n	</div>\n</div>\n\n<div id="comment-list{{id}}" class="comment-list"></div>'}),define("views/comments-container",["jquery","views/comment","text!templates/comments-container.tmpl","handlebars","backbone"],function(e,t,n,r,i){"use strict";var s=i.View.extend({tagName:"div",className:"comments-container collapse",template:r.compile(n),collapsed:!0,events:{"click a.add-comment":"onAddComment","keyup textarea":"keyupInsertProxy","click button[type=submit]":"insert","click button[type=button]":"onCancelComment"},initialize:function(e){return typeof e.collapsed!="undefined"&&(this.collapsed=e.collapsed),this.annotationId=e.id,this.id="comments-container"+e.id,this.el.id=this.id,this.comments=e.comments,this.commentViews=[],_.bindAll(this,"render","onAddComment","insert","onCancelComment","keyupInsertProxy"),this.$el.html(this.template({id:this.annotationId,comments:this.comments.models,collapsed:this.collapsed})),this.commentList=this.$el.find("div#comment-list"+this.annotationId),_.each(this.comments.toArray(),function(e){this.addComment(e)},this),_.extend(this.comments,i.Events),this.listenTo(this.comments,"destroy",this.deleteView),this.render()},render:function(){return this.$el.html(this.template({id:this.annotationId,comments:this.comments.models,collapsed:this.collapsed})),this.commentList=this.$el.find("div#comment-list"+this.annotationId),this.commentList.empty(),_.each(this.commentViews,function(e){this.commentList.append(e.render().$el)},this),this.delegateEvents(this.events),this},deleteView:function(e){_.find(this.commentViews,function(t,n){if(e===t.model){this.commentViews.splice(n,1),this.render();return}},this)},sortViewsByDate:function(){this.commentViews=_.sortBy(this.commentViews,function(e){return e.model.get("created_at")}),this.render()},keyupInsertProxy:function(e){e.keyCode===13&&!e.shiftKey&&this.insert()},insert:function(){var e=this.$el.find("textarea").val(),t;if(e==="")return;t=this.comments.create({text:e}),this.cancel(),this.addComment(t)},addComment:function(e){var n=new t({model:e});this.commentViews.push(n),this.$el.find("div#comment-list"+this.annotationId).append(n.render().$el),this.comments.length===1?this.commentList.append(n.render().$el):this.$el.find("> span.comments").text(this.comments.length+" Comments"),this.$el.find("textarea").focus()},onAddComment:function(e){e.stopImmediatePropagation(),this.$el.find("textarea").show(),this.$el.find("button").removeClass("hide"),this.$el.find("textarea").focus()},onCancelComment:function(e){e.stopImmediatePropagation(),this.cancel()},cancel:function(){this.$el.find("textarea").hide().val(""),this.$el.find("button").addClass("hide")}});return s}),define("text!templates/list-annotation.tmpl",[],function(){return'<a href="#{{id}}" class="proxy-anchor"></a>\n<div class="header-container" {{#if label.category}}style="background-color:{{label.category.settings.color}}"{{/if}}>\n	<div class="right">\n		<i class="icon-comment-amount" title="{{numberOfComments}} Comment(s)"><span class="comment-amount">{{numberOfComments}}</span></i>\n\n		{{#if created_by}}\n		<i class="icon-info-sign" title="added by {{#if created_by_nickname}}{{created_by_nickname}}{{else}}{{nickname created_by}}{{/if}} on {{track}}"></i>\n    {{/if}}\n\n		{{#if isMine}}\n		<i class="toggle-edit icon-pencil" title="Edit annotation."></i>\n		{{/if}}\n    \n    {{#if isMine}}\n		<i class="delete icon-trash" title="Delete annotation."></i>\n    {{/if}}\n\n	</div>\n	<div class="left">\n		<a class="collapse" title="collapse">\n		 <i class="{{#if collapsed}}icon-chevron-right{{else}}icon-chevron-down{{/if}}"></i>\n		</a>\n		<button class="btn in edit" title="Set the video playhead as start point.">IN</button>\n		<span class="start">\n				<input id="start-{{id}}" class="start-value" type="text" value="{{time start}}" {{#if isEditEnable}} {{else}}disabled{{/if}}></input>\n		</span>\n\n		<span class="end {{#if duration}}has-duration{{else}}no-duration{{/if}}">\n				<input id="end-{{id}}" class="end-value" type="text" value="{{end start duration}}" {{#if isEditEnable}} {{else}}disabled{{/if}}></input>\n		</span>\n		<button class="btn out edit" title="Set the video playhead as end point.">OUT</button>\n\n\n		{{#if scalevalues}}\n		<span class="scaling">\n				{{#if isMine}}\n				<select class="edit">\n						{{#each scalevalues}}\n						<option value="{{this.id}}" {{#if this.isSelected}}selected="selected"{{/if}}>{{this.name}}</option>\n						{{/each}}\n				</select>\n				{{/if}} \n				{{#if scalevalue}}\n				<span class="read-only" title="{{scalevalue.name}}">{{scalevalue.name}}</span>\n				{{/if}} \n		</span>\n		{{/if}} \n		\n		{{#if isMine}}\n		<i class="private icon-user" title="You own this annotation"></i>\n		{{/if}}\n		\n		<span class="category" title="{{#if label}}{{label.category.name}} - {{label.value}} ({{label.abbreviation}}){{/if}}">\n				{{#if label}}<span class="abbreviation">{{label.abbreviation}}</span>{{else}}{{text}}{{/if}}\n		</span>\n	</div>\n</div>\n<div id="text-container{{id}}" class="{{#if collapsed}}collapse{{else}}in{{/if}} text-container">\n        {{#if label}} {{else}} \n        <span class="text">\n                <span class="freetext">\n                    {{#if isMine}}\n                    <textarea class="edit" placeholder="free text...">{{text}}</textarea>\n                    {{/if}}\n                    <span class="read-only">{{{textReadOnly}}}</span>\n                </span>\n        </span>\n        {{/if}}\n</div>\n<!--<button id="stopduration">Stop duration</button>-->'}),define("views/list-annotation",["jquery","prototypes/player_adapter","models/annotation","models/user","views/comments-container","text!templates/list-annotation.tmpl","backbone","handlebars"],function(e,t,n,r,i,s,o,u){"use strict";u.registerHelper("time",function(e){return annotationsTool.getWellFormatedTime(e)}),u.registerHelper("end",function(e,t){return annotationsTool.getWellFormatedTime(e+(t||0))}),u.registerHelper("nickname",function(e){return _.isObject(e)?e.nickname:annotationsTool.users.get(e).get("nickname")});var a=o.View.extend({tagName:"div",className:"annotation",template:u.compile(s),deleted:!1,collapsed:!0,events:{click:"onSelect","click .toggle-edit":"switchEditModus","click .proxy-anchor":"stopPropagation","click .freetext textarea":"stopPropagation","click .scaling select":"stopPropagation","click .end-value":"stopPropagation","click .start-value":"stopPropagation","click i.delete":"deleteFull","click .select":"onSelect","click button.in":"setCurrentTimeAsStart","click button.out":"setCurrentTimeAsEnd","click a.collapse":"onCollapse","dblclick .start":"startEdit","dblclick .end":"startEdit","dblclick .end-btn":"startEdit","dblclick .start-btn":"startEdit","keydown .start-value":"saveStart","keydown .end-value":"saveEnd","keydown .freetext textarea":"saveFreeText","focusout .start-value":"saveStart","focusout .end-value":"saveEnd","focusout .freetext textarea":"saveFreeText","change .scaling select":"saveScaling"},initialize:function(e){var t;if(!e.annotation)throw"The annotations have to be given to the annotate view.";return _.bindAll(this,"render","deleteFull","deleteView","onSelect","onSelected","selectVisually","onCollapse","startEdit","saveStart","saveEnd","saveFreeText","saveScaling","stopPropagation","switchEditModus","setCurrentTimeAsStart","setCurrentTimeAsEnd"),this.model=e.annotation,this.id=this.model.get("id"),this.isEditEnable=!1,this.commentContainer=new i({id:this.id,comments:this.model.get("comments"),collapsed:this.collapsed}),this.model.get("label")&&(t=this.model.get("label").category,t||(t=this.model.get("label").get("category")),this.scale=annotationsTool.video.get("scales").get(t.scale_id)),this.scale&&(this.scaleValues=this.scale.get("scaleValues")),_.extend(this.model,o.Events),this.listenTo(this.model,"change",this.render),this.listenTo(this.model.get("comments"),"change",this.render),this.listenTo(this.model.get("comments"),"remove",this.render),this.listenTo(this.model,"destroy",this.deleteView),this.listenTo(this.model,"remove",this.deleteView),this.typeForDelete=annotationsTool.deleteOperation.targetTypes.ANNOTATION,e.track?this.track=e.track:this.track=annotationsTool.selectedTrack,this.render()},deleteFull:function(e){e&&e.stopImmediatePropagation(),annotationsTool.deleteOperation.start(this.model,this.typeForDelete)},deleteView:function(){this.remove(),this.undelegateEvents(),this.deleted=!0},jumpTo:function(){annotationsTool.setSelection([this.model],!0)},switchEditModus:function(e){e.stopImmediatePropagation(),this.isEditEnable=!this.isEditEnable,this.$el.toggleClass("edit-on"),this.isEditEnable?(this.startEdit({currentTarget:this.$el.find(".start")[0]}),this.startEdit({currentTarget:this.$el.find(".end")[0]}),this.collapsed&&this.onCollapse()):(this.$el.find(".start input").attr("disabled","disabled"),this.$el.find(".end input").attr("disabled","disabled"),this.render())},startEdit:function(t){var n=e(t.currentTarget).find("input");t.stopImmediatePropagation&&t.stopImmediatePropagation();if(!this.model.get("isMine"))return;n.length===0&&t.currentTarget.className.match(/-btn$/)&&(n=e(t.currentTarget).parent().find(".input"),e(t.currentTarget).parent().find(".text-container span").hide()),n.attr("disabled")&&(n.removeAttr("disabled"),n.focus())},saveFreeText:function(t){var n=this.$el.find(".freetext textarea").val();if(!(t.type!=="keydown"||t.keyCode===13&&!t.shiftKey))return;this.model.set({text:n}),this.model.save(),t.type==="keydown"&&e(t.currentTarget).blur()},saveScaling:function(e){var t=_.escape(this.$el.find(".scaling select").val());if(e.type==="keydown"&&e.keyCode!==13)return;t==="OFF"?this.model.unset("scalevalue"):(this.model.set({scalevalue:this.scaleValues.get(t).toJSON()}),this.$el.find(".scaling span").html(this.scaleValues.get(t).get("name"))),this.model.save()},saveEnd:function(t){var n=e(t.currentTarget),r=n.val(),i=10,s,o;if(t.type==="keydown"&&t.keyCode!==13)return;n.removeClass("error");if(!r.match(/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/)){n.addClass("error");return}s=r.split(":"),s.length===3?o=parseInt(s[0],i)*3600+parseInt(s[1],i)*60+parseInt(s[2],i):s.length===2?o=parseInt(s[0],i)*60+parseInt(s[1],i):o=parseInt(s[0],i);if(annotationsTool.playerAdapter.getDuration()<o||this.model.get("start")>o){n.addClass("error");return}n.parent().find(".text-container span").show(),this.model.set("duration",Math.round(o-this.model.get("start"))),this.model.save(),this.isEditEnable||n.attr("disabled","disabled")},saveStart:function(t){var n=e(t.currentTarget),r=n.val(),i=10,s,o;if(t.type==="keydown"&&t.keyCode!==13)return;n.removeClass("error");if(!r.match(/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/)){n.addClass("error");return}s=r.split(":"),s.length===3?o=parseInt(s[0],i)*3600+parseInt(s[1],i)*60+parseInt(s[2],i):s.length===2?o=parseInt(s[0],i)*60+parseInt(s[1],i):o=parseInt(s[0],i);if(this.model.get("duration")+this.model.get("start")<o){n.addClass("error");return}n.parent().find("span").show(),this.model.set({start:o,duration:Math.round(this.model.get("duration")+this.model.get("start")-o)}),this.model.save(),this.isEditEnable||n.attr("disabled","disabled")},setCurrentTimeAsStart:function(e){var t=Math.round(annotationsTool.playerAdapter.getCurrentTime()),n=this.model.get("start")+this.model.get("duration");e.stopImmediatePropagation(),t<n&&(this.model.set({start:t,duration:this.model.get("duration")+this.model.get("start")-t}),this.model.save())},setCurrentTimeAsEnd:function(e){var t=Math.round(annotationsTool.playerAdapter.getCurrentTime());e.stopImmediatePropagation(),t>this.model.get("start")&&(this.model.set({duration:t-this.model.get("start")}),this.model.save())},render:function(){var t,n,r,i;return this.deleted?"":(this.model.set({collapsed:this.collapsed},{silent:!0}),t=this.model.toJSON(),t.track=this.track.get("name"),t.textReadOnly=_.escape(t.text).replace(/\n/g,"<br/>"),t.duration=t.duration||0,t.isMine&&this.scale&&t.label.category.scale_id&&(r=annotationsTool.video.get("categories").get(this.model.get("label").category.id),r?t.hasScale=r.get("settings").hasScale:t.hasScale=this.model.get("label").category.settings.hasScale,t.hasScale&&this.scale&&(n=this.scaleValues.toJSON(),i=_.where(n,{id:t.scale_value_id}),i.length>0&&(i[0].isSelected=!0)),t.scalevalues=n),t.isEditEnable=this.isEditEnable,t.numberOfComments=this.model.get("comments").length,this.$el.html(this.template(t)),this.$el.attr("id",this.id),e.browser.mozilla&&(t.duration>0&&this.$el.find(".end").append('<span class="end-btn" title="Double click to edit">&nbsp;</span>'),this.$el.find(".start").append('<span class="start-btn" title="Double click to edit">&nbsp;</span>')),this.$el.find("div#text-container"+this.id).after(this.commentContainer.render().$el),this.delegateEvents(this.events),this)},onSelect:function(){annotationsTool.hasSelection()&&annotationsTool.getSelection()[0].get("id")===this.model.get("id")?(annotationsTool.setSelection(),annotationsTool.dispatcher.trigger("unselect-annotation"),this.isSelected=!1):(annotationsTool.setSelection([this.model],!0),this.model.trigger("selected",{model:this.model}))},onSelected:function(){this.$el.hasClass("selected")||(this.$el.parent().find(".selected").removeClass("selected"),this.selectVisually())},stopPropagation:function(e){e.stopImmediatePropagation()},selectVisually:function(){this.$el.addClass("selected")},onCollapse:function(e){e&&e.stopImmediatePropagation(),this.collapsed=!this.collapsed,this.$el.find("> .header-container > div > a.collapse > i").toggleClass("icon-chevron-right").toggleClass("icon-chevron-down"),this.collapsed?(this.$el.find("> div.text-container.in").collapse("hide"),this.$el.find("> div.comments-container.in").collapse("hide")):(this.$el.find("> div.text-container.collapse").collapse("show"),this.$el.find("> div.comments-container.collapse").collapse("show"))}});return a}),define("FiltersManager",["backbone"],function(e){"use strict";var t=function(n){_.extend(this,e.Events),n instanceof t?(this.master=n,this.isBindedToMaster=!0,this.listenTo(n,"switch",this._switchListener)):n?console.warn("Parent for FiltersManager is not valid!"):(delete this.bindToMaster,delete this.unbdindFromMaster)};return t.prototype={filters:{mine:{active:!1,filter:function(e){return _.filter(e,function(e){return _.isUndefined(e.model)||e.model.get("isMine")},this)}},"public":{active:!1,filter:function(e){return _.filter(e,function(e){return _.isUndefined(e.model)||e.model.get("isPublic")},this)}}},disableFilters:function(){_.each(this.filters,function(e,t){this.switchFilter(t,!1)},this)},switchFilter:function(e,t){this.isBindedToMaster?this.master.switchFilter(e,t):this._switchFilterLocally(e,t)},_switchFilterLocally:function(e,t){this.filters[e].active=t,this.trigger("switch",{id:e,active:t})},_switchListener:function(e){this.isBindedToMaster&&this._switchFilterLocally(e.id,e.active)},getFilters:function(){return this.isBindedToMaster?this.master.filters:this.filters},bindToMaster:function(){this.isBindedToMaster=!0},unbdindFromMaster:function(){this.isBindedToMaster=!1}},t}),!function(e){e(function(){"use strict",e.support.transition=function(){var t=document.body||document.documentElement,n=t.style,r=n.transition!==undefined||n.WebkitTransition!==undefined||n.MozTransition!==undefined||n.MsTransition!==undefined||n.OTransition!==undefined;return r&&{end:function(){var t="TransitionEnd";return e.browser.webkit?t="webkitTransitionEnd":e.browser.mozilla?t="transitionend":e.browser.opera&&(t="oTransitionEnd"),t}()}}()})}(window.jQuery),!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype={constructor:n,close:function(t){function n(){s.trigger("closed").remove()}var r=e(this),i=r.attr("data-target"),s;i||(i=r.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),s=e(i),s.trigger("close"),t&&t.preventDefault(),s.length||(s=r.hasClass("alert")?r:r.parent()),s.trigger("close").removeClass("in"),e.support.transition&&s.hasClass("fade")?s.on(e.support.transition.end,n):n()}},e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e(function(){e("body").on("click.alert.data-api",t,n.prototype.close)})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype={constructor:t,setState:function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},toggle:function(){var e=this.$element.parent('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")}},e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.carousel.defaults,n),this.options.slide&&this.slide(this.options.slide),this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(){return this.interval=setInterval(e.proxy(this.next,this),this.options.interval),this},to:function(t){var n=this.$element.find(".active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(){return clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",f=this;this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u]();if(i.hasClass("active"))return;return!e.support.transition&&this.$element.hasClass("slide")?(this.$element.trigger("slide"),r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")):(i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.trigger("slide"),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger("slid")},0)})),s&&this.cycle(),this}},e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=typeof n=="object"&&n;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):typeof n=="string"||(n=s.slide)?i[n]():i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e(function(){e("body").on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=!i.data("modal")&&e.extend({},i.data(),n.data());i.carousel(s),t.preventDefault()})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find(".in"),i;r&&r.length&&(i=r.data("collapse"),r.collapse("hide"),i||r.data("collapse",null)),this.$element[t](0),this.transition("addClass","show","shown"),this.$element[t](this.$element[0][n])},hide:function(){var e=this.dimension();this.reset(this.$element[e]()),this.transition("removeClass","hide","hidden"),this.$element[e](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n=="show"&&i.reset(),i.$element.trigger(r)};this.$element.trigger(n)[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=typeof n=="object"&&n;i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e(function(){e("body").on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();e(i).collapse(s)})})}(window.jQuery),!function(e){function t(){e(n).parent().removeClass("open")}"use strict";var n='[data-toggle="dropdown"]',r=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};r.prototype={constructor:r,toggle:function(n){var r=e(this),i=r.attr("data-target"),s,o;return i||(i=r.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),s=e(i),s.length||(s=r.parent()),o=s.hasClass("open"),t(),!o&&s.toggleClass("open"),!1}},e.fn.dropdown=function(t){return this.each(function(){var n=e(this),i=n.data("dropdown");i||n.data("dropdown",i=new r(this)),typeof t=="string"&&i[t].call(n)})},e.fn.dropdown.Constructor=r,e(function(){e("html").on("click.dropdown.data-api",t),e("body").on("click.dropdown.data-api",n,r.prototype.toggle)})}(window.jQuery),!function(e){function t(){var t=this,r=setTimeout(function(){t.$element.off(e.support.transition.end),n.call(t)},500);this.$element.one(e.support.transition.end,function(){clearTimeout(r),n.call(t)})}function n(e){this.$element.hide().trigger("hidden"),r.call(this)}function r(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),s?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(i,this)):i.call(this)):t&&t()}function i(){this.$backdrop.remove(),this.$backdrop=null}function s(){var t=this;this.isShown&&this.options.keyboard?e(document).on("keyup.dismiss.modal",function(e){e.which==27&&t.hide()}):this.isShown||e(document).off("keyup.dismiss.modal")}"use strict";var o=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this))};o.prototype={constructor:o,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this;if(this.isShown)return;e("body").addClass("modal-open"),this.isShown=!0,this.$element.trigger("show"),s.call(this),r.call(this,function(){var n=e.support.transition&&t.$element.hasClass("fade");!t.$element.parent().length&&t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in"),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")})},hide:function(r){r&&r.preventDefault();if(!this.isShown)return;var i=this;this.isShown=!1,e("body").removeClass("modal-open"),s.call(this),this.$element.trigger("hide").removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?t.call(this):n.call(this)}},e.fn.modal=function(t){return this.each(function(){var n=e(this),r=n.data("modal"),i=e.extend({},e.fn.modal.defaults,n.data(),typeof t=="object"&&t);r||n.data("modal",r=new o(this,i)),typeof t=="string"?r[t]():i.show&&r.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=o,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({},i.data(),n.data());t.preventDefault(),i.modal(s)})})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger!="manual"&&(i=this.options.trigger=="hover"?"mouseenter":"focus",s=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(i,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);!n.options.delay||!n.options.delay.show?n.show():(n.hoverState="in",setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show))},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);!n.options.delay||!n.options.delay.hide?n.hide():(n.hoverState="out",setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide))},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.css(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip();e.find(".tooltip-inner").html(this.getTitle()),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){r.off(e.support.transition.end).remove()},500);r.one(e.support.transition.end,function(){clearTimeout(t),r.remove()})}var n=this,r=this.tip();r.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():r.remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e=(e||"").toString().replace(/(^\s*|\s*$)/,""),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var t=this.tip(),n=this.getTitle(),r=this.getContent();t.find(".popover-title")[e.type(n)=="object"?"append":"html"](n),t.find(".popover-content > *")[e.type(r)=="object"?"append":"html"](r),t.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content),e=e.toString().replace(/(^\s*|\s*$)/,""),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip}}),e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(e){function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body").on("click.scroll.data-api",this.selector,r),this.refresh(),this.process()}"use strict",t.prototype={constructor:t,refresh:function(){this.targets=this.$body.find(this.selector).map(function(){var t=e(this).attr("href");return/^#\w/.test(t)&&e(t).length?t:null}),this.offsets=e.map(this.targets,function(t){return e(t).position().top})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.offsets,n=this.targets,r=this.activeTarget,i;for(i=t.length;i--;)r!=n[i]&&e>=t[i]&&(!t[i+1]||e<=t[i+1])&&this.activate(n[i])},activate:function(e){var t;this.activeTarget=e,this.$body.find(this.selector).parent(".active").removeClass("active"),t=this.$body.find(this.selector+'[href="'+e+'"]').parent("li").addClass("active"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active")}},e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e(function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],t.trigger({type:"show",relatedTarget:i}),s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function i(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var s=n.find("> .active"),o=r&&e.support.transition&&s.hasClass("fade");o?s.one(e.support.transition.end,i):i(),s.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(e),this.$element.change(),this.hide()},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n=this,r,i;return this.query=this.$element.val(),this.query?(r=e.grep(this.source,function(e){if(n.matcher(e))return e}),r=this.sorter(r),r.length?this.render(r.slice(0,this.options.items)).show():this.shown?this.hide():this):this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){return e.replace(new RegExp("("+this.query+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keypress,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},keypress:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery),define("bootstrap",function(){}),!function(e){"use strict";function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var t=e(this),n=t.data("target")||t.attr("href"),r=/^#\w/.test(n)&&e(n);return r&&n.length&&[[r.position().top,n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu")&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}},e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e(function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),define("scrollspy",function(){}),define("views/list",["jquery","prototypes/player_adapter","models/annotation","collections/annotations","views/list-annotation","backbone","FiltersManager","scrollspy"],function(e,t,n,r,i,s,o){"use strict";var u=s.View.extend({el:e("div#list-container"),annotationViews:[],filters:{mine:{active:!1,filter:function(e){return _.filter(e,function(e){return e.model.get("isMine")},this)}}},events:{"click #filter-none":"disableFilter","click .filter":"switchFilter","click .toggle-collapse":"toggleVisibility","click .collapse-all":"collapseAll","click .expand-all":"expandAll"},initialize:function(){return _.bindAll(this,"render","addTrack","addAnnotation","addList","sortViewsbyTime","reset","select","unselect","switchFilter","updateFiltersRender","toggleVisibility","disableFilter","expandAll","collapseAll"),this.annotationViews=[],this.filtersManager=new o(annotationsTool.filtersManager),this.categories=annotationsTool.video.get("categories"),this.tracks=annotationsTool.video.get("tracks"),this.playerAdapter=annotationsTool.playerAdapter,this.listenTo(this.filtersManager,"switch",this.updateFiltersRender),this.listenTo(this.categories,"change",this.render),this.listenTo(this.tracks,"add",this.addTrack),this.listenTo(annotationsTool,annotationsTool.EVENTS.ANNOTATION_SELECTION,this.select),this.tracks.each(this.addTrack,this),_.extend(this,s.Events),this.render()},addTrack:function(t){var n=t.get("annotations"),r=t;this.listenTo(n,"add",e.proxy(function(e){this.addAnnotation(e,r)},this)),this.listenTo(n,"destroy",this.removeOne),this.listenTo(n,"change",this.sortViewsbyTime),this.addList(n.toArray(),r)},addAnnotation:function(e,t,n){var r;if(!e.id){this.listenTo(e,"ready",this.addAnnotation);return}r=new i({annotation:e,track:t}),this.annotationViews.push(r),n||(this.sortViewsbyTime(),annotationsTool.setSelection([e],!1))},addList:function(e,t){_.each(e,function(e){this.addAnnotation(e,t,!0)},this),e.length>0&&this.sortViewsbyTime()},select:function(e){var t;this.unselect(),_.each(e,function(e,n){t=this.getViewFromAnnotation(e.get("id")),t&&(t.selectVisually(),t.isSelected=!0,n===0&&(location.hash="#"+t.id))},this)},unselect:function(){var t,n,r=this;this.$el.find(".selected").each(function(){t=e(this).attr("id"),n=r.getViewFromAnnotation(t),e(this).removeClass("selected"),n&&(n.isSelected=!1)})},getViewFromAnnotation:function(e){return _.find(this.annotationViews,function(t){return t.model.get("id")==e},this)},removeOne:function(e){_.find(this.annotationViews,function(t,n){if(e===t.model){this.annotationViews.splice(n,1),this.render();return}},this)},sortViewsbyTime:function(){this.annotationViews=_.sortBy(this.annotationViews,function(e){return e.model.get("start")}),this.render()},switchFilter:function(t){var n=!e(t.target).hasClass("checked"),r=t.target.id.replace("filter-","");this.filtersManager.switchFilter(r,n)},updateFiltersRender:function(e){e.active?this.$el.find("#filter-"+e.id).addClass("checked"):this.$el.find("#filter-"+e.id).removeClass("checked"),this.render()},disableFilter:function(){this.$el.find("#filter").removeClass("checked"),this.filtersManager.disableFilters(),this.render()},expandAll:function(){_.each(this.annotationViews,function(e){e.collapsed&&e.onCollapse()},this)},collapseAll:function(){_.each(this.annotationViews,function(e){e.collapsed||e.onCollapse()},this)},render:function(){var e=this.annotationViews;return this.$el.find("#content-list").empty(),_.each(this.filtersManager.getFilters(),function(t){t.active&&(e=t.filter(e))}),_.each(e,function(e){this.$el.find("#content-list").append(e.render().$el)},this),this},reset:function(){this.$el.hide(),_.each(this.annotationViews,function(e){e.undelegateEvents(),e.stopListening()},this),this.stopListening(),this.annotationViews=[],this.$el.find("#content-list").empty(),delete this.annotationViews,delete this.tracks,this.undelegateEvents()},toggleVisibility:function(t){var n=this.$el.find("#content-list");n.css("display")==="none"?(n.show(),e("div#list-container").toggleClass("expanded"),e(t.target).html("Collapse")):(n.hide(),e("div#list-container").toggleClass("expanded"),e(t.target).html("Expand")),this.trigger("change-layout")}});return u}),define("text!templates/timeline-group.tmpl",[],function(){return'<div class="timeline-group{{#if isMine}} mine{{/if}} track-max-level-{{#if timlineMaxLevel}}{{timelineMaxLevel}}{{else}}0{{/if}}" {{#if isMine}}onclick="$(window).trigger(\'selectTrack\', [\'{{id}}\'])"{{/if}}>\n    <div class="track-id">{{id}}</div>\n    {{#if isMine}}\n    <i class="private icon-user" title="You own this track"></i>\n    <a id="track{{id}}" onclick="$(window).trigger(\'selectTrack\', [\'{{id}}\'])">\n    {{/if}} \n        <div class="content" title="{{secure name}}" rel="popover" data-content="{{#if description}}{{secure description}}{{else}}No description{{/if}}">\n            {{secure name}}\n        </div>\n    {{#if isMine}}\n        <div class="group-edit">\n            <i onclick="$(window).trigger(\'deleteTrack\', [\'{{id}}\'])" class="delete icon-trash" title="Delete  track"></i>\n            <i onclick="$(window).trigger(\'updateTrack\', [\'{{id}}\'])" class="visibility icon-eye-{{#if isPublic}}open{{else}}close{{/if}}" title="Change track visibility"></i>\n        </div>\n    </a>\n    {{/if}}\n</div>'}),define("text!templates/timeline-item.tmpl",[],function(){return'<div title="{{text}}" class="timeline-item {{#if atEnd}}at-end{{/if}}" style="{{#if category.settings.color}};background-color: {{category.settings.color}}{{/if}}">\n    <span>{{#if label}}<b>{{label.abbreviation}}</b>{{/if}} {{text}}</span>\n    <i class="delete icon-remove" title="Delete  annotation" onclick="annotationsTool.dispatcher.trigger(\'deleteAnnotation\', {{id}}, {{track}})"></i>\n    <div class=\'annotation-id\'>{{id}}</div>\n    <div class=\'track-id\'>{{track}}</div>\n</div>'}),define("text!templates/timeline-modal-group.tmpl",[],function(){return'<div class="modal" id="modal-add-group">\n	  <div class="modal-header">\n	    <h3>Add new track</h3>\n	  </div>\n	  <div class="modal-body">\n		<form class="form-horizontal">\n			<fieldset>\n			        <div class="alert alert-error" style="display:none">\n					<span><i class="icon-exclamation-sign"></i></span>\n					<span id="content"></span>\n					\n				</div>\n				<div class="control-group">\n					<label class="control-label" for="name"><b>*</b> Name: </label>\n					<div class="controls">\n						<input type="text" placeholder="Insert the new track name" id="name">\n					</div>\n				</div>\n				<div class="control-group">\n					<label class="control-label" for="description">Description: </label>\n					<div class="controls">\n						<input type="text" placeholder="Insert a description for the new track" id="description">\n					</div>\n				</div>\n\n				<div class="control-group">\n					<label class="control-label" for="public">Public: </label>\n					<div class="controls">\n						<input type="checkbox" id="public">\n					</div>\n				</div>\n\n\n				<div style="float:right"><b>* required fields</b></div>\n			</fieldset>\n		</form>\n	  </div>\n	  <div class="modal-footer">\n            <a href="#" class="btn" data-dismiss="modal">Cancel</a>\n	    	<a href="#" id="add-group" class="btn btn-primary">Add</a>\n	  </div>\n</div>'}),typeof links=="undefined"&&(links={}),typeof google=="undefined"&&(google=void 0),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n)e.call(t||this,this[n],n,this)}),links.Timeline=function(e){if(e){this.dom={},this.conversion={},this.eventParams={},this.groups=[],this.groupIndexes={},this.items=[],this.renderQueue={show:[],hide:[],update:[]},this.renderedItems=[],this.clusterGenerator=new links.Timeline.ClusterGenerator(this),this.currentClusters=[],this.selection=void 0,this.listeners={},this.size={actualHeight:0,axis:{characterMajorHeight:0,characterMajorWidth:0,characterMinorHeight:0,characterMinorWidth:0,height:0,labelMajorTop:0,labelMinorTop:0,line:0,lineMajorWidth:0,lineMinorHeight:0,lineMinorTop:0,lineMinorWidth:0,top:0},contentHeight:0,contentLeft:0,contentWidth:0,frameHeight:0,frameWidth:0,groupsLeft:0,groupsWidth:0,items:{top:0}},this.dom.container=e,this.options={width:"100%",height:"auto",minHeight:0,autoHeight:!0,eventMargin:10,eventMarginAxis:20,dragAreaWidth:10,min:void 0,max:void 0,intervalMin:10,intervalMax:31536e10,moveable:!0,zoomable:!0,selectable:!0,editable:!1,snapEvents:!0,groupChangeable:!0,showCurrentTime:!0,showCustomTime:!1,showMajorLabels:!0,showMinorLabels:!0,showNavigation:!1,showButtonNew:!1,groupsOnRight:!1,axisOnTop:!1,stackEvents:!0,animate:!0,animateZoom:!0,cluster:!1,style:"box",customStackOrder:!1},this.clientTimeOffset=0;for(e=this.dom;e.container.hasChildNodes();)e.container.removeChild(e.container.firstChild);this.step=new links.Timeline.StepDate,this.itemTypes={box:links.Timeline.ItemBox,range:links.Timeline.ItemRange,dot:links.Timeline.ItemDot},this.data=[],this.firstDraw=!0,this.setVisibleChartRange(void 0,void 0,!1),this.render();var t=this;setTimeout(function(){t.trigger("ready")},0)}},links.Timeline.prototype.draw=function(e,t){this.setOptions(t),this.setData(e),t&&(t.start||t.end)?this.setVisibleChartRange(t.start,t.end):this.firstDraw&&this.setVisibleChartRangeAuto(),this.firstDraw=!1},links.Timeline.prototype.setOptions=function(e){if(e){for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);e.showButtonAdd!=void 0&&(this.options.showButtonNew=e.showButtonAdd,console.log("WARNING: Option showButtonAdd is deprecated. Use showButtonNew instead")),e.scale&&e.step&&this.step.setScale(e.scale,e.step)}this.options.autoHeight=this.options.height==="auto"},links.Timeline.prototype.addItemType=function(e,t){this.itemTypes[e]=t},links.Timeline.mapColumnIds=function(e){for(var t={},n=e.getNumberOfColumns(),r=!0,i=0;i<n;i++){var s=e.getColumnId(i)||e.getColumnLabel(i);t[s]=i;if(s=="start"||s=="end"||s=="content"||s=="group"||s=="className"||s=="editable")r=!1}return r&&(t.start=0,t.end=1,t.content=2),t},links.Timeline.prototype.setData=function(e){this.unselectItem(),e||(e=[]),this.stackCancelAnimation(),this.clearItems(),this.data=e;var t=this.items;this.deleteGroups();if(google&&google.visualization&&e instanceof google.visualization.DataTable)for(var n=links.Timeline.mapColumnIds(e),r=0,i=e.getNumberOfRows();r<i;r++)t.push(this.createItem({start:n.start!=void 0?e.getValue(r,n.start):void 0,end:n.end!=void 0?e.getValue(r,n.end):void 0,content:n.content!=void 0?e.getValue(r,n.content):void 0,group:n.group!=void 0?e.getValue(r,n.group):void 0,className:n.className!=void 0?e.getValue(r,n.className):void 0,editable:n.editable!=void 0?e.getValue(r,n.editable):void 0}));else{if(!links.Timeline.isArray(e))throw"Unknown data type. DataTable or Array expected.";r=0;for(i=e.length;r<i;r++)n=this.createItem(e[r]),t.push(n)}this.options.cluster&&this.clusterGenerator.setData(this.items),this.render({animate:!1})},links.Timeline.prototype.getData=function(){return this.data},links.Timeline.prototype.updateData=function(e,t){var n=this.data,r;if(google&&google.visualization&&n instanceof google.visualization.DataTable){var i=e+1-n.getNumberOfRows();i>0&&n.addRows(i),i=links.Timeline.mapColumnIds(n);for(r in t)if(t.hasOwnProperty(r)){var s=i[r];if(s==void 0){var s=t[r],o="string";typeof s=="number"?o="number":typeof s=="boolean"?o="boolean":s instanceof Date&&(o="datetime"),s=n.addColumn(o,r)}n.setValue(e,s,t[r])}}else{if(!links.Timeline.isArray(n))throw"Cannot update data, unknown type of data";for(r in i=n[e],i==void 0&&(i={},n[e]=i),t)t.hasOwnProperty(r)&&(i[r]=t[r])}},links.Timeline.prototype.getItemIndex=function(e){for(var t=this.dom.items.frame,n=this.items,r=void 0;e.parentNode&&e.parentNode!==t;)e=e.parentNode;if(e.parentNode===t)for(var t=0,i=n.length;t<i;t++)if(n[t].dom===e){r=t;break}return r},links.Timeline.prototype.setSize=function(e,t){e&&(this.options.width=e,this.dom.frame.style.width=e),t&&(this.options.height=t,this.options.autoHeight=this.options.height==="auto",t!=="auto")&&(this.dom.frame.style.height=t),this.render({animate:!1})},links.Timeline.prototype.setVisibleChartRange=function(e,t,n){var r={};if(!e||!t)r=this.getDataRange(!0);e||(t?r.min&&r.min.valueOf()<t.valueOf()?e=r.min:(e=new Date(t.valueOf()),e.setDate(e.getDate()-7)):(e=new Date,e.setDate(e.getDate()-3))),t||(r.max?t=r.max:(t=new Date(e.valueOf()),t.setDate(t.getDate()+7))),t<=e&&(t=new Date(e.valueOf()),t.setDate(t.getDate()+7)),r=this.options.min?this.options.min:void 0,r!=void 0&&e.valueOf()<r.valueOf()&&(e=new Date(r.valueOf())),r=this.options.max?this.options.max:void 0,r!=void 0&&t.valueOf()>r.valueOf()&&(t=new Date(r.valueOf())),this.applyRange(e,t),n==void 0||n==1?this.render({animate:!1}):this.recalcConversion()},links.Timeline.prototype.setVisibleChartRangeAuto=function(){var e=this.getDataRange(!0);this.setVisibleChartRange(e.min,e.max)},links.Timeline.prototype.setVisibleChartRangeNow=function(){var e=this.end.valueOf()-this.start.valueOf(),t=new Date((new Date).valueOf()-e/2);this.setVisibleChartRange(t,new Date(t.valueOf()+e))},links.Timeline.prototype.getVisibleChartRange=function(){return{start:new Date(this.start.valueOf()),end:new Date(this.end.valueOf())}},links.Timeline.prototype.getDataRange=function(e){var t=this.items,n=void 0,r=void 0;if(t)for(var i=0,s=t.length;i<s;i++)var o=t[i],u=o.start!=void 0?o.start.valueOf():void 0,o=o.end!=void 0?o.end.valueOf():u,n=n!=void 0&&u!=void 0?Math.min(n.valueOf(),u.valueOf()):u,r=r!=void 0&&o!=void 0?Math.max(r,o):o;return n&&r&&e&&(e=r-n,n-=e*.05,r+=e*.05),{min:n!=void 0?new Date(n):void 0,max:r!=void 0?new Date(r):void 0}},links.Timeline.prototype.render=function(e){this.reflowFrame(),this.reflowAxis(),this.reflowGroups(),this.reflowItems();var t=this.options.animate;e&&e.animate!=void 0&&(t=e.animate),this.recalcConversion(),this.clusterItems(),this.filterItems(),this.stackItems(t),this.recalcItems(),this.repaint()&&(t=e?e.renderTimesLeft:void 0,t==void 0&&(t=5),t>0&&this.render({animate:e?e.animate:void 0,renderTimesLeft:t-1}))},links.Timeline.prototype.repaint=function(){var e=this.repaintFrame(),t=this.repaintAxis(),n=this.repaintGroups(),r=this.repaintItems();return this.repaintCurrentTime(),this.repaintCustomTime(),e||t||n||r},links.Timeline.prototype.reflowFrame=function(){var e=this.dom,t=this.size,n=e.frame?e.frame.offsetWidth:0,r=e.frame?e.frame.clientHeight:0,e=(e=t.frameWidth!==n)||t.frameHeight!==r;return t.frameWidth=n,t.frameHeight=r,e},links.Timeline.prototype.repaintFrame=function(){var e=!1,t=this.dom,n=this.options,r=this.size;t.frame||(t.frame=document.createElement("DIV"),t.frame.className="timeline-frame",t.frame.style.position="relative",t.frame.style.overflow="hidden",t.container.appendChild(t.frame),e=!0);var i=n.autoHeight?r.actualHeight+"px":n.height||"100%",n=n.width||"100%",e=(e=e||t.frame.style.height!=i)||t.frame.style.width!=n;t.frame.style.height=i,t.frame.style.width=n;if(!t.content){t.content=document.createElement("DIV"),t.content.style.position="relative",t.content.style.overflow="hidden",t.frame.appendChild(t.content),e=document.createElement("DIV"),e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.height="100%",e.style.width="0px",t.content.appendChild(e),t.contentTimelines=e;var e=this.eventParams,s=this;e.onMouseDown||(e.onMouseDown=function(e){s.onMouseDown(e)},links.Timeline.addEventListener(t.content,"mousedown",e.onMouseDown)),e.onTouchStart||(e.onTouchStart=function(e){s.onTouchStart(e)},links.Timeline.addEventListener(t.content,"touchstart",e.onTouchStart)),e.onMouseWheel||(e.onMouseWheel=function(e){s.onMouseWheel(e)},links.Timeline.addEventListener(t.content,"mousewheel",e.onMouseWheel)),e.onDblClick||(e.onDblClick=function(e){s.onDblClick(e)},links.Timeline.addEventListener(t.content,"dblclick",e.onDblClick)),e=!0}return t.content.style.left=r.contentLeft+"px",t.content.style.top="0px",t.content.style.width=r.contentWidth+"px",t.content.style.height=r.frameHeight+"px",this.repaintNavigation(),e},links.Timeline.prototype.reflowAxis=function(){var e,t=this.options,n=this.size,r=this.dom.axis,i=r&&r.characterMinor?r.characterMinor.clientWidth:0,s=r&&r.characterMinor?r.characterMinor.clientHeight:0,o=r&&r.characterMajor?r.characterMajor.clientWidth:0,u=r&&r.characterMajor?r.characterMajor.clientHeight:0,a=(t.showMinorLabels?s:0)+(t.showMajorLabels?u:0),f=t.axisOnTop?0:n.frameHeight-a,l=t.axisOnTop?a:f;return e=(e=(e=n.axis.top!==f)||n.axis.line!==l)||n.axis.height!==a,n.axis.top=f,n.axis.line=l,n.axis.height=a,n.axis.labelMajorTop=t.axisOnTop?0:l+(t.showMinorLabels?s:0),n.axis.labelMinorTop=t.axisOnTop?t.showMajorLabels?u:0:l,n.axis.lineMinorTop=t.axisOnTop?n.axis.labelMinorTop:0,n.axis.lineMinorHeight=t.showMajorLabels?n.frameHeight-u:n.frameHeight,n.axis.lineMinorWidth=r&&r.minorLines&&r.minorLines.length?r.minorLines[0].offsetWidth:1,n.axis.lineMajorWidth=r&&r.majorLines&&r.majorLines.length?r.majorLines[0].offsetWidth:1,e=(e=(e=(e=e||n.axis.characterMinorWidth!==i)||n.axis.characterMinorHeight!==s)||n.axis.characterMajorWidth!==o)||n.axis.characterMajorHeight!==u,n.axis.characterMinorWidth=i,n.axis.characterMinorHeight=s,n.axis.characterMajorWidth=o,n.axis.characterMajorHeight=u,r=Math.max(n.frameHeight-a,0),n.contentLeft=t.groupsOnRight?0:n.groupsWidth,n.contentWidth=Math.max(n.frameWidth-n.groupsWidth,0),n.contentHeight=r,e},links.Timeline.prototype.repaintAxis=function(){var e=!1,t=this.dom,n=this.options,r=this.size,i=this.step,s=t.axis;s||(s={},t.axis=s),r.axis.properties||(r.axis.properties={}),s.minorTexts||(s.minorTexts=[]),s.minorLines||(s.minorLines=[]),s.majorTexts||(s.majorTexts=[]),s.majorLines||(s.majorLines=[]),s.frame||(s.frame=document.createElement("DIV"),s.frame.style.position="absolute",s.frame.style.left="0px",s.frame.style.top="0px",t.content.appendChild(s.frame)),t.content.removeChild(s.frame),s.frame.style.width=r.contentWidth+"px",s.frame.style.height=r.axis.height+"px";var o=this.screenToTime(0),u=this.screenToTime(r.contentWidth);r.axis.characterMinorWidth&&(this.minimumStep=this.screenToTime(r.axis.characterMinorWidth*6)-this.screenToTime(0),i.setRange(o,u,this.minimumStep)),o=this.repaintAxisCharacters(),e=e||o,this.repaintAxisStartOverwriting(),i.start(),o=void 0;for(u=0;!i.end()&&u<1e3;){u++;var a=this.timeToScreen(i.getCurrent()),f=i.isMajor();n.showMinorLabels&&this.repaintAxisMinorText(a,i.getLabelMinor()),f&&n.showMajorLabels?(a>0&&(o==void 0&&(o=a),this.repaintAxisMajorText(a,i.getLabelMajor())),this.repaintAxisMajorLine(a)):this.repaintAxisMinorLine(a),i.next()}return n.showMajorLabels&&(n=this.screenToTime(0),i=this.step.getLabelMajor(n),r=i.length*r.axis.characterMajorWidth+10,(o==void 0||r<o)&&this.repaintAxisMajorText(0,i,n)),this.repaintAxisEndOverwriting(),this.repaintAxisHorizontal(),t.content.insertBefore(s.frame,t.content.firstChild),e},links.Timeline.prototype.repaintAxisCharacters=function(){var e=!1,t=this.dom.axis;if(!t.characterMinor){var e=document.createTextNode("0"),n=document.createElement("DIV");n.className="timeline-axis-text timeline-axis-text-minor",n.appendChild(e),n.style.position="absolute",n.style.visibility="hidden",n.style.paddingLeft="0px",n.style.paddingRight="0px",t.frame.appendChild(n),t.characterMinor=n,e=!0}return t.characterMajor||(e=document.createTextNode("0"),n=document.createElement("DIV"),n.className="timeline-axis-text timeline-axis-text-major",n.appendChild(e),n.style.position="absolute",n.style.visibility="hidden",n.style.paddingLeft="0px",n.style.paddingRight="0px",t.frame.appendChild(n),t.characterMajor=n,e=!0),e},links.Timeline.prototype.repaintAxisStartOverwriting=function(){var e=this.size.axis.properties;e.minorTextNum=0,e.minorLineNum=0,e.majorTextNum=0,e.majorLineNum=0},links.Timeline.prototype.repaintAxisEndOverwriting=function(){var e=this.dom,t=this.size.axis.properties,n=this.dom.axis.frame,r,i=e.axis.minorTexts;for(r=t.minorTextNum;i.length>r;)n.removeChild(i[r]),i.splice(r,1);i=e.axis.minorLines;for(r=t.minorLineNum;i.length>r;)n.removeChild(i[r]),i.splice(r,1);i=e.axis.majorTexts;for(r=t.majorTextNum;i.length>r;)n.removeChild(i[r]),i.splice(r,1);e=e.axis.majorLines;for(r=t.majorLineNum;e.length>r;)n.removeChild(e[r]),e.splice(r,1)},links.Timeline.prototype.repaintAxisHorizontal=function(){var e=this.dom.axis,t=this.size,n=this.options;if(n=n.showMinorLabels||n.showMajorLabels){if(!e.backgroundLine){var r=document.createElement("DIV");r.className="timeline-axis",r.style.position="absolute",r.style.left="0px",r.style.width="100%",r.style.border="none",e.frame.insertBefore(r,e.frame.firstChild),e.backgroundLine=r}e.backgroundLine&&(e.backgroundLine.style.top=t.axis.top+"px",e.backgroundLine.style.height=t.axis.height+"px")}else e.backgroundLine&&(e.frame.removeChild(e.backgroundLine),delete e.backgroundLine);n?(e.line?(n=e.frame.removeChild(e.line),e.frame.appendChild(n)):(n=document.createElement("DIV"),n.className="timeline-axis",n.style.position="absolute",n.style.left="0px",n.style.width="100%",n.style.height="0px",e.frame.appendChild(n),e.line=n),e.line.style.top=t.axis.line+"px"):e.line&&e.line.parentElement&&(e.frame.removeChild(e.line),delete e.line)},links.Timeline.prototype.repaintAxisMinorText=function(e,t){var n=this.size,r=this.dom,i=n.axis.properties,s=r.axis.frame,r=r.axis.minorTexts,o=i.minorTextNum;if(o<r.length)o=r[o];else{var u=document.createTextNode(""),o=document.createElement("DIV");o.appendChild(u),o.className="timeline-axis-text timeline-axis-text-minor",o.style.position="absolute",s.appendChild(o),r.push(o)}o.childNodes[0].nodeValue=t,o.style.left=e+"px",o.style.top=n.axis.labelMinorTop+"px",i.minorTextNum++},links.Timeline.prototype.repaintAxisMinorLine=function(e){var t=this.size.axis,n=this.dom,r=t.properties,i=n.axis.frame,n=n.axis.minorLines,s=r.minorLineNum;s<n.length?s=n[s]:(s=document.createElement("DIV"),s.className="timeline-axis-grid timeline-axis-grid-minor",s.style.position="absolute",s.style.width="0px",i.appendChild(s),n.push(s)),s.style.top=t.lineMinorTop+"px",s.style.height=t.lineMinorHeight+"px",s.style.left=e-t.lineMinorWidth/2+"px",r.minorLineNum++},links.Timeline.prototype.repaintAxisMajorText=function(e,t){var n=this.size,r=n.axis.properties,i=this.dom.axis.frame,s=this.dom.axis.majorTexts,o=r.majorTextNum;if(o<s.length)o=s[o];else{var u=document.createTextNode(t),o=document.createElement("DIV");o.className="timeline-axis-text timeline-axis-text-major",o.appendChild(u),o.style.position="absolute",o.style.top="0px",i.appendChild(o),s.push(o)}o.childNodes[0].nodeValue=t,o.style.top=n.axis.labelMajorTop+"px",o.style.left=e+"px",r.majorTextNum++},links.Timeline.prototype.repaintAxisMajorLine=function(e){var t=this.size,n=t.axis.properties,r=this.size.axis,i=this.dom.axis.frame,s=this.dom.axis.majorLines,o=n.majorLineNum;o<s.length?o=s[o]:(o=document.createElement("DIV"),o.className="timeline-axis-grid timeline-axis-grid-major",o.style.position="absolute",o.style.top="0px",o.style.width="0px",i.appendChild(o),s.push(o)),o.style.left=e-r.lineMajorWidth/2+"px",o.style.height=t.frameHeight+"px",n.majorLineNum++},links.Timeline.prototype.reflowItems=function(){var e=!1,t,n,r;t=this.groups;var i=this.renderedItems;t&&t.forEach(function(e){e.itemsHeight=0});for(t=0,n=i.length;t<n;t++){var s=i[t],o=s.dom;r=s.group;if(o){var u=o?o.clientWidth:0,o=o?o.clientHeight:0,e=(e=e||s.width!=u)||s.height!=o;s.width=u,s.height=o,s.reflow()}r&&(r.itemsHeight=r.itemsHeight?Math.max(r.itemsHeight,s.height):s.height)}return e},links.Timeline.prototype.recalcItems=function(){var e=!1,t,n,r,i;r=this.groups;var s=this.size,o=this.options,u=this.renderedItems,a=0;if(r.length==0){if(o.autoHeight||o.cluster){var f=a=0;if(this.stack&&this.stack.finalItems){i=this.stack.finalItems,(r=i[0])&&r.top&&(a=r.top,f=r.top+r.height);for(t=1,n=i.length;t<n;t++)r=i[t],a=Math.min(a,r.top),f=Math.max(f,r.top+r.height)}else{(r=u[0])&&r.top&&(a=r.top,f=r.top+r.height);for(t=1,n=u.length;t<n;t++)r=u[t],r.top&&(a=Math.min(a,r.top),f=Math.max(f,r.top+r.height))}a=f-a+2*o.eventMarginAxis+s.axis.height,a<o.minHeight&&(a=o.minHeight);if(s.actualHeight!=a&&o.autoHeight&&!o.axisOnTop)if(r=a-s.actualHeight,this.stack&&this.stack.finalItems){i=this.stack.finalItems;for(t=0,n=i.length;t<n;t++)i[t].top+=r,i[t].item.top+=r}else for(t=0,n=u.length;t<n;t++)u[t].top+=r}}else{a=s.axis.height+2*o.eventMarginAxis;for(t=0,n=r.length;t<n;t++)i=r[t],f=Math.max(i.labelHeight||0,i.itemsHeight||0),e=e||f!=i.height,i.height=f,a+=r[t].height+o.eventMargin;var e=o.eventMargin,f=o.axisOnTop?o.eventMarginAxis+e/2:s.contentHeight-o.eventMarginAxis+e/2,l=s.axis.height;for(t=0,n=r.length;t<n;t++)i=r[t],o.axisOnTop?(i.top=f+l,i.labelTop=f+l+(i.height-i.labelHeight)/2,i.lineTop=f+l+i.height+e/2,f+=i.height+e):(f-=i.height+e,i.top=f,i.labelTop=f+(i.height-i.labelHeight)/2,i.lineTop=f-e/2);for(t=0,n=u.length;t<n;t++)if(r=u[t],i=r.group)r.top=i.top;e=!0}return a<o.minHeight&&(a=o.minHeight),e=e||a!=s.actualHeight,s.actualHeight=a,e},links.Timeline.prototype.clearItems=function(){var e=this.renderQueue.hide;this.renderedItems.forEach(function(t){e.push(t)}),this.clusterGenerator.clear(),this.items=[]},links.Timeline.prototype.repaintItems=function(){var e,t,n=!1,r=this.dom;e=this.size;var i=this,s=this.renderedItems;r.items||(r.items={});var o=r.items.frame;o||(o=document.createElement("DIV"),o.style.position="relative",r.content.appendChild(o),r.items.frame=o),o.style.left="0px",o.style.top=e.items.top+"px",o.style.height="0px",r.content.removeChild(o);for(var u=this.renderQueue,a=[],n=n||u.show.length>0||u.update.length>0||u.hide.length>0;e=u.show.shift();)e.showDOM(o),e.getImageUrls(a),s.push(e);for(;e=u.update.shift();)e.updateDOM(o),e.getImageUrls(a),t=this.renderedItems.indexOf(e),t==-1&&s.push(e);for(;e=u.hide.shift();)e.hideDOM(o),t=this.renderedItems.indexOf(e),t!=-1&&s.splice(t,1);return s.forEach(function(e){e.updatePosition(i)}),this.repaintDeleteButton(),this.repaintDragAreas(),r.content.appendChild(o),a.length&&links.imageloader.loadAll(a,function(){i.render()},!1),n},links.Timeline.prototype.reflowGroups=function(){for(var e=!1,t=this.options,n=this.size,r=this.dom,i=0,s=this.groups,o=this.dom.groups?this.dom.groups.labels:[],u=0,a=s.length;u<a;u++){var f=s[u],l=o[u];f.labelWidth=l?l.clientWidth:0,f.labelHeight=l?l.clientHeight:0,f.width=f.labelWidth,i=Math.max(i,f.width)}return t.groupsWidth!==void 0&&(i=r.groups.frame?r.groups.frame.clientWidth:0),i+=1,t=t.groupsOnRight?n.frameWidth-i:0,e=(e=e||n.groupsWidth!==i)||n.groupsLeft!==t,n.groupsWidth=i,n.groupsLeft=t,e},links.Timeline.prototype.repaintGroups=function(){var e=this.dom,t=this.options,n=this.size,r=this.groups;e.groups===void 0&&(e.groups={});var i=e.groups.labels;i||(i=[],e.groups.labels=i);var s=e.groups.labelLines;s||(s=[],e.groups.labelLines=s);var o=e.groups.itemLines;o||(o=[],e.groups.itemLines=o);var u=e.groups.frame;u||(u=document.createElement("DIV"),u.className="timeline-groups-axis",u.style.position="absolute",u.style.overflow="hidden",u.style.top="0px",u.style.height="100%",e.frame.appendChild(u),e.groups.frame=u),u.style.left=n.groupsLeft+"px",u.style.width=t.groupsWidth!==void 0?t.groupsWidth:n.groupsWidth+"px",u.style.display=r.length==0?"none":"";for(var a=i.length,f=r.length,l=0,c=Math.min(a,f);l<c;l++){var h=r[l],p=i[l];p.innerHTML=this.getGroupName(h),p.style.display=""}for(l=a;l<f;l++){h=r[l],p=document.createElement("DIV"),p.className="timeline-groups-text",p.style.position="absolute",t.groupsWidth===void 0&&(p.style.whiteSpace="nowrap"),p.innerHTML=this.getGroupName(h),u.appendChild(p),i[l]=p;var d=document.createElement("DIV");d.className="timeline-axis-grid timeline-axis-grid-minor",d.style.position="absolute",d.style.left="0px",d.style.width="100%",d.style.height="0px",d.style.borderTopStyle="solid",u.appendChild(d),s[l]=d;var v=document.createElement("DIV");v.className="timeline-axis-grid timeline-axis-grid-minor",v.style.position="absolute",v.style.left="0px",v.style.width="100%",v.style.height="0px",v.style.borderTopStyle="solid",e.content.insertBefore(v,e.content.firstChild),o[l]=v}for(l=f;l<a;l++)p=i[l],d=s[l],v=o[l],u.removeChild(p),u.removeChild(d),e.content.removeChild(v);i.splice(f,a-f),s.splice(f,a-f),o.splice(f,a-f),u.style.borderStyle=t.groupsOnRight?"none none none solid":"none solid none none",l=0;for(c=r.length;l<c;l++)h=r[l],p=i[l],d=s[l],v=o[l],p.style.top=h.labelTop+"px",d.style.top=h.lineTop+"px",v.style.top=h.lineTop+"px",v.style.width=n.contentWidth+"px";e.groups.background||(t=document.createElement("DIV"),t.className="timeline-axis",t.style.position="absolute",t.style.left="0px",t.style.width="100%",t.style.border="none",u.appendChild(t),e.groups.background=t),e.groups.background.style.top=n.axis.top+"px",e.groups.background.style.height=n.axis.height+"px",e.groups.line||(t=document.createElement("DIV"),t.className="timeline-axis",t.style.position="absolute",t.style.left="0px",t.style.width="100%",t.style.height="0px",u.appendChild(t),e.groups.line=t),e.groups.line.style.top=n.axis.line+"px",e.groups.frame&&r.length&&(n=[],links.imageloader.filterImageUrls(e.groups.frame,n),n.length&&links.imageloader.loadAll(n,function(){timeline.render()},!1))},links.Timeline.prototype.repaintCurrentTime=function(){var e=this.dom,t=this.size;if(this.options.showCurrentTime){if(!e.currentTime){var n=document.createElement("DIV");n.className="timeline-currenttime",n.style.position="absolute",n.style.top="0px",n.style.height="100%",e.contentTimelines.appendChild(n),e.currentTime=n}var n=new Date((new Date).valueOf()+this.clientTimeOffset),r=this.timeToScreen(n);e.currentTime.style.display=r>-t.contentWidth&&r<2*t.contentWidth?"":"none",e.currentTime.style.left=r+"px",e.currentTime.title="Current time: "+n,this.currentTimeTimer!=void 0&&(clearTimeout(this.currentTimeTimer),delete this.currentTimeTimer);var i=this,e=1/this.conversion.factor/2;e<30&&(e=30),this.currentTimeTimer=setTimeout(function(){i.repaintCurrentTime()},e)}else e.currentTime&&(e.contentTimelines.removeChild(e.currentTime),delete e.currentTime)},links.Timeline.prototype.repaintCustomTime=function(){var e=this.dom,t=this.size;if(this.options.showCustomTime){if(!e.customTime){var n=document.createElement("DIV");n.className="timeline-customtime",n.style.position="absolute",n.style.top="0px",n.style.height="100%";var r=document.createElement("DIV");r.style.position="relative",r.style.top="0px",r.style.left="-10px",r.style.height="100%",r.style.width="20px",n.appendChild(r),e.contentTimelines.appendChild(n),e.customTime=n,this.customTime=new Date}n=this.timeToScreen(this.customTime),e.customTime.style.display=n>-t.contentWidth&&n<2*t.contentWidth?"":"none",e.customTime.style.left=n+"px",e.customTime.title="Time: "+this.customTime}else e.customTime&&(e.contentTimelines.removeChild(e.customTime),delete e.customTime)},links.Timeline.prototype.repaintDeleteButton=function(){var e=this.dom,t=e.items.frame,n=e.items.deleteButton;n||(n=document.createElement("DIV"),n.className="timeline-navigation-delete",n.style.position="absolute",t.appendChild(n),e.items.deleteButton=n);var e=this.selection?this.selection.index:-1,r=this.selection?this.items[e]:void 0;r&&r.rendered&&this.isEditable(r)?(e=r.getRight(this),r=r.top,n.style.left=e+"px",n.style.top=r+"px",n.style.display="",t.removeChild(n),t.appendChild(n)):n.style.display="none"},links.Timeline.prototype.repaintDragAreas=function(){var e=this.options,t=this.dom,n=this.dom.items.frame,r=t.items.dragLeft;r||(r=document.createElement("DIV"),r.className="timeline-event-range-drag-left",r.style.position="absolute",n.appendChild(r),t.items.dragLeft=r);var i=t.items.dragRight;i||(i=document.createElement("DIV"),i.className="timeline-event-range-drag-right",i.style.position="absolute",n.appendChild(i),t.items.dragRight=i);var t=this.selection?this.selection.index:-1,s=this.selection?this.items[t]:void 0;if(s&&s.rendered&&this.isEditable(s)&&s instanceof links.Timeline.ItemRange){var t=this.timeToScreen(s.start),o=this.timeToScreen(s.end),u=s.top,s=s.height;r.style.left=t+"px",r.style.top=u+"px",r.style.width=e.dragAreaWidth+"px",r.style.height=s+"px",r.style.display="",n.removeChild(r),n.appendChild(r),i.style.left=o-e.dragAreaWidth+"px",i.style.top=u+"px",i.style.width=e.dragAreaWidth+"px",i.style.height=s+"px",i.style.display="",n.removeChild(i),n.appendChild(i)}else r.style.display="none",i.style.display="none"},links.Timeline.prototype.repaintNavigation=function(){var e=this,t=this.options,n=this.dom,r=n.frame,i=n.navBar;if(!i){if(t.showNavigation||t.showButtonNew)i=document.createElement("DIV"),i.style.position="absolute",i.className="timeline-navigation",t.groupsOnRight?i.style.left="10px":i.style.right="10px",t.axisOnTop?i.style.bottom="10px":i.style.top="10px",n.navBar=i,r.appendChild(i);t.editable&&t.showButtonNew&&(i.addButton=document.createElement("DIV"),i.addButton.className="timeline-navigation-new",i.addButton.title="Create new event",links.Timeline.addEventListener(i.addButton,"mousedown",function(n){links.Timeline.preventDefault(n),links.Timeline.stopPropagation(n);var r=e.size.contentWidth,i=r/2,n=e.screenToTime(i-r/10),r=e.screenToTime(i+r/10);t.snapEvents&&(e.step.snap(n),e.step.snap(r)),e.addItem({start:n,end:r,content:"New",group:e.groups.length?e.groups[0].content:void 0},!0),n=e.items.length-1,e.selectItem(n),e.applyAdd=!0,e.trigger("add"),e.applyAdd?(e.render({animate:!1}),e.selectItem(n)):e.deleteItem(n)}),i.appendChild(i.addButton)),t.editable&&t.showButtonNew&&t.showNavigation&&(i.addButton.style.borderRightWidth="1px",i.addButton.style.borderRightStyle="solid"),t.showNavigation&&(i.zoomInButton=document.createElement("DIV"),i.zoomInButton.className="timeline-navigation-zoom-in",i.zoomInButton.title="Zoom in",links.Timeline.addEventListener(i.zoomInButton,"mousedown",function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.zoom(.4),e.trigger("rangechange"),e.trigger("rangechanged")}),i.appendChild(i.zoomInButton),i.zoomOutButton=document.createElement("DIV"),i.zoomOutButton.className="timeline-navigation-zoom-out",i.zoomOutButton.title="Zoom out",links.Timeline.addEventListener(i.zoomOutButton,"mousedown",function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.zoom(-0.4),e.trigger("rangechange"),e.trigger("rangechanged")}),i.appendChild(i.zoomOutButton),i.moveLeftButton=document.createElement("DIV"),i.moveLeftButton.className="timeline-navigation-move-left",i.moveLeftButton.title="Move left",links.Timeline.addEventListener(i.moveLeftButton,"mousedown",function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.move(-0.2),e.trigger("rangechange"),e.trigger("rangechanged")}),i.appendChild(i.moveLeftButton),i.moveRightButton=document.createElement("DIV"),i.moveRightButton.className="timeline-navigation-move-right",i.moveRightButton.title="Move right",links.Timeline.addEventListener(i.moveRightButton,"mousedown",function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.move(.2),e.trigger("rangechange"),e.trigger("rangechanged")}),i.appendChild(i.moveRightButton))}},links.Timeline.prototype.setCurrentTime=function(e){this.clientTimeOffset=e.valueOf()-(new Date).valueOf(),this.repaintCurrentTime()},links.Timeline.prototype.getCurrentTime=function(){return new Date((new Date).valueOf()+this.clientTimeOffset)},links.Timeline.prototype.setCustomTime=function(e){this.customTime=new Date(e.valueOf()),this.repaintCustomTime()},links.Timeline.prototype.getCustomTime=function(){return new Date(this.customTime.valueOf())},links.Timeline.prototype.setScale=function(e,t){this.step.setScale(e,t),this.render()},links.Timeline.prototype.setAutoScale=function(e){this.step.setAutoScale(e),this.render()},links.Timeline.prototype.redraw=function(){this.setData(this.data)},links.Timeline.prototype.checkResize=function(){this.render()},links.Timeline.prototype.isEditable=function(e){return e?e.editable!=void 0?e.editable:this.options.editable:!1},links.Timeline.prototype.recalcConversion=function(){this.conversion.offset=this.start.valueOf(),this.conversion.factor=this.size.contentWidth/(this.end.valueOf()-this.start.valueOf())},links.Timeline.prototype.screenToTime=function(e){var t=this.conversion;return new Date(e/t.factor+t.offset)},links.Timeline.prototype.timeToScreen=function(e){var t=this.conversion;return(e.valueOf()-t.offset)*t.factor},links.Timeline.prototype.onTouchStart=function(e){var t=this.eventParams,n=this;if(!t.touchDown){t.touchDown=!0,t.zoomed=!1,this.onMouseDown(e),t.onTouchMove||(t.onTouchMove=function(e){n.onTouchMove(e)},links.Timeline.addEventListener(document,"touchmove",t.onTouchMove)),t.onTouchEnd||(t.onTouchEnd=function(e){n.onTouchEnd(e)},links.Timeline.addEventListener(document,"touchend",t.onTouchEnd));var r=this.getItemIndex(links.Timeline.getTarget(e));t.doubleTapStartPrev=t.doubleTapStart,t.doubleTapStart=(new Date).valueOf(),t.doubleTapItemPrev=t.doubleTapItem,t.doubleTapItem=r,links.Timeline.preventDefault(e)}},links.Timeline.prototype.onTouchMove=function(e){var t=this.eventParams;e.scale&&e.scale!==1&&(t.zoomed=!0);if(t.zoomed){if(this.options.zoomable){t.zoomed=!0;var n=t.end.valueOf()-t.start.valueOf(),r=n/e.scale-n,n=new Date(parseInt(t.start.valueOf()-r/2)),t=new Date(parseInt(t.end.valueOf()+r/2));this.setVisibleChartRange(n,t),this.trigger("rangechange")}}else this.onMouseMove(e);links.Timeline.preventDefault(e)},links.Timeline.prototype.onTouchEnd=function(e){var t=this.eventParams;t.touchDown=!1,t.zoomed&&this.trigger("rangechanged"),t.onTouchMove&&(links.Timeline.removeEventListener(document,"touchmove",t.onTouchMove),delete t.onTouchMove),t.onTouchEnd&&(links.Timeline.removeEventListener(document,"touchend",t.onTouchEnd),delete t.onTouchEnd),this.onMouseUp(e);var n=(new Date).valueOf();this.getItemIndex(links.Timeline.getTarget(e)),t.doubleTapStartPrev&&n-t.doubleTapStartPrev<500&&t.doubleTapItem==t.doubleTapItemPrev&&(t.touchDown=!0,this.onDblClick(e),t.touchDown=!1),links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseDown=function(e){var e=e||window.event,t=this.eventParams,n=this.options,r=this.dom;if((e.which?e.which==1:e.button==1)||t.touchDown){t.touchDown?(t.mouseX=e.targetTouches[0].clientX,t.mouseY=e.targetTouches[0].clientY):(t.mouseX=e.clientX,t.mouseY=e.clientY),t.mouseX==void 0&&(t.mouseX=0),t.mouseY==void 0&&(t.mouseY=0),t.frameLeft=links.Timeline.getAbsoluteLeft(this.dom.content),t.frameTop=links.Timeline.getAbsoluteTop(this.dom.content),t.previousLeft=0,t.previousOffset=0,t.moved=!1,t.start=new Date(this.start.valueOf()),t.end=new Date(this.end.valueOf()),t.target=links.Timeline.getTarget(e);var i=r.items&&r.items.dragRight?r.items.dragRight:void 0;t.itemDragLeft=t.target===(r.items&&r.items.dragLeft?r.items.dragLeft:void 0),t.itemDragRight=t.target===i,t.itemIndex=t.itemDragLeft||t.itemDragRight?this.selection?this.selection.index:void 0:this.getItemIndex(t.target),t.customTime=t.target===r.customTime||t.target.parentNode===r.customTime?this.customTime:void 0,t.addItem=n.editable&&e.ctrlKey,t.addItem&&(i=t.mouseY-t.frameTop,r=this.screenToTime(t.mouseX-t.frameLeft),n.snapEvents&&this.step.snap(r),n=new Date(r.valueOf()),i=this.getGroupFromHeight(i),this.addItem({start:r,end:n,content:"New",group:this.getGroupName(i)}),t.itemIndex=this.items.length-1,this.selectItem(t.itemIndex),t.itemDragRight=!0),n=this.items[t.itemIndex],r=this.isSelected(t.itemIndex),t.editItem=r&&this.isEditable(n),t.editItem?(t.itemStart=n.start,t.itemEnd=n.end,t.itemGroup=n.group,t.itemLeft=n.start?this.timeToScreen(n.start):void 0,t.itemRight=n.end?this.timeToScreen(n.end):void 0):this.dom.frame.style.cursor="move";if(!t.touchDown){var s=this;t.onMouseMove||(t.onMouseMove=function(e){s.onMouseMove(e)},links.Timeline.addEventListener(document,"mousemove",t.onMouseMove)),t.onMouseUp||(t.onMouseUp=function(e){s.onMouseUp(e)},links.Timeline.addEventListener(document,"mouseup",t.onMouseUp)),links.Timeline.preventDefault(e)}}},links.Timeline.prototype.onMouseMove=function(e){var e=e||window.event,t=this.eventParams,n=this.size,r=this.dom,i=this.options,s,o;t.touchDown?(s=e.targetTouches[0].clientX,o=e.targetTouches[0].clientY):(s=e.clientX,o=e.clientY),s==void 0&&(s=0),o==void 0&&(o=0),t.mouseX==void 0&&(t.mouseX=s),t.mouseY==void 0&&(t.mouseY=o),s-=t.mouseX,Math.abs(s)>=1&&(t.moved=!0);if(t.customTime)this.customTime=this.screenToTime(this.timeToScreen(t.customTime)+s),this.repaintCustomTime(),this.trigger("timechange");else if(t.editItem){var r=this.items[t.itemIndex],u;if(t.itemDragLeft){if(n=t.itemLeft+s,u=t.itemRight,r.start=this.screenToTime(n),i.snapEvents&&(this.step.snap(r.start),n=this.timeToScreen(r.start)),n>u)n=u,r.start=this.screenToTime(n)}else if(t.itemDragRight){if(n=t.itemLeft,u=t.itemRight+s,r.end=this.screenToTime(u),i.snapEvents&&(this.step.snap(r.end),u=this.timeToScreen(r.end)),u<n)u=n,r.end=this.screenToTime(u)}else if(n=t.itemLeft+s,r.start=this.screenToTime(n),i.snapEvents&&(this.step.snap(r.start),n=this.timeToScreen(r.start)),r.end)u=n+(t.itemRight-t.itemLeft),r.end=this.screenToTime(u);r.setPosition(n,u),n=t.itemDragLeft||t.itemDragRight,this.groups.length&&!n?(t=this.getGroupFromHeight(o-t.frameTop),i.groupsChangeable&&r.group!==t?this.changeItem(this.items.indexOf(r),{group:this.getGroupName(t)}):(this.repaintDeleteButton(),this.repaintDragAreas())):this.render()}else i.moveable&&(i=t.end.valueOf()-t.start.valueOf(),o=Math.round(-s/n.contentWidth*i),s=new Date(t.start.valueOf()+o),this.applyRange(s,new Date(t.end.valueOf()+o)),(s=this.start.valueOf()-s.valueOf())&&(o+=s),this.recalcConversion(),s=t.previousLeft||0,u=parseFloat(r.items.frame.style.left)||0,s=(t.previousOffset||0)+(u-s),n=-o/i*n.contentWidth+s,r.items.frame.style.left=n+"px",t.previousOffset=s,t.previousLeft=parseFloat(r.items.frame.style.left)||n,this.repaintCurrentTime(),this.repaintCustomTime(),this.repaintAxis(),this.trigger("rangechange"));links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseUp=function(){var e=this.eventParams,t=this.options;this.dom.frame.style.cursor="auto",e.onMouseMove&&(links.Timeline.removeEventListener(document,"mousemove",e.onMouseMove),delete e.onMouseMove),e.onMouseUp&&(links.Timeline.removeEventListener(document,"mouseup",e.onMouseUp),delete e.onMouseUp);if(e.customTime)this.trigger("timechanged");else if(e.editItem){if(t=this.items[e.itemIndex],e.moved||e.addItem)this.applyAdd=this.applyChange=!0,this.updateData(e.itemIndex,{start:t.start,end:t.end}),this.trigger(e.addItem?"add":"change"),e.addItem?this.applyAdd?this.updateData(e.itemIndex,{start:t.start,end:t.end,content:t.content,group:this.getGroupName(t.group)}):this.deleteItem(e.itemIndex):this.applyChange?this.updateData(e.itemIndex,{start:t.start,end:t.end}):(delete this.applyChange,delete this.applyAdd,t=this.items[e.itemIndex],t.start=e.itemStart,t.end=e.itemEnd,t.group=e.itemGroup,t.setPosition(e.itemLeft,e.itemRight)),this.options.cluster&&this.clusterGenerator.updateData(),this.render()}else!e.moved&&!e.zoomed?e.target===this.dom.items.deleteButton?this.selection&&this.confirmDeleteItem(this.selection.index):t.selectable&&(e.itemIndex!=void 0?this.isSelected(e.itemIndex)||(this.selectItem(e.itemIndex),this.trigger("select")):(this.unselectItem(),this.trigger("select"))):(this.render(),(e.moved&&t.moveable||e.zoomed&&t.zoomable)&&this.trigger("rangechanged"))},links.Timeline.prototype.onDblClick=function(e){var t=this.eventParams,n=this.options,r=this.dom,i=this.size,e=e||window.event;if(t.itemIndex!=void 0)(t=this.items[t.itemIndex])&&this.isEditable(t)&&this.trigger("edit");else if(n.editable){t.touchDown||(t.mouseX=e.clientX,t.mouseY=e.clientY),t.mouseX==void 0&&(t.mouseX=0),t.mouseY==void 0&&(t.mouseY=0);var s=t.mouseX-links.Timeline.getAbsoluteLeft(r.content),o=t.mouseY-links.Timeline.getAbsoluteTop(r.content),r=this.screenToTime(s),i=this.screenToTime(s+i.frameWidth/10);n.snapEvents&&(this.step.snap(r),this.step.snap(i)),n=this.getGroupFromHeight(o),this.addItem({start:r,end:i,content:"New",group:this.getGroupName(n)},!0),t.itemIndex=this.items.length-1,this.selectItem(t.itemIndex),this.applyAdd=!0,this.trigger("add"),this.applyAdd?(this.render({animate:!1}),this.selectItem(t.itemIndex)):this.deleteItem(t.itemIndex)}links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseWheel=function(e){if(this.options.zoomable){e||(e=window.event);var t=0;e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3);if(t){var n=this;(function(){var r=t/5,i=links.Timeline.getAbsoluteLeft(n.dom.content),i=e.clientX!=void 0&&i!=void 0?n.screenToTime(e.clientX-i):void 0;n.zoom(r,i),n.trigger("rangechange"),n.trigger("rangechanged")})()}links.Timeline.preventDefault(e)}},links.Timeline.prototype.zoom=function(e,t){t==void 0&&(t=new Date((this.start.valueOf()+this.end.valueOf())/2)),e>=1&&(e=.9),e<=-1&&(e=-0.9),e<0&&(e/=1+e);var n=new Date(this.start.valueOf()-(this.start.valueOf()-t)*e),r=new Date(this.end.valueOf()-(this.end.valueOf()-t)*e),i=r.valueOf()-n.valueOf(),s=Number(this.options.intervalMin)||10;s<10&&(s=10),i>=s&&(this.applyRange(n,r,t),this.render({animate:this.options.animate&&this.options.animateZoom}))},links.Timeline.prototype.move=function(e){var t=this.end.valueOf()-this.start.valueOf();this.applyRange(new Date(this.start.valueOf()+t*e),new Date(this.end.valueOf()+t*e)),this.render()},links.Timeline.prototype.applyRange=function(e,t,n){var e=e.valueOf(),t=t.valueOf(),r=t-e,i=this.options,s=Number(i.intervalMin)||10;s<10&&(s=10);var o=Number(i.intervalMax)||31536e10;o>31536e10&&(o=31536e10),o<s&&(o=s);var u=i.min?i.min.valueOf():void 0,i=i.max?i.max.valueOf():void 0;u!=void 0&&i!=void 0&&(u>=i&&(i=u+864e5),o>i-u&&(o=i-u),s>i-u&&(s=i-u)),e>=t&&(t+=864e5);if(r<s){s-=r;var a=n?(n.valueOf()-e)/r:.5;e-=Math.round(s*a),t+=Math.round(s*(1-a))}r>o&&(s=r-o,a=n?(n.valueOf()-e)/r:.5,e+=Math.round(s*a),t-=Math.round(s*(1-a))),u!=void 0&&(s=e-u,s<0&&(e-=s,t-=s)),i!=void 0&&(s=i-t,s<0&&(e+=s,t+=s)),this.start=new Date(e),this.end=new Date(t)},links.Timeline.prototype.confirmDeleteItem=function(e){this.applyDelete=!0,this.isSelected(e)||this.selectItem(e),this.trigger("delete"),this.applyDelete&&this.deleteItem(e),delete this.applyDelete},links.Timeline.prototype.deleteItem=function(e,t){if(e>=this.items.length)throw"Cannot delete row, index out of range";this.selection&&(this.selection.index==e?this.unselectItem():this.selection.index>e&&this.selection.index--),this.renderQueue.hide.push(this.items.splice(e,1)[0]);if(this.data)if(google&&google.visualization&&this.data instanceof google.visualization.DataTable)this.data.removeRow(e);else{if(!links.Timeline.isArray(this.data))throw"Cannot delete row from data, unknown data type";this.data.splice(e,1)}this.options.cluster&&this.clusterGenerator.updateData(),t||this.render()},links.Timeline.prototype.deleteAllItems=function(){this.unselectItem(),this.clearItems(),this.deleteGroups();if(this.data)if(google&&google.visualization&&this.data instanceof google.visualization.DataTable)this.data.removeRows(0,this.data.getNumberOfRows());else{if(!links.Timeline.isArray(this.data))throw"Cannot delete row from data, unknown data type";this.data.splice(0,this.data.length)}this.options.cluster&&this.clusterGenerator.updateData(),this.render()},links.Timeline.prototype.getGroupFromHeight=function(e){var t,n,r=this.groups;if(r.length){if(this.options.axisOnTop){for(t=r.length-1;t>=0;t--)if(n=r[t],e>n.top)break}else for(t=0;t<r.length;t++)if(n=r[t],e>n.top)break;return n}},links.Timeline.Item=function(e,t){e&&(this.start=e.start,this.end=e.end,this.content=e.content,this.className=e.className,this.editable=e.editable,this.group=e.group),this.dotHeight=this.dotWidth=this.lineWidth=this.height=this.width=this.left=this.top=0,this.rendered=!1;if(t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])},links.Timeline.Item.prototype.reflow=function(){return!1},links.Timeline.Item.prototype.getImageUrls=function(e){this.dom&&links.imageloader.filterImageUrls(this.dom,e)},links.Timeline.Item.prototype.select=function(){},links.Timeline.Item.prototype.unselect=function(){},links.Timeline.Item.prototype.createDOM=function(){},links.Timeline.Item.prototype.showDOM=function(){},links.Timeline.Item.prototype.hideDOM=function(){},links.Timeline.Item.prototype.updateDOM=function(){},links.Timeline.Item.prototype.updatePosition=function(){},links.Timeline.Item.prototype.isRendered=function(){return this.rendered},links.Timeline.Item.prototype.isVisible=function(){return!1},links.Timeline.Item.prototype.setPosition=function(){},links.Timeline.Item.prototype.getRight=function(){return 0},links.Timeline.Item.prototype.getWidth=function(){return this.width||0},links.Timeline.ItemBox=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemBox.prototype=new links.Timeline.Item,links.Timeline.ItemBox.prototype.reflow=function(){var e=this.dom,t=e.dot.offsetHeight,n=e.dot.offsetWidth,e=e.line.offsetWidth,r=this.dotHeight!=t||this.dotWidth!=n||this.lineWidth!=e;return this.dotHeight=t,this.dotWidth=n,this.lineWidth=e,r},links.Timeline.ItemBox.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected"),links.Timeline.addClassName(e.line,"timeline-event-selected"),links.Timeline.addClassName(e.dot,"timeline-event-selected")},links.Timeline.ItemBox.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected"),links.Timeline.removeClassName(e.line,"timeline-event-selected"),links.Timeline.removeClassName(e.dot,"timeline-event-selected")},links.Timeline.ItemBox.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute",e.style.left=this.left+"px",e.style.top=this.top+"px";var t=document.createElement("DIV");return t.className="timeline-event-content",t.innerHTML=this.content,e.appendChild(t),t=document.createElement("DIV"),t.style.position="absolute",t.style.width="0px",e.line=t,t=document.createElement("DIV"),t.style.position="absolute",t.style.width="0px",t.style.height="0px",e.dot=t,this.dom=e,this.updateDOM(),e},links.Timeline.ItemBox.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),e.insertBefore(t.line,e.firstChild),e.appendChild(t.dot),this.rendered=!0)},links.Timeline.ItemBox.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),e.line&&e.line.parentNode&&e.line.parentNode.removeChild(e.line),e.dot&&e.dot.parentNode&&e.dot.parentNode.removeChild(e.dot),this.rendered=!1)},links.Timeline.ItemBox.prototype.updateDOM=function(){var e=this.dom;if(e){var t=e.line,n=e.dot;e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-box",t.className="timeline-event timeline-event-line",n.className="timeline-event timeline-event-dot",this.isCluster&&(links.Timeline.addClassName(e,"timeline-event-cluster"),links.Timeline.addClassName(t,"timeline-event-cluster"),links.Timeline.addClassName(n,"timeline-event-cluster")),this.className&&(links.Timeline.addClassName(e,this.className),links.Timeline.addClassName(t,this.className),links.Timeline.addClassName(n,this.className))}},links.Timeline.ItemBox.prototype.updatePosition=function(e){var t=this.dom;if(t){var n=e.timeToScreen(this.start),r=e.options.axisOnTop,i=e.size.axis.top,s=e.size.axis.height,e=e.options.box&&e.options.box.align?e.options.box.align:void 0;t.style.top=this.top+"px",t.style.left=e=="right"?n-this.width+"px":e=="left"?n+"px":n-this.width/2+"px",e=t.line,t=t.dot,e.style.left=n-this.lineWidth/2+"px",t.style.left=n-this.dotWidth/2+"px",r?(e.style.top=s+"px",e.style.height=Math.max(this.top-s,0)+"px",t.style.top=s-this.dotHeight/2+"px"):(e.style.top=this.top+this.height+"px",e.style.height=Math.max(i-this.top-this.height,0)+"px",t.style.top=i-this.dotHeight/2+"px")}},links.Timeline.ItemBox.prototype.isVisible=function(e,t){return this.cluster?!1:this.start>e&&this.start<t},links.Timeline.ItemBox.prototype.setPosition=function(e){var t=this.dom;t.style.left=e-this.width/2+"px",t.line.style.left=e-this.lineWidth/2+"px",t.dot.style.left=e-this.dotWidth/2+"px",this.group&&(this.top=this.group.top,t.style.top=this.top+"px")},links.Timeline.ItemBox.prototype.getRight=function(e){var t=e.options.box&&e.options.box.align?e.options.box.align:void 0,e=e.timeToScreen(this.start);return t=="right"?e:t=="left"?e+this.width:e+this.width/2},links.Timeline.ItemRange=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemRange.prototype=new links.Timeline.Item,links.Timeline.ItemRange.prototype.select=function(){links.Timeline.addClassName(this.dom,"timeline-event-selected")},links.Timeline.ItemRange.prototype.unselect=function(){links.Timeline.removeClassName(this.dom,"timeline-event-selected")},links.Timeline.ItemRange.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");return t.className="timeline-event-content",e.appendChild(t),this.dom=e,this.updateDOM(),e},links.Timeline.ItemRange.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),this.rendered=!0)},links.Timeline.ItemRange.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),this.rendered=!1)},links.Timeline.ItemRange.prototype.updateDOM=function(){var e=this.dom;e&&(e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-range",this.isCluster&&links.Timeline.addClassName(e,"timeline-event-cluster"),this.className&&links.Timeline.addClassName(e,this.className))},links.Timeline.ItemRange.prototype.updatePosition=function(e){var t=this.dom;if(t){var n=e.size.contentWidth,r=e.timeToScreen(this.start),e=e.timeToScreen(this.end);r<-n&&(r=-n),e>2*n&&(e=2*n),t.style.top=this.top+"px",t.style.left=r+"px",t.style.width=Math.max(e-r,1)+"px"}},links.Timeline.ItemRange.prototype.isVisible=function(e,t){return this.cluster?!1:this.end>e&&this.start<t},links.Timeline.ItemRange.prototype.setPosition=function(e,t){var n=this.dom;n.style.left=e+"px",n.style.width=t-e+"px",this.group&&(this.top=this.group.top,n.style.top=this.top+"px")},links.Timeline.ItemRange.prototype.getRight=function(e){return e.timeToScreen(this.end)},links.Timeline.ItemRange.prototype.getWidth=function(e){return e.timeToScreen(this.end)-e.timeToScreen(this.start)},links.Timeline.ItemDot=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemDot.prototype=new links.Timeline.Item,links.Timeline.ItemDot.prototype.reflow=function(){var e=this.dom,t=e.dot.offsetHeight,n=e.dot.offsetWidth,e=e.content.offsetHeight,r=this.dotHeight!=t||this.dotWidth!=n||this.contentHeight!=e;return this.dotHeight=t,this.dotWidth=n,this.contentHeight=e,r},links.Timeline.ItemDot.prototype.select=function(){links.Timeline.addClassName(this.dom,"timeline-event-selected")},links.Timeline.ItemDot.prototype.unselect=function(){links.Timeline.removeClassName(this.dom,"timeline-event-selected")},links.Timeline.ItemDot.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");t.className="timeline-event-content",e.appendChild(t);var n=document.createElement("DIV");return n.style.position="absolute",n.style.width="0px",n.style.height="0px",e.appendChild(n),e.content=t,e.dot=n,this.dom=e,this.updateDOM(),e},links.Timeline.ItemDot.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),this.rendered=!0)},links.Timeline.ItemDot.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),this.rendered=!1)},links.Timeline.ItemDot.prototype.updateDOM=function(){if(this.dom){var e=this.dom,t=e.dot;e.firstChild.innerHTML=this.content,t.className="timeline-event timeline-event-dot",this.isCluster&&(links.Timeline.addClassName(e,"timeline-event-cluster"),links.Timeline.addClassName(t,"timeline-event-cluster")),this.className&&(links.Timeline.addClassName(e,this.className),links.Timeline.addClassName(t,this.className))}},links.Timeline.ItemDot.prototype.updatePosition=function(e){var t=this.dom;t&&(e=e.timeToScreen(this.start),t.style.top=this.top+"px",t.style.left=e-this.dotWidth/2+"px",t.content.style.marginLeft=1.5*this.dotWidth+"px",t.dot.style.top=(this.height-this.dotHeight)/2+"px")},links.Timeline.ItemDot.prototype.isVisible=function(e,t){return this.cluster?!1:this.start>e&&this.start<t},links.Timeline.ItemDot.prototype.setPosition=function(e){var t=this.dom;t.style.left=e-this.dotWidth/2+"px",this.group&&(this.top=this.group.top,t.style.top=this.top+"px")},links.Timeline.ItemDot.prototype.getRight=function(e){return e.timeToScreen(this.start)+this.width},links.Timeline.prototype.getItem=function(e){if(e>=this.items.length)throw"Cannot get item, index out of range";var e=this.items[e],t={};return t.start=new Date(e.start.valueOf()),e.end&&(t.end=new Date(e.end.valueOf())),t.content=e.content,e.group&&(t.group=this.getGroupName(e.group)),t},links.Timeline.prototype.addItem=function(e,t){this.addItems([e],t)},links.Timeline.prototype.addItems=function(e,t){var n=this,r=this.items;e.forEach(function(e){var t=r.length;r.push(n.createItem(e)),n.updateData(t,e)}),this.options.cluster&&this.clusterGenerator.updateData(),t||this.render({animate:!1})},links.Timeline.prototype.createItem=function(e){var t=e.end?"range":this.options.style,e={start:e.start,end:e.end,content:e.content,className:e.className,editable:e.editable,group:this.getGroup(e.group)},n;return n=this.options,n=n.axisOnTop?this.size.axis.height+n.eventMarginAxis+n.eventMargin/2:this.size.contentHeight-n.eventMarginAxis-n.eventMargin/2,t in this.itemTypes?new this.itemTypes[t](e,{top:n}):(console.log('ERROR: Unknown event style "'+t+'"'),new links.Timeline.Item(e,{top:n}))},links.Timeline.prototype.changeItem=function(e,t,n){var r=this.items[e];if(!r)throw"Cannot change item, index out of range";var i=this.createItem({start:t.hasOwnProperty("start")?t.start:r.start,end:t.hasOwnProperty("end")?t.end:r.end,content:t.hasOwnProperty("content")?t.content:r.content,group:t.hasOwnProperty("group")?t.group:this.getGroupName(r.group),className:t.hasOwnProperty("className")?t.className:r.className});this.items[e]=i,this.renderQueue.hide.push(r),this.renderQueue.show.push(i),this.updateData(e,t),this.options.cluster&&this.clusterGenerator.updateData(),n||(this.render({animate:!1}),i.select())},links.Timeline.prototype.deleteGroups=function(){this.groups=[],this.groupIndexes={}},links.Timeline.prototype.getGroup=function(e){var t=this.groups,n=this.groupIndexes,r=void 0,r=n[e];if(r==void 0&&e!=void 0){r={content:e,labelTop:0,lineTop:0},t.push(r);for(var t=t.sort(function(e,t){return e.content>t.content?1:e.content<t.content?-1:0}),e=0,i=t.length;e<i;e++)n[t[e].content]=e}else r=t[r];return r},links.Timeline.prototype.getGroupName=function(e){return e?e.content:void 0},links.Timeline.prototype.cancelChange=function(){this.applyChange=!1},links.Timeline.prototype.cancelDelete=function(){this.applyDelete=!1},links.Timeline.prototype.cancelAdd=function(){this.applyAdd=!1},links.Timeline.prototype.setSelection=function(e){if(e!=void 0&&e.length>0){if(e[0].row!=void 0){var t=e[0].row;if(this.items[t])return e=this.items[t],this.selectItem(t),t=e.start,e=e.end,e=e!=void 0?(e.valueOf()+t.valueOf())/2:t.valueOf(),t=this.end.valueOf()-this.start.valueOf(),this.setVisibleChartRange(new Date(e-t/2),new Date(e+t/2)),!0}}else this.unselectItem();return!1},links.Timeline.prototype.getSelection=function(){var e=[];return this.selection&&e.push({row:this.selection.index}),e},links.Timeline.prototype.selectItem=function(e){this.unselectItem(),this.selection=void 0;if(this.items[e]!=void 0){var t=this.items[e];this.selection={index:e},t&&t.dom&&(this.isEditable(t)&&(t.dom.style.cursor="move"),t.select()),this.repaintDeleteButton(),this.repaintDragAreas()}},links.Timeline.prototype.isSelected=function(e){return this.selection&&this.selection.index==e},links.Timeline.prototype.unselectItem=function(){if(this.selection){var e=this.items[this.selection.index];e&&e.dom&&(e.dom.style.cursor="",e.unselect()),this.selection=void 0,this.repaintDeleteButton(),this.repaintDragAreas()}},links.Timeline.prototype.stackItems=function(e){if(!(this.groups.length>0)){e==void 0&&(e=!1);var t=this.stack;t||(this.stack=t={}),t.sortedItems=this.stackOrder(this.renderedItems),t.finalItems=this.stackCalculateFinal(t.sortedItems);if(e||t.timer){var n=this,r=function(){var e=n.stackMoveOneStep(t.sortedItems,t.finalItems);n.repaint(),e?delete t.timer:t.timer=setTimeout(r,30)};t.timer||(t.timer=setTimeout(r,30))}else this.stackMoveToFinal(t.sortedItems,t.finalItems)}},links.Timeline.prototype.stackCancelAnimation=function(){this.stack&&this.stack.timer&&(clearTimeout(this.stack.timer),delete this.stack.timer)},links.Timeline.prototype.stackOrder=function(e){return e=e.concat([]),e.sort(this.options.customStackOrder&&typeof this.options.customStackOrder=="function"?this.options.customStackOrder:function(e,t){return e instanceof links.Timeline.ItemRange&&!(t instanceof links.Timeline.ItemRange)?-1:!(e instanceof links.Timeline.ItemRange)&&t instanceof links.Timeline.ItemRange?1:e.left-t.left}),e},links.Timeline.prototype.stackCalculateFinal=function(e){var t,n,r=this.size,i=r.axis.top,s=r.axis.height;t=this.options;var r=t.axisOnTop,o=t.eventMargin,u=t.eventMarginAxis,a=[];for(t=0,n=e.length;t<n;t++){var f=e[t],l,c=f.height;l=f.getWidth(this);var h=f.getRight(this),p=h-l;l=r?s+u+o/2:i-c-u-o/2,a[t]={left:p,top:l,right:h,bottom:l+c,height:c,item:f}}if(this.options.stackEvents)for(t=0,n=a.length;t<n;t++){e=a[t],i=null;do if(i=this.stackItemsCheckOverlap(a,t,0,t-1),i!=null)e.top=r?i.top+i.height+o:i.top-e.height-o,e.bottom=e.top+e.height;while(i)}return a},links.Timeline.prototype.stackMoveOneStep=function(e,t){var n=!0;for(i=0,iMax=t.length;i<iMax;i++){var r=t[i],s=r.item,o=parseInt(s.top),u=parseInt(r.top),a=u-o;if(a){var f=u==o?0:u>o?1:-1;Math.abs(a)>4&&(f=a/4),o=parseInt(o+f),o!=u&&(n=!1),s.top=o,s.bottom=s.top+s.height}else s.top=r.top,s.bottom=r.bottom;s.left=r.left,s.right=r.right}return n},links.Timeline.prototype.stackMoveToFinal=function(e,t){for(i=0,iMax=t.length;i<iMax;i++){var n=t[i],r=n.item;r.left=n.left,r.top=n.top,r.right=n.right,r.bottom=n.bottom}},links.Timeline.prototype.stackItemsCheckOverlap=function(e,t,n,r){for(var i=this.options.eventMargin,s=this.collision,o=e[t];r>=n;r--){var u=e[r];if(s(o,u,i)&&r!=t)return u}},links.Timeline.prototype.collision=function(e,t,n){return n==void 0&&(n=0),e.left-n<t.right&&e.right+n>t.left&&e.top-n<t.bottom&&e.bottom+n>t.top},links.Timeline.prototype.trigger=function(e){var t=null;switch(e){case"rangechange":case"rangechanged":t={start:new Date(this.start.valueOf()),end:new Date(this.end.valueOf())};break;case"timechange":case"timechanged":t={time:new Date(this.customTime.valueOf())}}links.events.trigger(this,e,t),google&&google.visualization&&google.visualization.events.trigger(this,e,t)},links.Timeline.prototype.clusterItems=function(){if(this.options.cluster){var e=this.clusterGenerator.getClusters(this.conversion.factor);if(this.clusters!=e){var t=this.renderQueue;this.clusters&&this.clusters.forEach(function(e){t.hide.push(e),e.items.forEach(function(e){e.cluster=void 0})}),e.forEach(function(e){e.items.forEach(function(t){t.cluster=e})}),this.clusters=e}}},links.Timeline.prototype.filterItems=function(){function e(e){e.forEach(function(e){var n=e.rendered,s=e.isVisible(r,i);n!=s&&(n&&t.hide.push(e),s&&t.show.indexOf(e)==-1&&t.show.push(e))})}var t=this.renderQueue,n=this.end-this.start,r=new Date(this.start.valueOf()-n),i=new Date(this.end.valueOf()+n);e(this.items),this.clusters&&e(this.clusters)},links.Timeline.ClusterGenerator=function(e){this.timeline=e,this.clear()},links.Timeline.ClusterGenerator.prototype.clear=function(){this.items=[],this.groups={},this.clearCache()},links.Timeline.ClusterGenerator.prototype.clearCache=function(){this.cache={},this.cacheLevel=-1,this.cache[this.cacheLevel]=[]},links.Timeline.ClusterGenerator.prototype.setData=function(e,t){this.items=e||[],this.applyOnChangedLevel=this.dataChanged=!0,t&&t.applyOnChangedLevel&&(this.applyOnChangedLevel=t.applyOnChangedLevel)},links.Timeline.ClusterGenerator.prototype.updateData=function(){this.dataChanged=!0,this.applyOnChangedLevel=!1},links.Timeline.ClusterGenerator.prototype.filterData=function(){var e=this.items||[],t={};this.groups=t,e.forEach(function(e){var n=e.group?e.group.content:"",r=t[n];r||(r=[],t[n]=r),r.push(e),e.start&&(e.center=e.end?(e.start.valueOf()+e.end.valueOf())/2:e.start.valueOf())});for(var n in t)t.hasOwnProperty(n)&&t[n].sort(function(e,t){return e.center-t.center});this.dataChanged=!1},links.Timeline.ClusterGenerator.prototype.getClusters=function(e){var t=-1,n=0;e>0&&(t=Math.round(Math.log(100/e)/Math.log(2)),n=Math.pow(2,t),this.timeline.groups&&this.timeline.groups.length&&(n*=4)),this.dataChanged&&(e=t!=this.cacheLevel,this.applyOnChangedLevel?e:1)&&(this.clearCache(),this.filterData()),this.cacheLevel=t,e=this.cache[t];if(!e){var e=[],r;for(r in this.groups)if(this.groups.hasOwnProperty(r))for(var i=this.groups[r],s=i.length,o=0;o<s;){for(var u=i[o],a=1,f=o-1;f>=0&&u.center-i[f].center<n/2;)i[f].cluster||a++,f--;for(f=o+1;f<i.length&&i[f].center-u.center<n/2;)a++,f++;for(f=e.length-1;f>=0&&u.center-e[f].center<n/2;)u.group==e[f].group&&a++,f--;if(a>5){for(var a=a-5+1,f=[],l=void 0,c=void 0,h=void 0,p=!1,d=0,v=o;f.length<a&&v<i.length;){var m=i[v],g=m.start.valueOf(),y=m.end?m.end.valueOf():m.start.valueOf();f.push(m),l=d?d/(d+1)*l+1/(d+1)*m.center:m.center,c=c!=void 0?Math.min(c,g):g,h=h!=void 0?Math.max(h,y):y,p=p||m instanceof links.Timeline.ItemRange,d++,v++}var b,d='<div title="'+("Cluster containing "+d+" events. Zoom in to see the individual events.")+'">'+d+" events</div>",u=u.group?u.group.content:void 0;b=p?this.timeline.createItem({start:new Date(c),end:new Date(h),content:d,group:u}):this.timeline.createItem({start:new Date(l),content:d,group:u}),b.isCluster=!0,b.items=f,b.items.forEach(function(e){e.cluster=b}),e.push(b),o+=a}else delete u.cluster,o+=1}this.cache[t]=e}return e},links.events=links.events||{listeners:[],indexOf:function(e){for(var t=this.listeners,n=0,r=this.listeners.length;n<r;n++){var i=t[n];if(i&&i.object==e)return n}return-1},addListener:function(e,t,n){var r=this.listeners[this.indexOf(e)];r||(r={object:e,events:{}},this.listeners.push(r)),e=r.events[t],e||(e=[],r.events[t]=e),e.indexOf(n)==-1&&e.push(n)},removeListener:function(e,t,n){var e=this.indexOf(e),r=this.listeners[e];if(r){var i=r.events[t];i&&(e=i.indexOf(n),e!=-1&&i.splice(e,1),i.length==0&&delete r.events[t]);var t=0,n=r.events,s;for(s in n)n.hasOwnProperty(s)&&t++;t==0&&delete this.listeners[e]}},removeAllListeners:function(){this.listeners=[]},trigger:function(e,t,n){if(e=this.listeners[this.indexOf(e)])if(t=e.events[t])for(var e=0,r=t.length;e<r;e++)t[e](n)}},links.Timeline.StepDate=function(e,t,n){this.current=new Date,this._start=new Date,this._end=new Date,this.autoScale=!0,this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=1,this.setRange(e,t,n)},links.Timeline.StepDate.SCALE={MILLISECOND:1,SECOND:2,MINUTE:3,HOUR:4,DAY:5,WEEKDAY:6,MONTH:7,YEAR:8},links.Timeline.StepDate.prototype.setRange=function(e,t,n){e instanceof Date&&t instanceof Date&&(this._start=e!=void 0?new Date(e.valueOf()):new Date,this._end=t!=void 0?new Date(t.valueOf()):new Date,this.autoScale&&this.setMinimumStep(n))},links.Timeline.StepDate.prototype.start=function(){this.current=new Date(this._start.valueOf()),this.roundToMinor()},links.Timeline.StepDate.prototype.roundToMinor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.step*Math.floor(this.current.getFullYear()/this.step)),this.current.setMonth(0);case links.Timeline.StepDate.SCALE.MONTH:this.current.setDate(1);case links.Timeline.StepDate.SCALE.DAY:case links.Timeline.StepDate.SCALE.WEEKDAY:this.current.setHours(0);case links.Timeline.StepDate.SCALE.HOUR:this.current.setMinutes(0);case links.Timeline.StepDate.SCALE.MINUTE:this.current.setSeconds(0);case links.Timeline.StepDate.SCALE.SECOND:this.current.setMilliseconds(0)}if(this.step!=1)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.setMilliseconds(this.current.getMilliseconds()-this.current.getMilliseconds()%this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()-this.current.getSeconds()%this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()-this.current.getMinutes()%this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()-this.current.getHours()%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()-1-(this.current.getDate()-1)%this.step+1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()-this.current.getMonth()%this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()-this.current.getFullYear()%this.step)}},links.Timeline.StepDate.prototype.end=function(){return this.current.valueOf()>this._end.valueOf()},links.Timeline.StepDate.prototype.next=function(){var e=this.current.valueOf();if(this.current.getMonth()<6)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.valueOf()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current=new Date(this.current.valueOf()+this.step*1e3);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current=new Date(this.current.valueOf()+this.step*6e4);break;case links.Timeline.StepDate.SCALE.HOUR:this.current=new Date(this.current.valueOf()+this.step*36e5);var t=this.current.getHours();this.current.setHours(t-t%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step)}else switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.valueOf()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()+this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()+this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()+this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step)}if(this.step!=1)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.getMilliseconds()<this.step&&this.current.setMilliseconds(0);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.getSeconds()<this.step&&this.current.setSeconds(0);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.getMinutes()<this.step&&this.current.setMinutes(0);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.getHours()<this.step&&this.current.setHours(0);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.getDate()<this.step+1&&this.current.setDate(1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.getMonth()<this.step&&this.current.setMonth(0)}this.current.valueOf()==e&&(this.current=new Date(this._end.valueOf()))},links.Timeline.StepDate.prototype.getCurrent=function(){return this.current},links.Timeline.StepDate.prototype.setScale=function(e,t){this.scale=e,t>0&&(this.step=t),this.autoScale=!1},links.Timeline.StepDate.prototype.setAutoScale=function(e){this.autoScale=e},links.Timeline.StepDate.prototype.setMinimumStep=function(e){e!=void 0&&(31104e9>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=1e3),15552e9>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=500),31104e8>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=100),15552e8>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=50),31104e7>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=10),15552e7>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=5),31104e6>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=1),7776e6>e&&(this.scale=links.Timeline.StepDate.SCALE.MONTH,this.step=3),2592e6>e&&(this.scale=links.Timeline.StepDate.SCALE.MONTH,this.step=1),432e6>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=5),1728e5>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=2),864e5>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=1),432e5>e&&(this.scale=links.Timeline.StepDate.SCALE.WEEKDAY,this.step=1),144e5>e&&(this.scale=links.Timeline.StepDate.SCALE.HOUR,this.step=4),36e5>e&&(this.scale=links.Timeline.StepDate.SCALE.HOUR,this.step=1),9e5>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=15),6e5>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=10),3e5>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=5),6e4>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=1),15e3>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=15),1e4>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=10),5e3>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=5),1e3>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=1),200>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=200),100>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=100),50>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=50),10>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=10),5>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=5),1>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=1))},links.Timeline.StepDate.prototype.snap=function(e){if(this.scale==links.Timeline.StepDate.SCALE.YEAR){var t=e.getFullYear()+Math.round(e.getMonth()/12);e.setFullYear(Math.round(t/this.step)*this.step),e.setMonth(0),e.setDate(0),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.MONTH)e.getDate()>15?(e.setDate(1),e.setMonth(e.getMonth()+1)):e.setDate(1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);else if(this.scale==links.Timeline.StepDate.SCALE.DAY||this.scale==links.Timeline.StepDate.SCALE.WEEKDAY){switch(this.step){case 5:case 2:e.setHours(Math.round(e.getHours()/24)*24);break;default:e.setHours(Math.round(e.getHours()/12)*12)}e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.HOUR){switch(this.step){case 4:e.setMinutes(Math.round(e.getMinutes()/60)*60);break;default:e.setMinutes(Math.round(e.getMinutes()/30)*30)}e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.MINUTE){switch(this.step){case 15:case 10:e.setMinutes(Math.round(e.getMinutes()/5)*5),e.setSeconds(0);break;case 5:e.setSeconds(Math.round(e.getSeconds()/60)*60);break;default:e.setSeconds(Math.round(e.getSeconds()/30)*30)}e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.SECOND)switch(this.step){case 15:case 10:e.setSeconds(Math.round(e.getSeconds()/5)*5),e.setMilliseconds(0);break;case 5:e.setMilliseconds(Math.round(e.getMilliseconds()/1e3)*1e3);break;default:e.setMilliseconds(Math.round(e.getMilliseconds()/500)*500)}else this.scale==links.Timeline.StepDate.SCALE.MILLISECOND&&(t=this.step>5?this.step/2:1,e.setMilliseconds(Math.round(e.getMilliseconds()/t)*t))},links.Timeline.StepDate.prototype.isMajor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return this.current.getMilliseconds()==0;case links.Timeline.StepDate.SCALE.SECOND:return this.current.getSeconds()==0;case links.Timeline.StepDate.SCALE.MINUTE:return this.current.getHours()==0&&this.current.getMinutes()==0;case links.Timeline.StepDate.SCALE.HOUR:return this.current.getHours()==0;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return this.current.getDate()==1;case links.Timeline.StepDate.SCALE.MONTH:return this.current.getMonth()==0;case links.Timeline.StepDate.SCALE.YEAR:return!1;default:return!1}},links.Timeline.StepDate.prototype.getLabelMinor=function(e){var t="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),n="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(",");e==void 0&&(e=this.current);switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return String(e.getMilliseconds());case links.Timeline.StepDate.SCALE.SECOND:return String(e.getSeconds());case links.Timeline.StepDate.SCALE.MINUTE:return this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2);case links.Timeline.StepDate.SCALE.HOUR:return this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2);case links.Timeline.StepDate.SCALE.WEEKDAY:return n[e.getDay()]+" "+e.getDate();case links.Timeline.StepDate.SCALE.DAY:return String(e.getDate());case links.Timeline.StepDate.SCALE.MONTH:return t[e.getMonth()];case links.Timeline.StepDate.SCALE.YEAR:return String(e.getFullYear());default:return""}},links.Timeline.StepDate.prototype.getLabelMajor=function(e){var t="January,February,March,April,May,June,July,August,September,October,November,December".split(","),n="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");e==void 0&&(e=this.current);switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2)+":"+this.addZeros(e.getSeconds(),2);case links.Timeline.StepDate.SCALE.SECOND:return e.getDate()+" "+t[e.getMonth()]+" "+this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2);case links.Timeline.StepDate.SCALE.MINUTE:return n[e.getDay()]+" "+e.getDate()+" "+t[e.getMonth()]+" "+e.getFullYear();case links.Timeline.StepDate.SCALE.HOUR:return n[e.getDay()]+" "+e.getDate()+" "+t[e.getMonth()]+" "+e.getFullYear();case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return t[e.getMonth()]+" "+e.getFullYear();case links.Timeline.StepDate.SCALE.MONTH:return String(e.getFullYear());default:return""}},links.Timeline.StepDate.prototype.addZeros=function(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n},links.imageloader=function(){function e(e){if(i[e]==1)return!0;var t=new Image;return t.src=e,t.complete?!0:!1}function t(e){return s[e]!=void 0}function n(n,r,o){o==void 0&&(o=!0);if(e(n))o&&r(n);else if(!t(n)||o){var u=s[n];u||(o=new Image,o.src=n,u=[],s[n]=u,o.onload=function(){i[n]=!0,delete s[n];for(var e=0;e<u.length;e++)u[e](n)}),u.indexOf(r)==-1&&u.push(r)}}function r(e,t){for(var n=e.firstChild;n;){if(n.tagName=="IMG"){var i=n.src;t.indexOf(i)==-1&&t.push(i)}r(n,t),n=n.nextSibling}}var i={},s={};return{isLoaded:e,isLoading:t,load:n,loadAll:function(t,r,i){var s=[];t.forEach(function(t){e(t)||s.push(t)});if(s.length){var o=s.length;s.forEach(function(e){n(e,function(){o--,o==0&&r()},i)})}else i&&r()},filterImageUrls:r}}(),links.Timeline.addEventListener=function(e,t,n,r){e.addEventListener?(r===void 0&&(r=!1),t==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,n,r)):e.attachEvent("on"+t,n)},links.Timeline.removeEventListener=function(e,t,n,r){e.removeEventListener?(r===void 0&&(r=!1),t==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,n,r)):e.detachEvent("on"+t,n)},links.Timeline.getTarget=function(e){e||(e=window.event);var t;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),t.nodeType!=void 0&&t.nodeType==3&&(t=t.parentNode),t},links.Timeline.stopPropagation=function(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},links.Timeline.preventDefault=function(e){e||(e=window.event),e.preventDefault?e.preventDefault():e.returnValue=!1},links.Timeline.getAbsoluteLeft=function(e){for(var t=0;e!=null;)t+=e.offsetLeft,t-=e.scrollLeft,e=e.offsetParent;return!document.body.scrollLeft&&window.pageXOffset&&(t-=window.pageXOffset),t},links.Timeline.getAbsoluteTop=function(e){for(var t=0;e!=null;)t+=e.offsetTop,t-=e.scrollTop,e=e.offsetParent;return!document.body.scrollTop&&window.pageYOffset&&(t-=window.pageYOffset),t},links.Timeline.addClassName=function(e,t){var n=e.className.split(" ");n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" "))},links.Timeline.removeClassName=function(e,t){var n=e.className.split(" "),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))},links.Timeline.isArray=function(e){return e instanceof Array?!0:Object.prototype.toString.call(e)==="[object Array]"},links.Timeline.parseJSONDate=function(e){if(e!=void 0){if(e instanceof Date)return e;var t=e.match(/\/Date\((-?\d+)([-\+]?\d{2})?(\d{2})?\)\//i);return t?(e=t[2]?36e5*t[2]+6e4*t[3]*(t[2]/Math.abs(t[2])):0,new Date(1*t[1]+e)):Date.parse(e)}},define("timeline",function(){}),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger!="manual"&&(i=this.options.trigger=="hover"?"mouseenter":"focus",s=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(i,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);!n.options.delay||!n.options.delay.show?n.show():(n.hoverState="in",setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show))},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);!n.options.delay||!n.options.delay.hide?n.hide():(n.hoverState="out",setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide))},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.css(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip();e.find(".tooltip-inner").html(this.getTitle()),e.removeClass("fade in top bottom left right")},hide:function(){function r(){var t=setTimeout(function(){n.off(e.support.transition.end).remove()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.remove()})}var t=this,n=this.tip();n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r():n.remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e=(e||"").toString().replace(/(^\s*|\s*$)/,""),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery),define("tooltip",function(){}),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var t=this.tip(),n=this.getTitle(),r=this.getContent();t.find(".popover-title")[e.type(n)=="object"?"append":"html"](n),t.find(".popover-content > *")[e.type(r)=="object"?"append":"html"](r),t.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content),e=e.toString().replace(/(^\s*|\s*$)/,""),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip}}),e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),define("popover",function(){}),define("views/timeline",["jquery","prototypes/player_adapter","models/annotation","collections/annotations","text!templates/timeline-group.tmpl","text!templates/timeline-item.tmpl","text!templates/timeline-modal-group.tmpl","access","roles","FiltersManager","backbone","handlebars","timeline","tooltip","popover"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";c.registerHelper("secure",function(e){return _.unescape(e).replace(/\"/g,"'").replace(/<\/?script>/gi,"NO-SCRIPT")});var h=l.View.extend({el:e("div#timeline-container")[0],groupTemplate:c.compile(i),itemTemplate:c.compile(s),modalGroupTemplate:c.compile(o),events:{"click #add-track":"initTrackCreation","click #reset-zoom":"onTimelineResetZoom","click #zoom-in":"zoomIn","click #zoom-out":"zoomOut","click #move-right":"moveRight","click #move-left":"moveLeft","click #filter-none":"disableFilter","click .filter":"switchFilter"},VOID_ITEM:'<div style="display:none"></div>',DEFAULT_DURATION:5,PREFIX_STACKING_CLASS:"stack-level-",ITEM_SELECTED_CLASS:"timeline-event-selected",allItems:{},filteredItems:[],initialize:function(t){_.bindAll(this,"addTrack","addTracksList","createTrack","changeTitleFromCustomPlayhead","onDeleteTrack","onTrackSelected","onSelectionUpdate","updateUnselectListener","onPlayerTimeUpdate","onTimelineMoved","onTimelineItemChanged","onTimelineItemDeleted","onTimelineItemSelected","isAnnotationSelectedonTimeline","onTimelineItemAdded","onAnnotationDestroyed","generateVoidItem","generateItem","changeItem","changeTrack","getFormatedDate","getSelectedItemAndAnnotation","getStackLevel","getTrack","getAnnotation","onWindowResize","onTimelineResetZoom","initTrackCreation","filterItems","switchFilter","updateFiltersRender","disableFilter","updateDraggingCtrl","moveToCurrentTime","moveRight","moveLeft","zoomIn","zoomOut","stopZoomScrolling","repaintCustomTime","redraw","reset"),this.playerAdapter=t.playerAdapter,this.filtersManager=new f(annotationsTool.filtersManager),this.listenTo(this.filtersManager,"switch",this.updateFiltersRender),this.typeForDeleteAnnotation=annotationsTool.deleteOperation.targetTypes.ANNOTATION,this.typeForDeleteTrack=annotationsTool.deleteOperation.targetTypes.TRACK,this.endDate=this.getFormatedDate(this.playerAdapter.getDuration()),this.startDate=new Date(this.endDate.getFullYear(),this.endDate.getMonth(),this.endDate.getDate(),0,0,0),this.options={width:"100%",height:"auto",style:"box",showButtonNew:!1,editable:!0,start:this.startDate,end:this.endDate,min:this.startDate,max:this.endDate,intervalMin:5e3,showCustomTime:!0,showNavigation:!1,showMajorLabels:!1,snapEvents:!1,stackEvents:!0,minHeight:"200",axisOnTop:!0,groupsWidth:"150px",animate:!0,animateZoom:!0,eventMarginAxis:0,eventMargin:0,dragAreaWidth:5,groupsChangeable:!0},this.timeline=new links.Timeline(this.$el.find("#timeline")[0]),this.timeline.draw(this.filteredItems,this.options),e(window).bind("resize",this.onWindowResize),e(window).bind("selectTrack",e.proxy(this.onTrackSelected,this)),e(window).bind("deleteTrack",e.proxy(this.onDeleteTrack,this)),e(window).bind("updateTrack",e.proxy(this.onUpdateTrack,this)),e(this.playerAdapter).bind("pa_timeupdate",this.onPlayerTimeUpdate),links.events.addListener(this.timeline,"timechanged",this.onTimelineMoved),links.events.addListener(this.timeline,"timechange",this.onTimelineMoved),links.events.addListener(this.timeline,"change",this.onTimelineItemChanged),links.events.addListener(this.timeline,"delete",this.onTimelineItemDeleted),links.events.addListener(this.timeline,"select",this.onTimelineItemSelected),links.events.addListener(this.timeline,"add",this.onTimelineItemAdded),this.tracks=annotationsTool.video.get("tracks"),this.listenTo(this.tracks,"add",this.addTrack),this.listenTo(this.tracks,"change",this.changeTrack),this.listenTo(annotationsTool,annotationsTool.EVENTS.ANNOTATION_SELECTION,this.onSelectionUpdate),this.$el.show(),this.addTracksList(this.tracks),this.timeline.setCustomTime(this.startDate),this.timeline.redraw=this.redraw,this.timeline.repaintCustomTime=this.repaintCustomTime,this.timeline.findGroup||(this.timeline.findGroup=this.findGroup,_.bindAll(this.timeline,"findGroup")),e("div.timeline-group .content").popover({}),this.$el.find(".timeline-frame > div").first()[0].addEventListener("mousewheel",function(e){e.stopPropagation()},!0),this.timeline.redraw()},findGroup:function(t){var n;return _.each(this.groups,function(r){e(r.content).find("div.content").text().toUpperCase()===t.toUpperCase()&&(n=r)}),n},redraw:function(){this.timeline.draw(this.filteredItems,this.option),annotationsTool.hasSelection()&&this.onSelectionUpdate(annotationsTool.getSelection()),e("div.timeline-group .content").popover({}),this.updateDraggingCtrl(),annotationsTool.selectedTrack&&this.onTrackSelected(null,annotationsTool.selectedTrack.id),this.updateUnselectListener()},repaintCustomTime:function(){links.Timeline.prototype.repaintCustomTime.call(this.timeline),this.changeTitleFromCustomPlayhead()},changeTitleFromCustomPlayhead:function(){this.$el.find(".timeline-customtime").attr("title",annotationsTool.getWellFormatedTime(this.playerAdapter.getCurrentTime()))},moveLeft:function(e){links.Timeline.preventDefault(e),links.Timeline.stopPropagation(e),this.timeline.move(-0.2),this.timeline.trigger("rangechange"),this.timeline.trigger("rangechanged")},moveRight:function(e){links.Timeline.preventDefault(e),links.Timeline.stopPropagation(e),this.timeline.move(.2),this.timeline.trigger("rangechange"),this.timeline.trigger("rangechanged")},moveToCurrentTime:function(){var e=this.timeline.getVisibleChartRange(),t=this.getTimeInSeconds(e.start),n=this.getTimeInSeconds(e.end),r=n-t,i=this.playerAdapter.getCurrentTime(),s=this.playerAdapter.getDuration();i-r/2<0?(t=this.getFormatedDate(0),n=this.getFormatedDate(r)):i+r/2>s?(t=this.getFormatedDate(s-r),n=this.getFormatedDate(s)):(t=this.getFormatedDate(i-r/2),n=this.getFormatedDate(i+r/2)),this.timeline.setVisibleChartRange(t,n)},zoomIn:function(e){links.Timeline.preventDefault(e),links.Timeline.stopPropagation(e),this.timeline.zoom(.4,this.timeline.getCustomTime()),this.timeline.trigger("rangechange"),this.timeline.trigger("rangechanged")},zoomOut:function(e){links.Timeline.preventDefault(e),links.Timeline.stopPropagation(e),this.timeline.zoom(-0.4,this.timeline.getCustomTime()),this.timeline.trigger("rangechange"),this.timeline.trigger("rangechanged")},stopZoomScrolling:function(){this.$el.find(".timeline-frame > div").first()[0].addEventListener("mousewheel",function(e){e.stopPropagation()},!0)},addItem:function(e,t,n){this.allItems[e]=t,n||(this.filterItems(),this.redraw())},removeItem:function(e){delete this.allItems[e],this.filterItems(),this.redraw()},addAnnotation:function(e,t,n){if(e.get("oldId")&&this.ignoreAdd===e.get("oldId"))return;if(!e.id){e.bind("ready",this.addAnnotation,this);return}this.allItems[e.id]=this.generateItem(e,t),n||(this.filterItems(),this.timeline.redraw(),annotationsTool.setSelection([e],!1),this.onPlayerTimeUpdate()),e.bind("destroy",this.onAnnotationDestroyed,this)},addTrack:function(t){var n,r=function(e){this.addAnnotation(e,t,!1)},i=function(e){this.addAnnotation(e,t,!0)};if(!t.id){t.bind("ready",this.addTrack,this);return}this.allItems["track_"+t.id]=this.generateVoidItem(t),n=t.get("annotations"),n.each(i,this),n.bind("add",r,this),n.bind("change",this.changeItem,this),n.bind("remove",e.proxy(function(e){this.onAnnotationDestroyed(e,t)},this),this),this.filterItems(),this.timeline.redraw()},addTracksList:function(e){e.each(this.addTrack,this)},generateVoidItem:function(e){var t=e.toJSON();return t.id=e.id,t.isSupervisor=annotationsTool.user.get("role")===a.SUPERVISOR,{model:e,trackId:e.id,isMine:e.get("isMine"),isPublic:e.get("isPublic"),start:this.startDate-5e3,end:this.startDate-4500,content:this.VOID_ITEM,group:this.groupTemplate(t)}},generateItem:function(e,t){var n=this.playerAdapter.getDuration(),r,i,s,o,u,f;return e.set("level",this.PREFIX_STACKING_CLASS+this.getStackLevel(e),{silent:!0}),r=e.toJSON(),r.id=e.id,r.track=t.id,r.text=e.get("text"),r.label&&r.label.category&&r.label.category.settings&&(r.category=r.label.category),i=t.toJSON(),i.id=t.id,i.isSupervisor=annotationsTool.user.get("role")===a.SUPERVISOR,s=e.get("start"),o=s+e.get("duration"),u=this.getFormatedDate(s),f=this.getFormatedDate(o),r.atEnd=n-o<3,{model:t,id:e.id,trackId:t.id,isPublic:t.get("isPublic"),isMine:t.get("isMine"),editable:t.get("isMine"),start:u,end:f,content:this.itemTemplate(r),group:this.groupTemplate(i),className:r.level}},createTrack:function(e){var t;if(this.timeline.findGroup(e.name))return;t=this.tracks.create(e,{wait:!0}),annotationsTool.selectedTrack||(annotationsTool.selectedTrack=t),this.timeline.redraw(),this.onTrackSelected(null,annotationsTool.selectedTrack.id)},initTrackCreation:function(){var t=this,n,r,i,s=function(){r=t.groupModal.find("#name")[0].value,i=t.groupModal.find("#description")[0].value;if(r===""){t.groupModal.find(".alert #content").html("Name is required!"),t.groupModal.find(".alert").show();return}if(r.search(/<\/?script>/i)>=0||i.search(/<\/?script>/i)>=0){t.groupModal.find(".alert #content").html("Scripts are not allowed!"),t.groupModal.find(".alert").show();return}t.groupModal.find("#public").length>0?n=t.groupModal.find("#public")[0].checked?u.PUBLIC:u.PRIVATE:n=u.PUBLIC,t.createTrack({name:r,description:i,access:n},this),t.groupModal.modal("toggle")};if(e("div#modal-add-group.modal.in").length>0)return;this.groupModal?(this.groupModal.find(".alert #content").html(""),this.groupModal.find(".alert").hide(),this.groupModal.find("#name")[0].value="",this.groupModal.find("#description")[0].value="",this.groupModal.modal("toggle")):(e("body").append(this.modalGroupTemplate({isSupervisor:annotationsTool.user.get("role")===a.SUPERVISOR})),this.groupModal=e("#modal-add-group"),this.groupModal.modal({show:!0,backdrop:!1,keyboard:!0}),this.groupModal.find("a#add-group").bind("click",s),this.groupModal.bind("keypress",function(e){e.keyCode===13&&s()}),this.groupModal.on("shown",e.proxy(function(){this.groupModal.find("#name").focus()},this)),this.groupModal.find("#name").focus())},filterItems:function(){var e=_.values(this.allItems);return _.each(this.filtersManager.getFilters(),function(t){t.active&&(e=t.filter(e))}),this.filteredItems=_.sortBy(e,function(e){return _.isUndefined(e.model)?0:e.model.get("name")},this),this.filteredItems},switchFilter:function(t){var n=!e(t.target).hasClass("checked"),r=t.target.id.replace("filter-","");this.filtersManager.switchFilter(r,n)},updateFiltersRender:function(e){e.active?this.$el.find("#filter-"+e.id).addClass("checked"):this.$el.find("#filter-"+e.id).removeClass("checked"),this.filterItems(),this.timeline.redraw()},disableFilter:function(){this.$el.find(".filter").removeClass("checked"),this.filtersManager.disableFilters(),this.filterItems(),this.timeline.redraw()},changeItem:function(e){var t=this.getTimelineItemFromAnnotation(e);this.allItems[e.id]=this.generateItem(e,t.model),this.filterItems(),this.timeline.redraw()},onPlayerTimeUpdate:function(){var e=this.getFormatedDate(this.playerAdapter.getCurrentTime());this.timeline.setCustomTime(e),this.moveToCurrentTime()},onSelectionUpdate:function(e){var t=this.filteredItems;if(!annotationsTool.hasSelection()){this.timeline.unselectItem();return}this.isAnnotationSelectedonTimeline(e[0])||_.each(t,function(t,n){e[0].get("id")===t.id&&this.timeline.selectItem(n)},this),this.updateUnselectListener()},updateUnselectListener:function(){var t=this.ITEM_SELECTED_CLASS;this.$el.find("."+this.ITEM_SELECTED_CLASS+" .timeline-item").one("dblclick",function(n){e(this).parent().parent().hasClass(t)&&(n.stopImmediatePropagation(),annotationsTool.setSelection())})},onTimelineMoved:function(e){var n=this.getTimeInSeconds(e.time),r=this.playerAdapter.getStatus()===t.STATUS.PLAYING;r&&this.playerAdapter.pause(),this.playerAdapter.setCurrentTime(n<0||n>this.playerAdapter.getDuration()?0:n),r&&this.playerAdapter.play()},onTimelineItemChanged:function(){var e=this.playerAdapter.getStatus()===t.STATUS.PLAYING,n=this.getSelectedItemAndAnnotation(),r,i,s,o,u,a,f,l;this.playerAdapter.pause();if(!n||!n.annotation){console.warn("Can not get infos from updated item!"),this.timeline.cancelChange();return}u=this.getTimeInSeconds(n.item.end)-this.getTimeInSeconds(n.item.start),a=this.getTimeInSeconds(n.item.start),r=this.$el.find(".annotation-id:contains("+n.annotation.id+")").parent().parent()[0],i=this.timeline.getItemIndex(r),s=this.timeline.getItem(i);if(!n.newTrack.get("isMine")||!n.annotation.get("isMine")||this.getTimeInSeconds(n.item.end)>this.playerAdapter.getDuration()||this.getTimeInSeconds(n.item.start)>this.playerAdapter.getDuration()){this.timeline.cancelChange(),this.allItems[n.annotation.id]={start:n.item.start,end:n.item.end,content:n.item.content,group:this.groupTemplate(n.oldTrack.toJSON()),id:n.annotation.id,trackId:n.oldTrack.id,model:n.oldTrack,className:n.item.className},this.filterItems(),this.timeline.redraw(),e&&this.playerAdapter.play();return}n.newTrack.id!==n.oldTrack.id?(this.ignoreAdd=n.annotation.get("id"),this.ignoreDelete=this.ignoreAdd,f=n.annotation.toJSON(),o=f.id,f.oldId=this.ignoreAdd,f.start=a,f.duration=u,delete f.id,n.annotation.destroy(),l=n.newTrack.get("annotations").create(f,{wait:!0}),l.set("level",this.PREFIX_STACKING_CLASS+this.getStackLevel(l),{silent:!0}),f.id=l.get("id"),f.track=n.newTrack.id,f.level=l.get("level"),f.label&&f.label.category&&f.label.category.settings&&(f.category=f.label.category),delete this.allItems[o],this.allItems[f.id]={start:n.item.start,end:n.item.end,content:this.itemTemplate(f),group:n.item.group,id:f.id,trackId:n.newTrack.id,isPublic:n.newTrack.get("isPublic"),isMine:n.newTrack.get("isMine"),className:f.level,model:n.newTrack}):(this.allItems[n.annotation.id]=n.item,n.annotation.set({start:a,duration:u}),n.annotation.save(),l=n.annotation),annotationsTool.setSelection([l],!0),this.filterItems(),this.timeline.redraw(),e&&this.playerAdapter.play()},onTimelineItemDeleted:function(){var e=this.getSelectedItemAndAnnotation().annotation;this.timeline.cancelDelete(),annotationsTool.deleteOperation.start(e,this.typeForDeleteAnnotation)},onTimelineItemAdded:function(){this.timeline.cancelAdd()},onTimelineItemSelected:function(){var e=this.getSelectedItemAndAnnotation(),n;if(!e||!e.annotation)return;n=e.annotation,this.updateDraggingCtrl();if(this.playerAdapter.getStatus()!==t.STATUS.PLAYING||Math.abs(this.playerAdapter.getCurrentTime()-this.getTimeInSeconds(e.item.start))>1)this.playerAdapter.pause(),annotationsTool.setSelection([n],!0)},onAnnotationDestroyed:function(e){if(this.ignoreDelete===e.get("id"))return;this.timeline.setSelection([]),this.allItems[e.id]&&(delete this.allItems[e.id],this.filterItems(),this.timeline.redraw())},onTimelineResetZoom:function(){this.timeline.setVisibleChartRange(this.startDate,this.endDate)},onDeleteTrack:function(t,n){t.stopImmediatePropagation();var r=this.tracks.get(n),i=this,s,o,u;if(!r)return;u=e.proxy(function(){s=_.values(this.allItems),_.each(s,function(e){e.trackId===r.id&&delete this.allItems[e.id]},this),i.tracks.remove(r),!annotationsTool.selectedTrack||annotationsTool.selectedTrack.id===r.id?i.tracks.length>0&&(i.tracks.each(function(e){e.get("isMine")&&(o=e.id)}),i.onTrackSelected(null,o)):i.onTrackSelected(null,annotationsTool.selectedTrack.id),this.allItems["track_"+r.id]&&delete this.allItems["track_"+r.id],this.filterItems(),this.timeline.redraw()},this),annotationsTool.deleteOperation.start(r,this.typeForDeleteTrack,u)},changeTrack:function(e,t){var n,r=e.toJSON(),i=!1;r.isSupervisor=annotationsTool.user.get("role")===a.SUPERVISOR,n=this.groupTemplate(r),_.each(this.allItems,function(t){t.trackId===e.get("id")&&t.group!==n&&(t.group=n,t.isPublic=e.get("isPublic"),i=!0)},this),(!t||!t.silent)&&i&&(this.filterItems(),this.timeline.redraw())},onUpdateTrack:function(e,t){e.stopImmediatePropagation();var n=this.tracks.get(t),r,i;if(!n){console.warn("Track "+t+" does not exist!");return}r=n.get("access"),r===u.PRIVATE?i=u.PUBLIC:i=u.PRIVATE,n.set({access:i}),n.save()},onTrackSelected:function(e,t){var n;_.isString(t)&&!annotationsTool.localStorage?n=annotationsTool.video.getTrack(parseInt(t,10)):n=annotationsTool.video.getTrack(t);if(!n&&e||!n&&t)return;annotationsTool.selectedTrack=n,this.tracks.trigger("selected_track",n),this.$el.find("div.selected").removeClass("selected"),this.$el.find(".timeline-group .track-id:contains("+t+")").parent().parent().addClass("selected")},onWindowResize:function(){this.timeline.redraw(),annotationsTool.selectedTrack&&this.onTrackSelected(null,annotationsTool.selectedTrack.id)},getFormatedDate:function(e){var t=new Date(e*1e3);return t.setHours(t.getHours()-1),t},getTimeInSeconds:function(e){var t=e.getHours()*3600+e.getMinutes()*60+e.getSeconds()+e.getMilliseconds()/1e3;return Math.round(Number(t))},getSelectedItemAndAnnotation:function(){var t=e("."+this.ITEM_SELECTED_CLASS+" .annotation-id").text(),n=this.timeline.getSelection(),r,i,s,o,u,a;return n.length===0?undefined:(r=this.timeline.getItem(n[0].row),i=e(r.group).find(".track-id").text(),s=e(r.content).find(".track-id").text(),o=this.getTrack(s),u=this.getTrack(i),a=this.getAnnotation(t,o),{annotation:a,item:this.allItems[t],index:n[0].row,annotationId:t,trackId:i,newTrack:u,oldTrack:o})},isAnnotationSelectedonTimeline:function(e){return this.$el.find("div."+this.ITEM_SELECTED_CLASS+' div.timeline-item div.annotation-id:contains("'+e.get("id")+'")').length!==0},updateDraggingCtrl:function(){var e=this.$el.find("."+this.ITEM_SELECTED_CLASS),t=this.getSelectedItemAndAnnotation(),n={"margin-top":parseInt(e.css("margin-top"),10)+parseInt(e.find(".timeline-item").css("margin-top"),10)+"px",height:e.find(".timeline-item").outerHeight()+"px"};this.$el.find(".timeline-event-range-drag-left").css(n),t&&t.annotation&&t.annotation.get("duration")<1?n["margin-left"]=e.find(".timeline-item").outerWidth()+"px":n["margin-left"]="0px",this.$el.find(".timeline-event-range-drag-right").css(n)},getAnnotationFromItem:function(e){var t=e.trackId,n=e.id,r,i;return t&&n?(r=this.tracks.get(t),i=r.get("annotations").get(n),i):undefined},getTimelineItemFromAnnotation:function(e){return this.allItems[e.id]},getStackLevel:function(e){var t=e.get("start"),n=t+e.get("duration"),r=this.allItems[e.get("id")],i=0,s=0,o,u=0,a=[],f,l,c,h,p=function(r){var s=r.get("start"),o=s+r.get("duration");return s===o&&(o+=this.DEFAULT_DURATION),l=r.get("level"),typeof l!="undefined"?(c=l.search(this.PREFIX_STACKING_CLASS)+this.PREFIX_STACKING_CLASS.length,u=parseInt(l.substr(c,l.length-c),10)||0):u=0,u>i&&(i=u),r.id!==e.id&&(s>=t&&s<=n||o>t&&o<=n||s<=t&&o>=n)&&this.allItems[r.id]?(a[u]=!0,!0):!1};e.get("duration")===0&&(n+=this.DEFAULT_DURATION),e.collection&&(f=_.sortBy(e.collection.models,function(e){return e.get("start")},this),_.filter(f,p,this));for(h=0;h<a.length;h++)a[h]||(o=h);return typeof o=="undefined"?s=a.length:s=o,s>i&&(i=s),r&&r.model&&r.model.get("timelineMaxLevel")!==i,s},getTrack:function(e){var t=this.tracks.get(e);return t||this.tracks.each(function(n){n.id===e&&(t=n)},this),t},getAnnotation:function(e,t){if(_.isEmpty(e)||_.isUndefined(t))return;var n=t.get("annotations").get(e);return n||t.get("annotations").each(function(t){t.id===e&&(n=t)},this),n},reset:function(){var t;this.$el.hide(),e(this.playerAdapter).unbind("pa_timeupdate",this.onPlayerTimeUpdate),links.events.removeListener(this.timeline,"timechanged",this.onTimelineMoved),links.events.removeListener(this.timeline,"change",this.onTimelineItemChanged),links.events.removeListener(this.timeline,"delete",this.onTimelineItemDeleted),links.events.removeListener(this.timeline,"select",this.onTimelineItemSelected),e(window).unbind("selectTrack"),e(window).unbind("updateTrack"),e(window).unbind("deleteTrack"),e(window).unbind("deleteAnnotation"),e(window).unbind("resize",this.onWindowResize),this.undelegateEvents(),this.groupModal&&this.groupModal.remove(),this.tracks.each(function(e){t=e.get("annotations"),t.unbind("add")},this),this.allItems={},this.$el.find("#timeline").empty(),this.timeline.deleteAllItems(),this.timeline=null,delete this.timeline,this.filteredItems=[]}});return h}),define("collections/users",["jquery","models/user","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Users"),initialize:function(){this.url=window.annotationsTool.restEndpointsUrl+"/users"},parse:function(e){return e.users}});return r}),define("text!templates/user-login.tmpl",[],function(){return'\n	  <div class="modal-header">\n	    <h3>User login</h3>\n	  </div>\n	  <div class="modal-body">\n		<form class="form-horizontal">\n			<fieldset>\n			        <div class="alert alert-error" style="display:none">\n					<span><i class="icon-exclamation-sign"></i></span>\n					<span id="content"></span>\n					\n				</div>\n				\n				<div class="alert alert-info">\n					Create a new nickname for the user you are logged with in current context (LTI tool or other).\n				</div>\n				\n				<div class="control-group">\n					<label class="control-label" for="nickanme"><b>*</b> Nickname: </label>\n					<div class="controls">\n						<input type="text" class="input-xlarge" placeholder="Insert your nickname" id="nickname">\n					</div>\n				</div>\n				<div class="control-group">\n					<label class="control-label" for="email"><b>*</b> Email: </label>\n					<div class="controls">\n						<input type="text" class="input-xlarge" placeholder="Insert your email address" id="email">\n					</div>\n				</div>\n\n				{{#if localStorage}}\n				<div class="control-group">\n					<label class="control-label" for="supervisor">Log as supervisor: </label>\n					<div class="controls">\n						<input type="checkbox" id="supervisor">\n					</div>\n				</div>\n				{{/if}}\n\n				<div class="control-group">\n					<label class="control-label">Remember me: </label>\n					<div class="controls">\n						<input type="checkbox" id="remember" name="remember" value="remember">\n					</div>\n				</div>\n\n\n				<div style="float:right"><b>* required fields</b></div>\n			</fieldset>\n		</form>\n	  </div>\n	  <div class="modal-footer">\n	    <a id="save-user" href="#" class="btn btn-primary">Login</a>\n	  </div>'}),define("views/login",["jquery","backbone","models/user","collections/users","text!templates/user-login.tmpl","roles","handlebars"],function(e,t,n,r,i,s,o){"use strict";var u=t.View.extend({el:e("#user-login"),loginTemplate:o.compile(i),events:{"click #save-user":"login",keydown:"loginOnInsert"},initialize:function(){_.bindAll(this,"loginOnInsert","login","reset","show","hide"),_.extend(this,t.Events),this.$el.append(this.loginTemplate({localStorage:annotationsTool.localStorage})),this.$el.modal({show:!0,backdrop:!0,keyboard:!1}),this.$el.modal("hide"),this.$el.on("hide",function(){_.isUndefined(annotationsTool.user)&&setTimeout(function(){e("#user-login").modal("show")},5)})},show:function(){this.$el.modal("show")},hide:function(){this.$el.modal("hide")},loginOnInsert:function(e){e.keyCode===13&&this.login()},login:function(){var n=annotationsTool.getUserExtId(),r=this.$el.find("#nickname"),i=this.$el.find("#email"),o=this.$el.find("#remember"),u=this.$el.find(".alert"),a=!0,f;u.find("#content").empty();try{annotationsTool.localStorage?f=annotationsTool.users.create({user_extid:n,nickname:r.val(),role:this.$el.find("#supervisor")[0].checked?s.SUPERVISOR:s.USER},{wait:!0}):f=annotationsTool.users.create({user_extid:n,nickname:r.val()},{wait:!0}),f.bind("error",e.proxy(function(e,t){this.$el.find("#"+t.attribute).parentsUntil("form").addClass("error"),u.find("#content").append(t.message+"<br/>"),a=!1},this))}catch(l){a=!1,u.find("#content").append(l+"<br/>")}return f&&i.val()&&f.set({email:i.val()}),a?(o.is(":checked")&&(annotationsTool.users.add(f),t.localSync("create",f,{success:function(){console.log("current user saved locally")},error:function(e){console.warn(e)}})),f.save(),annotationsTool.user=f,this.$el.modal("toggle"),annotationsTool.users.trigger("login"),f):(this.$el.find(".alert").show(),undefined)},reset:function(){this.$el.find("#nickname")[0].value="",this.$el.find("#email")[0].value="",this.$el.find("#remember")[0].value=""}});return u}),define("collections/scales",["jquery","models/scale","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Scales"),initialize:function(e,t){_.bindAll(this,"setUrl","addCopyFromTemplate","toExportJSON"),this.setUrl(t)},parse:function(e){return e.scales&&_.isArray(e.scales)?e.scales:_.isArray(e)?e:null},setUrl:function(e){!e||!e.collection?(this.url=window.annotationsTool.restEndpointsUrl+"/scales",this.isTemplate=!0):(this.url=e.url()+"/scales",this.isTemplate=!1,annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url))),this.each(function(e){e.setUrl()})},toExportJSON:function(){var e=[];return this.each(function(t){e.push(t.toExportJSON())}),e},addCopyFromTemplate:function(e){if(!this.isTemplate&&!_.isArray(e)&&e.id){var t=e.toJSON();return delete t.id,delete t.created_at,delete t.created_by,delete t.updated_at,delete t.updated_by,delete t.deleted_by,delete t.deleted_at,delete t.labels,t.copyUrl="?scale_id="+e.id,this.create(t)}return null}});return r}),define("text!templates/scale-value-editor.tmpl",[],function(){return'<div class="scale-value">\n    <a class="btn order-up"><i class="icon-arrow-up"></i></a>\n    <a class="btn order-down"><i class="icon-arrow-down"></i></a>\n    <input type="text" class="input-small scale-value-name" value="{{name}}" /> \n    <input type="text" class="input-small scale-value-value" placeholder="Insert a decimal number." value="{{value}}" />\n    <a class="btn delete-scale-value"><i class="icon-remove"></i></a>\n</div>'}),define("views/scalevalue-editor",["jquery","backbone","models/scalevalue","text!templates/scale-value-editor.tmpl","handlebars"],function(e,t,n,r,i){"use strict";var s=t.View.extend({scaleValueEditorTemplate:i.compile(r),isDeleted:!1,events:{"click .order-up":"up","click .order-down":"down","click a.delete-scale-value":"deleteScaleValue","keydown .scale-value-name":"saveOnInsert","keydown .scale-value-value":"saveOnInsert","focusout .scale-value-value":"save","focusout .scale-value-name":"save"},initialize:function(e){_.bindAll(this,"render","up","down","saveOnInsert","getSortedCollection","deleteScaleValue"),_.extend(this,t.Events),this.model=e.model,this.isNew=e.isNew,this.next=e.next,this.previous=e.previous,this.onChange=e.onChange,this.scaleValueDeleteType=annotationsTool.deleteOperation.targetTypes.SCALEVALUE,this.setElement(this.scaleValueEditorTemplate(this.model.toJSON()))},render:function(){var e=this.model.toJSON();return this.setElement(this.scaleValueEditorTemplate(e)),this.delegateEvents(this.events),this},up:function(){var e=this.model.get("order"),t=this.getSortedCollection(),n;e>0&&(n=t[e-1],n.set("order",e),this.model.set("order",e-1),n.save(),this.model.save()),this.onChange()},down:function(){var e=this.model.get("order"),t=this.getSortedCollection(),n;e<t.length-1&&(n=t[e+1],n.set("order",e),this.model.set("order",e+1),n.save(),this.model.save()),this.onChange()},saveOnInsert:function(e){e.keyCode===13&&this.save()},save:function(){var e=this.$el.find(".scale-value-name").val(),t=this.$el.find(".scale-value-value"),n=parseFloat(t.val());isNaN(n)?(t.val(""),t.addClass("error")):(t.removeClass("error"),this.model.set({name:e,value:n}),this.model.save())},deleteScaleValue:function(e){var t=this,n=t.getSortedCollection();e.stopImmediatePropagation(),annotationsTool.deleteOperation.start(this.model,this.scaleValueDeleteType,function(){var e=t.model.get("order"),r;if(e<n.length-1)for(r=e+1;r<n.length;r++)n[r].set("order",r-1),n[r].save();t.isDeleted=!0,t.onChange(),t.remove()})},getSortedCollection:function(){return this.model.collection.sortBy(function(e){return e.get("order")})}});return s}),define("text!templates/scale-editor.tmpl",[],function(){return'      <div class="modal-header">\n\n        <h3>{{title}}\n            <span class="manage">\n                <select id="scale-id">\n                </select>\n                <a class="btn edit-scale"><icon class="icon-edit"></i></a>\n                <a class="btn create-scale"><icon class="icon-plus-sign"></i></a>\n            </span>\n        </h3>\n\n      </div>\n      <div class="modal-body"></div>\n\n      <div class="modal-footer">\n        <a id="cancel-scale" href="#" class="btn">Cancel</a>\n        <a id="save-scale" href="#" class="btn btn-primary">Save</a>\n      </div>'}),define("text!templates/scale-editor-select.tmpl",[],function(){return'{{#each scales}}\n<option value="{{this.id}}" {{#if this.isSelected}}selected="selected"{{/if}}>{{this.name}}</option>\n{{/each}}'}),define("text!templates/scale-editor-content.tmpl",[],function(){return'        <form class="form-horizontal">\n            <fieldset>                \n                <div class="control-group">\n                    <label class="control-label" for="nickanme"><b>*</b> Name: </label>\n                    <div class="controls">\n                        <input type="text" class="input-xlarge scale-name" placeholder="Insert the category name" value="{{scale.name}}"></input>\n                    </div>\n                    <label class="control-label" for="nickanme">Description: </label>\n                    <div class="controls">\n                        <input type="text" class="input-xlarge scale-description" placeholder="Insert the category description" value="{{scale.description}}"></input>\n                    </div>\n                    <div class="controls">\n                        <a class="btn delete-scale"><i class="icon-trash"></i>Delete</a>\n                    </div>\n\n                </div>\n\n                <div>\n                    <div class="header-name">Name</div>\n                    <div class="header-value">Value</div>\n                </div>\n                <div class="control-group list-scale-values"></div>\n                 <a class="btn create-scale-value"><i class="icon-plus-sign"></i> Add scale value</a>\n\n            </fieldset>\n        </form>'}),define("views/scale-editor",["jquery","backbone","models/scale","collections/scales","views/scalevalue-editor","text!templates/scale-editor.tmpl","text!templates/scale-editor-select.tmpl","text!templates/scale-editor-content.tmpl","access","handlebars"],function(e,t,n,r,i,s,o,u,a,f){"use strict";var l=t.View.extend({TITLES:{CATEGORY_EDIT:"Edit category scale",STANDALONE_EDIT:"Edit scales",SAVE_BUTTON:"Save",CREATE_BUTTON:"Create"},EMPTY_SCALE:{name:"-- NO SCALE --",id:"NO"},el:e("#scale-editor"),scaleEditorTemplate:f.compile(s),scaleEditorSelectTemplate:f.compile(o),scaleEditorContentTemplate:f.compile(u),events:{"click #save-scale":"save","click #cancel-scale":"cancel","click a.edit-scale":"startEditScale","click a.create-scale":"createScale","click a.delete-scale":"deleteScale","click a.create-scale-value":"createScaleValue","change select#scale-id":"changeScale","keydown #save-scale":"saveOnInsert"},initialize:function(){_.bindAll(this,"initialize","saveOnInsert","save","startEditScale","createScale","createScaleValue","deleteScale","changeScale","cancel","renderEditContent","renderScaleSelect","generateScalesForTemplate","show","hide"),_.extend(this,t.Events),this.scaleDeleteType=annotationsTool.deleteOperation.targetTypes.SCALE,this.$el.modal({show:!0,backdrop:!1,keyboard:!1}),this.$el.modal("hide")},show:function(e){var t={title:this.TITLES.STANDALONE_EDIT};this.EMPTY_SCALE.isSelected=!1,e&&(this.currentCategory=e,e.get("settings").hasScale&&(this.currentScaleId=e.get("scale_id")),t.title=this.TITLES.CATEGORY_EDIT),this.$el.empty(),this.$el.append(this.scaleEditorTemplate(t)),this.renderScaleSelect(),this.changeScale(),this.$el.modal("show"),this.$el.css("z-index",400)},generateScalesForTemplate:function(){var e=annotationsTool.video.get("scales").toJSON(),t;return e=_.where(e,{access:this.currentCategory.get("access")}),e.push(this.EMPTY_SCALE),this.currentScaleId?(t=_.find(e,function(e){return e.id===this.currentScaleId},this),t&&(t.isSelected=!0)):this.EMPTY_SCALE.isSelected=!0,e},renderScaleSelect:function(){this.$el.find("select#scale-id").empty().append(this.scaleEditorSelectTemplate({scales:this.generateScalesForTemplate()})),this.delegateEvents(this.events)},hide:function(){this.$el.modal("hide"),this.category&&delete this.category},saveOnInsert:function(e){e.keyCode===13&&this.save()},save:function(){var e,t,n;this.isInEditMode?(e=this.$el.find(".modal-body .scale-name").val(),t=this.$el.find(".modal-body .scale-description").val(),this.currentScale.set({name:e,description:t}),this.currentScale.collection||(annotationsTool.video.get("scales").add(this.currentScale),this.currentScale.save({async:!1}),this.currentScale.setUrl(),this.currentScale.get("scaleValues").each(function(e){e.save()}),this.currentScaleId=this.currentScale.get("id"),this.$el.find("select#scale-id").removeAttr("disabled")),this.isInEditMode=!1,this.renderScaleSelect(),this.changeScale(),this.$el.find(".modal-body").hide(),this.$el.find("a#save-scale").text(this.TITLES.SAVE_BUTTON)):this.currentCategory&&(n=this.currentCategory.get("settings"),this.currentScaleId===this.EMPTY_SCALE.id?(n.hasScale=!1,this.currentCategory.unset("scale_id"),this.currentCategory.unset("scale")):(n.hasScale=!0,this.currentCategory.set({scale_id:this.currentScaleId,scale:this.currentScale})),this.currentCategory.set("settings",n),this.currentCategory.save(),this.changeScale(),this.hide())},cancel:function(){this.isInEditMode?(this.isInEditMode=!1,this.renderScaleSelect(),this.changeScale(),this.$el.find(".modal-body").hide(),this.$el.find("select#scale-id").removeAttr("disabled"),this.$el.find("a#save-scale").text(this.TITLES.SAVE_BUTTON)):this.hide()},changeScale:function(){this.currentScaleId=this.$el.find("select#scale-id").val(),this.currentScale=annotationsTool.video.get("scales").get(this.currentScaleId),this.currentScale&&this.currentScale.get("isMine")?(this.isInEditMode?this.$el.find("a.edit-scale").hide():this.$el.find("a.edit-scale").show(),this.renderEditContent(this.currentScale)):(this.isInEditMode=!1,this.$el.find("a.edit-scale").hide(),this.$el.find(".modal-body").hide())},createScale:function(){this.isInEditMode=!0,this.$el.find("a#save-scale").text(this.TITLES.CREATE_BUTTON),this.currentScale=new n({name:"New scale",access:this.currentCategory.get("access")}),this.renderEditContent(this.currentScale),this.$el.find("select#scale-id").attr("disabled","disabled"),this.$el.find(".modal-body").show()},createScaleValue:function(){this.currentScale.get("scaleValues").create({order:this.$el.find(".scale-value").length,name:"New scale value",value:0,access:this.currentCategory.get("access")})},deleteScale:function(e){var t=this;e.stopImmediatePropagation(),annotationsTool.deleteOperation.start(this.currentScale,this.scaleDeleteType,t.cancel)},startEditScale:function(){this.isInEditMode=!0,this.$el.find("a#save-scale").text(this.TITLES.SAVE_BUTTON),this.$el.find("a.edit-scale").hide(),this.$el.find(".modal-body").show()},renderEditContent:function(e){var t=[],n=this.currentScale.get("scaleValues"),r=function(e){return e.get("order")},s=function(){t=_.where(t,{isDeleted:!1}),t=_.sortBy(t,function(e){return r(e.model)}),this.$el.find(".list-scale-values").empty(),_.each(t,function(e){this.$el.find(".list-scale-values").append(e.render().$el)},this)},o=function(e,n){var r=this,o={model:e,onChange:function(){s.call(r)}};t.push(new i(o)),_.isNumber(n)||s.call(r)};n.bind("add",o,this),n=n.sortBy(r,this),_.each(n,o,this),this.$el.find(".modal-body").empty().append(this.scaleEditorContentTemplate({scale:e.toJSON()})),s.call(this),this.delegateEvents(this.events)}});return l}),define("models/track",["jquery","collections/annotations","access","backbone"],function(e,t,n,r){"use strict";var i=r.Model.extend({defaults:{access:n.PRIVATE},initialize:function(e){_.bindAll(this,"getAnnotation");if(!e||_.isUndefined(e.name))throw"'name' attribute is required";e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),e.annotations&&_.isArray(e.annotations)?this.set({annotations:new t(e.annotations,this)}):this.set({annotations:new t([],this)}),window.annotationsTool.localStorage&&(e.created_by||(e.created_by=annotationsTool.user.get("id"),e.created_by_nickname=annotationsTool.user.get("nickname"))),delete e.annotations,e.id&&this.get("annotations").fetch({async:!1}),e.tags&&(e.tags=this.parseJSONString(e.tags)),e.created_by&&annotationsTool.user.get("id")===e.created_by||!e.created_by?e.isMine=!0:e.isMine=!1,_.extend(this,r.Events),this.set(e)},parse:function(e){var t=e.attributes?e.attributes:e;return t.created_at=t.created_at!==null?Date.parse(t.created_at):null,t.updated_at=t.updated_at!==null?Date.parse(t.updated_at):null,t.deleted_at=t.deleted_at!==null?Date.parse(t.deleted_at):null,t.settings=this.parseJSONString(t.settings),annotationsTool.user.get("id")===t.created_by?t.isMine=!0:t.isMine=!1,t.access===n.PUBLIC?t.isPublic=!0:t.isPublic=!1,t.tags&&(t.tags=this.parseJSONString(t.tags)),e.attributes?e.attributes=t:e=t,e},validate:function(e){var t,r;e.id&&this.get("id")!==e.id&&(this.id=e.id,this.attributes.id=e.id,this.toCreate=!1,this.setUrl(),this.attributes.ready=!0,this.trigger("ready",this),r=this.get("annotations"),r&&r.length===0&&r.fetch({async:!1,add:!0}));if(e.description&&!_.isString(e.description))return"'description' attribute must be a string";if(e.settings&&_.isUndefined(this.parseJSONString(e.settings)))return"'settings' attribute must be a string or a JSON object";if(e.tags&&_.isUndefined(this.parseJSONString(e.tags)))return"'tags' attribute must be a string or a JSON object";if(!_.isUndefined(e.access)){if(!_.include(n,e.access))return"'access' attribute is not valid.";this.attributes.access!==e.access&&(e.access===n.PUBLIC?this.attributes.isPublic=!0:this.attributes.isPublic=!1)}if(e.created_at){if((t=this.get("created_at"))&&t!==e.created_at)return"'created_at' attribute can not be modified after initialization!";if(!_.isNumber(e.created_at))return"'created_at' attribute must be a number!"}if(e.updated_at&&!_.isNumber(e.updated_at))return"'updated_at' attribute must be a number!";if(e.deleted_at&&!_.isNumber(e.deleted_at))return"'deleted_at' attribute must be a number!"},setUrl:function(){this.attributes.annotations&&this.attributes.annotations.setUrl(this)},getAnnotation:function(e){return this.get("annotations").get(e)},toJSON:function(){var e=r.Model.prototype.toJSON.call(this);return e.tags&&(e.tags=JSON.stringify(e.tags)),delete e.annotations,e},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn("Can not parse parameter '"+e+"': "+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e}});return i}),define("collections/tracks",["jquery","models/track","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Tracks"),initialize:function(e,t){_.bindAll(this,"setUrl"),this.setUrl(t)},parse:function(e){return e.tracks&&_.isArray(e.tracks)?e.tracks:_.isArray(e)?e:null},getMine:function(){return this.where({isMine:!0})},getVisibleTracks:function(){return this.remove(this.where({isMine:!1,access:0}))},setUrl:function(e){if(!e||!e.collection)throw"Parent video must be given!";this.url=e.url()+"/tracks",annotationsTool.localStorage&&(this.localStorage=new n.LocalStorage(this.url)),this.each(function(e){e.setUrl()})}});return r}),define("models/video",["jquery","collections/tracks","collections/categories","collections/scales","access","backbone"],function(e,t,n,r,i,s){"use strict";var o=s.Model.extend({defaults:{access:i.PUBLIC},initialize:function(e){_.bindAll(this,"getTrack","getAnnotation"),e.id||(window.annotationsTool.localStorage&&(e.id=this.cid),this.toCreate=!0),e.tracks&&_.isArray(e.tracks)?this.set({tracks:new t(e.tracks,this)}):this.set({tracks:new t([],this)}),e.categories&&_.isArray(e.categories)?this.set({categories:new n(e.categories,this)}):this.set({categories:new n([],this)}),e.scales&&_.isArray(e.scales)?this.set({scales:new r(e.scales,this)}):this.set({scales:new r([],this)}),e.tags&&this.set({tags:this.parseJSONString(e.tags)}),e.id&&(this.get("categories").fetch({async:!1}),this.get("tracks").fetch({async:!1}),this.get("scales").fetch({async:!1})),_.extend(this,s.Events),this.noPOST=!0},parse:function(e){var t=e.attributes?e.attributes:e;return t.created_at=t.created_at!==null?Date.parse(t.created_at):null,t.updated_at=t.updated_at!==null?Date.parse(t.updated_at):null,t.deleted_at=t.deleted_at!==null?Date.parse(t.deleted_at):null,t.settings=this.parseJSONString(t.settings),t.tags&&(t.tags=this.parseJSONString(t.tags)),e.attributes?e.attributes=t:e=t,e},validate:function(e){var n,r,i,s,o=this;e.id&&this.get("id")!==e.id&&(this.id=e.id,this.attributes.id=e.id,this.setUrl(),r=this.attributes.categories,i=this.attributes.tracks,s=this.attributes.scales,i&&i.length===0&&i.fetch({async:!1,success:function(){o.tracksReady=!0,o.tracksReady&&o.categoriesReady&&o.scalesReady&&(o.trigger("ready"),o.attributes.ready=!0)}}),s&&s.length===0&&s.fetch({async:!1,success:function(){o.scalesReady=!0,r&&r.length===0?r.fetch({async:!1,success:function(){o.categoriesReady=!0,o.tracksReady&&o.categoriesReady&&o.scalesReady&&(o.trigger("ready"),o.attributes.ready=!0)}}):o.tracksReady&&o.categoriesReady&&o.scalesReady&&(o.trigger("ready"),o.attributes.ready=!0)}}));if(!(!e.tracks||e.tracks instanceof t))return"'tracks' attribute must be an instance of 'Tracks'";if(e.tags&&_.isUndefined(this.parseJSONString(e.tags)))return"'tags' attribute must be a string or a JSON object";if(e.created_at){if((n=this.get("created_at"))&&n!==e.created_at)return"'created_at' attribute can not be modified after initialization!";if(!_.isNumber(e.created_at))return"'created_at' attribute must be a number!"}if(e.updated_at&&!_.isNumber(e.updated_at))return"'updated_at' attribute must be a number!";if(e.deleted_at&&!_.isNumber(e.deleted_at))return"'deleted_at' attribute must be a number!"},setUrl:function(){this.attributes.tracks&&this.attributes.tracks.setUrl(this),this.attributes.categories&&this.attributes.categories.setUrl(this),this.attributes.scales&&this.attributes.scales.setUrl(this)},getTrack:function(e){return this.get("tracks").get(e)},getAnnotation:function(e,t){var n=this.getTrack(t);if(n)return n.getAnnotation(e)},parseJSONString:function(e){if(e&&_.isString(e))try{e=JSON.parse(e)}catch(t){return console.warn("Can not parse parameter '"+e+"': "+t),undefined}else if(!_.isObject(e)||_.isFunction(e))return undefined;return e},toJSON:function(){var t=e.proxy(s.Model.prototype.toJSON,this)();return t.tags&&(t.tags=JSON.stringify(t.tags)),delete t.tracks,delete t.categories,delete t.scales,t}});return o}),define("collections/videos",["jquery","models/video","backbone","localstorage"],function(e,t,n){"use strict";var r=n.Collection.extend({model:t,localStorage:new n.LocalStorage("Videos"),initialize:function(){this.url=window.annotationsTool.restEndpointsUrl+"/videos"}});return r}),define("backbone-annotations-sync",["jquery","backbone"],function(e){"use strict";var t=function(t,n,r){var i=this,s,o,u,a,f,l;if(_.contains(annotationsTool.localStorageOnlyModel,n.TYPE))return Backbone.localSync(t,n,r);e.support.cors=!0,this.config={headerParams:{userId:"X-ANNOTATIONS-USER-ID",token:"X-ANNOTATIONS-USER-AUTH-TOKEN"}},this.getURI=function(e,t){return typeof e.collection!="undefined"?t&&typeof e.id!="undefined"?e.url():e.collection.url:_.isFunction(e.url)?e.url():e.url},this.setError=function(e,n,i){console.warn("Error during "+t+" of resource, "+e.status+", "+n),r.error(n+", "+i)},this.setHeaderParams=function(e){annotationsTool.user&&e.setRequestHeader(i.config.headerParams.userId,annotationsTool.user.id);var t;annotationsTool.getUserAuthToken&&!_.isUndefined(t=annotationsTool.getUserAuthToken())&&e.setRequestHeader(i.config.headerParams.token,t)},s=function(t){e.ajax(_.extend(_.clone(r),{crossDomain:!0,type:"POST",async:!1,url:i.getURI(t,!1),dataType:"json",data:t.toJSON(),beforeSend:i.setHeaderParams,success:function(e,n,i){t.toCreate=!1,t.set(e),t.setUrl&&t.setUrl(),t.collection&&r.wait&&t.collection.add(t),r.success(e,n,i)},error:i.setError}))},a=function(t){e.ajax(_.extend(_.clone(r),{crossDomain:!0,type:"POST",async:!1,url:i.getURI(t,!1)+t.get("copyUrl"),dataType:"json",data:t.toJSON(),beforeSend:i.setHeaderParams,success:function(e,n,i){t.toCreate=!1,t.unset("copyUrl"),t.setUrl&&t.setUrl(),t.collection&&t.collection.add(t),r.success(e,n,i)},error:i.setError}))},u=function(t){e.ajax(_.extend(_.clone(r),{crossDomain:!0,type:"GET",url:i.getURI(t,!0),dataType:"json",beforeSend:i.setHeaderParams,success:function(e){r.success(e)},error:i.setError}))},f=function(t){e.ajax(_.extend(_.clone(r),{crossDomain:!0,type:"GET",url:i.getURI(t,!1),dataType:"json",beforeSend:i.setHeaderParams,success:function(e,t,n){r.success(e,t,n)},error:i.setError}))},o=function(t){e.ajax(_.extend(_.clone(r),{crossDomain:!0,async:!1,type:"PUT",url:i.getURI(t,!t.toCreate&&!t.noPOST),data:t.toJSON(),beforeSend:i.setHeaderParams,success:function(e,n,i){t.toCreate=!1,t.setUrl&&t.setUrl(),r.success(e,n,i)},error:i.setError}))},l=function(t){e.ajax(_.extend(_.clone(r),{crossDomain:!0,type:"DELETE",url:i.getURI(t,!0),dataType:"json",beforeSend:i.setHeaderParams,success:function(e,n,i){i.status===204?r.success(t):r.error("Waiting for status code 204 but got: "+i.status)},error:i.setError}))};switch(t){case"create":case"update":n.toCreate&&!n.noPOST?n.get("copyUrl")?a(n):s(n):o(n);break;case"read":n.id!==undefined?u(n):f(n);break;case"delete":l(n)}};return t}),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=n,this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var n=this.$element.find(".item.active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle()),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f;this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u](),f=e.Event("slide",{relatedTarget:i[0]});if(i.hasClass("active"))return;if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),n.data());i.carousel(s),t.preventDefault()})}(window.jQuery),define("carousel",function(){}),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],t.trigger({type:"show",relatedTarget:i}),s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery),define("tab",function(){}),define("views/main",["jquery","prototypes/player_adapter","views/annotate","views/list","views/timeline","views/login","views/scale-editor","collections/annotations","collections/users","collections/videos","models/user","models/track","models/video","backbone-annotations-sync","roles","FiltersManager","backbone","localstorage","bootstrap","carousel","tab"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";var g=m.View.extend({el:e("body"),playerAdapter:null,loadingBox:e("div#loading"),events:{"click #logout":"logout","click #print":"print"},initialize:function(n){if(annotationsTool.isBrowserIE9()&&!(n.__proto__ instanceof t)||!annotationsTool.isBrowserIE9()&&!(n instanceof t))throw"The player adapter is not valid! It must has PlayerAdapter as prototype.";_.bindAll(this,"checkUserAndLogin","createViews","initModels","logout","loadPlugins","onDeletePressed","onWindowResize","print","ready","setLoadingProgress"),this.setLoadingProgress(10,"Starting tool."),window.annotationsTool.localStorage?(m.sync=m.localSync,this.$el.find("#export").parent().remove()):(this.$el.find("#export").attr("href",annotationsTool.exportUrl),m.sync=p),this.playerAdapter=n,this.setLoadingProgress(20,"Get users saved locally."),annotationsTool.users=new a,m.localSync("read",annotationsTool.users,{success:function(e){annotationsTool.users.add(e)},error:function(e){console.warn(e)}}),this.loginView=new s,annotationsTool.scaleEditor=new o,annotationsTool.dispatcher=_.clone(m.Events),this.listenTo(annotationsTool.users,"login",this.createViews),this.listenTo(annotationsTool.dispatcher,"deleteAnnotation",this.deleteAnnotation),this.checkUserAndLogin(),e(window).resize(this.onWindowResize),e(window).bind("keydown",e.proxy(this.onDeletePressed,this)),annotationsTool.filtersManager=new v,annotationsTool.importCategories=this.importCategories,annotationsTool.dispatcher.once(annotationsTool.EVENTS.READY,function(){this.loadPlugins(annotationsTool.plugins)},this)},loadPlugins:function(e){_.each(e,function(e){e()},this)},createViews:function(){this.setLoadingProgress(40,"Start creating views."),e("#video-container").show(),this.setLoadingProgress(45,"Start loading video."),this.initModels(e.proxy(function(){var s=e.proxy(function(){e(this.playerAdapter).off(t.EVENTS.READY+" "+t.EVENTS.PAUSE,s),this.setLoadingProgress(60,"Start creating views."),annotationsTool.getLayoutConfiguration().timeline&&(this.setLoadingProgress(70,"Creating timeline."),this.timelineView=new i({playerAdapter:this.playerAdapter}),annotationsTool.views.timeline=this.timelineView),annotationsTool.getLayoutConfiguration().annotate&&(this.setLoadingProgress(80,"Creating annotate view."),this.annotateView=new n({playerAdapter:this.playerAdapter}),this.listenTo(this.annotateView,"change-layout",this.onWindowResize),this.annotateView.$el.show(),annotationsTool.views.annotate=this.annotateView),annotationsTool.getLayoutConfiguration().list&&(this.setLoadingProgress(90,"Creating list view."),this.listView=new r,this.listenTo(this.listView,"change-layout",this.onWindowResize),this.listView.$el.show(),annotationsTool.views.list=this.listView),this.ready()},this);this.playerAdapter.load(),this.loadingBox.find(".info").text("Initializing the player."),this.playerAdapter.getStatus()===t.STATUS.PAUSED?s():e(this.playerAdapter).on(t.EVENTS.READY+" "+t.EVENTS.PAUSE,s)},this))},ready:function(){this.setLoadingProgress(100,"Ready."),this.loadingBox.hide(),this.onWindowResize(),e("a#logout").css("display","block"),this.timelineView.redraw(),annotationsTool.dispatcher.trigger(annotationsTool.EVENTS.READY)},checkUserAndLogin:function(){this.setLoadingProgress(30,"Get current user."),annotationsTool.users.length>0?(annotationsTool.user=annotationsTool.users.at(0),this.createViews()):this.loginView.show()},logout:function(){this.playerAdapter.pause(),e("a#logout").hide(),annotationsTool.playerAdapter.pause(),annotationsTool.playerAdapter.setCurrentTime(0),e("#video-container").hide(),annotationsTool.getLayoutConfiguration().timeline&&this.timelineView.reset(),annotationsTool.getLayoutConfiguration().annotate&&this.annotateView.reset(),annotationsTool.getLayoutConfiguration().list&&this.listView.reset(),this.loginView.reset(),delete annotationsTool.tracks,delete annotationsTool.video,delete annotationsTool.user,this.loadingBox.find(".bar").width("0%"),this.loadingBox.show(),this.loginView.show(),annotationsTool.users.each(function(e){m.localSync("delete",e,{success:function(){console.log("current session destroyed.")},error:function(e){console.warn(e)}})}),annotationsTool.logoutUrl&&(document.location=annotationsTool.logoutUrl)},print:function(){window.focus(),document.readyState==="complete"?(window.print(),/chrome/i.test(navigator.userAgent)&&document.location.reload(!1)):setTimeout(this.print,1e3)},initModels:function(t){var n,r=new f,i,s,o,u,a=e.proxy(function(){o=i.getMine()[0],o.get("id")?annotationsTool.selectedTrack=o:o.bind("ready",function(){a();return},this),u=i.length,i.each(function(e){s=e.get("annotations"),this.listenTo(s,"add",this.onWindowResize),--u===0&&t()},this)},this),l=function(){i=annotationsTool.video.get("tracks"),annotationsTool.localStorage&&(i=i.getVisibleTracks()),i.getMine().length===0?i.create({name:"Default "+annotationsTool.user.get("nickname"),description:"Default track for user "+annotationsTool.user.get("name")},{wait:!0,success:a}):a()};window.annotationsTool.localStorage?(r.fetch(),r.length===0?n=r.create({video_extid:annotationsTool.getVideoExtId()},{wait:!0}):n=r.at(0),annotationsTool.video=n,l()):(r.add({video_extid:annotationsTool.getVideoExtId()}),n=r.at(0),annotationsTool.video=n,n.save(),n.get("ready")?l():n.once("ready",l))},importCategories:function(e,t){var n=annotationsTool.video.get("categories"),r=annotationsTool.video.get("scales"),i,s,o,u,a,f={};if(!e.categories||e.categories.length===0)return;_.each(e.scales,function(e){a=e.id,u=e.scaleValues,delete e.id,delete e.scaleValues,o=r.create(e,{async:!1}),f[a]=o.get("id"),u&&_.each(u,function(e){e.scale=o,o.get("scaleValues").create(e)})}),_.each(e.categories,function(e){i=e.labels,e.scale_id=f[e.scale_id],delete e.labels,s=n.create(_.extend(e,t)),i&&_.each(i,function(e){e.category=s,s.get("labels").create(e)})})},onDeletePressed:function(e){var t;if(e.keyCode!==8||document.activeElement.tagName.toUpperCase()==="TEXTAREA"||document.activeElement.tagName.toUpperCase()==="INPUT"||!annotationsTool.hasSelection())return;e.preventDefault(),t=annotationsTool.getSelection()[0],t&&annotationsTool.dispatcher.trigger("deleteAnnotation",t.get("id"),t.trackId)},deleteAnnotation:function(e,t){var n;typeof t=="undefined"&&annotationsTool.video.get("tracks").each(function(n){n.get("annotations").get(e)&&(t=n.get("id"))}),n=annotationsTool.video.getAnnotation(e,t),n?annotationsTool.deleteOperation.start(n,annotationsTool.deleteOperation.targetTypes.ANNOTATION):console.warn("Not able to find annotation %i on track %i",e,t)},onWindowResize:function(){var t,n;this.annotateView&&this.listView&&(n=e(window).height(),t=this.listView.$el.find("#content-list"),t.css("max-height",n-e("#annotate-container").height()-100),this.timelineView.$el.find("#timeline").css("max-height",n-(e("#video-container").height()+130)))},setLoadingProgress:function(e,t){this.loadingBox.find(".bar").width(e+"%"),this.loadingBox.find(".info").text(t)}});return g}),define("text!templates/alert-modal.tmpl",[],function(){return'<div class="modal" id="modal-alert">\n      <div class="modal-body">\n            <div class="alert {{class}} alert-block">\n                  <h4>{{title}}</h4>\n\n                  {{message}}\n            </div>\n      </div>\n      <div class="modal-footer">\n            <a id="confirm-alert" href="#" class="btn btn-primary">Ok</a>\n      </div>\n</div>'}),define("views/alert",["jquery","backbone","text!templates/alert-modal.tmpl","roles","handlebars"],function(e,t,n,r,i){"use strict";var s=t.View.extend({el:e("#alert"),alertTemplate:i.compile(n),events:{"click #confirm-alert":"hide"},TYPES:{ERROR:{title:"Error!",className:"alert-error"},WARNING:{title:"Warning!",className:""},INFO:{title:"Information",className:"alert-info"}},initialize:function(){_.bindAll(this,"show","hide")},show:function(e,t){var n;if(_.isUndefined(e)||_.isUndefined(t)||_.isString(t)&&_.isUndefined(this.TYPES[t.toUpperCase()])||_.isObject(t)&&(_.isUndefined(t.title)||_.isUndefined(t.className)))throw"Alert modal requires a valid type and a message!";_.isString(t)?n=_.extend(this.TYPES[t.toUpperCase()],{message:e}):n=_.extend(t,{message:e}),this.$el.empty(),this.$el.append(this.alertTemplate(n)),this.delegateEvents(),this.$el.modal({show:!0,backdrop:!1,keyboard:!1})},hide:function(){this.$el.modal("hide")}});return s}),define("text!templates/delete-modal.tmpl",[],function(){return'<div class="modal" id="modal-delete">\n	  <div class="modal-header">\n	    <h3>Delete</h3>\n	  </div>\n	  <div class="modal-body">\n	  </div>\n	  <div class="modal-footer">\n            <a href="#" class="btn" data-dismiss="modal">Cancel</a>\n	    <a id="confirm-delete" href="#" class="btn btn-primary">Delete</a>\n	  </div>\n</div>'}),define("text!templates/delete-warning-content.tmpl",[],function(){return"Do really want to delete the {{type}} <i>{{content}}</i>?"}),define("annotations-tool",["jquery","backbone","views/main","views/alert","text!templates/delete-modal.tmpl","text!templates/delete-warning-content.tmpl","prototypes/player_adapter","handlebars"],function(e,t,n,r,i,s,o,u){"use strict";return window.annotationsTool={EVENTS:{ANNOTATION_SELECTION:"at:annotation-selection",READY:"at:ready"},views:{},deleteModalTmpl:u.compile(i),deleteContentTmpl:u.compile(s),deleteOperation:{start:function(t,n,r){var i=function(){n.destroy(t,r),this.deleteModal.modal("toggle")},s=function(e){e.keyCode===13&&i()};s=_.bind(s,this),i=_.bind(i,this),this.deleteModalHeader.text("Delete "+n.name),this.deleteModalContent.html(this.deleteContentTmpl({type:n.name,content:n.getContent(t)})),this.deleteModal.find("#confirm-delete").one("click",i),e(window).bind("keypress",s),this.deleteModal.one("hide",function(){e("#confirm-delete").unbind("click"),e(window).unbind("keypress",s)}),this.deleteModal.modal("show")}},alertModal:new r,start:function(r){_.bindAll(this,"updateSelectionOnTimeUpdate","setSelection","getSelection","hasSelection"),_.extend(this,r,_.clone(t.Events)),this.loadVideo&&this.loadVideo(),this.deleteOperation.start=_.bind(this.deleteOperation.start,this),this.initDeleteModal(),e(this.playerAdapter).bind(o.EVENTS.TIMEUPDATE,this.updateSelectionOnTimeUpdate),this.views.main=new n(this.playerAdapter)},alertError:function(e){this.alertModal.show(e,this.alertModal.TYPES.ERROR)},alertWarning:function(e){this.alertModal.show(e,this.alertModal.TYPES.WARNING)},alertInfo:function(e){this.alertModal.show(e,this.alertModal.TYPES.INFO)},initDeleteModal:function(){e("#dialogs").append(this.deleteModalTmpl({type:"annotation"})),this.deleteModal=e("#modal-delete").modal({show:!0,backdrop:!1,keyboard:!0}),this.deleteModal.modal("toggle"),this.deleteModalHeader=this.deleteModal.find(".modal-header h3"),this.deleteModalContent=this.deleteModal.find(".modal-body")},getWellFormatedTime:function(e){var t=function(e){return(e<10?"0":"")+e},n=Math.round(e),r=n%60,i=(n-r)/60%60,s=(n-r-i*60)/3600;return t(s)+":"+t(i)+":"+t(r)},isBrowserSafari6:function(){return navigator.appVersion.search("Version/6")>0&&navigator.appVersion.search("Safari")>0},isBrowserIE9:function(){return navigator.appVersion.search("MSIE 9")>0},setSelection:function(e,t,n){this.currentSelection=e,this.isManualSelected=n,_.isArray(e)&&e.length>0&&t?(this.playerAdapter.setCurrentTime(e[0].get("start")),typeof n=="undefined"&&(this.isManualSelected=!0)):typeof n=="undefined"&&(this.isManualSelected=!1),this.trigger(this.EVENTS.ANNOTATION_SELECTION,this.currentSelection)},getSelection:function(){return this.currentSelection},hasSelection:function(){return typeof this.currentSelection!="undefined"&&_.isArray(this.currentSelection)&&this.currentSelection.length>0},updateSelectionOnTimeUpdate:function(){var e=this.playerAdapter.getCurrentTime(),t=[],n=[],r,i,s;if(typeof this.video=="undefined"||this.isManualSelected)return;this.video.get("tracks").each(function(e){n=n.concat(e.get("annotations").models)},this),_.each(n,function(n){r=n.get("start"),i=n.get("duration"),s=r+i,_.isNumber(i)&&r<=e&&s>=e&&t.push(n)},this),this.setSelection(t,!1)},deleteAnnotation:function(e,t){var n;typeof t=="undefined"&&annotationsTool.video.get("tracks").each(function(n){n.get("annotations").get(e)&&(t=n.get("id"))}),n=annotationsTool.video.getAnnotation(e,t),n?this.deleteOperation.start(n,this.deleteOperation.targetTypes.ANNOTATION):console.warn("Not able to find annotation %i on track %i",e,t)}},annotationsTool.deleteOperation.targetTypes={ANNOTATION:{name:"annotation",getContent:function(e){return e.get("text")},destroy:function(e,t){e.destroy({success:function(){annotationsTool.localStorage&&(annotationsTool.video.get("tracks").each(function(t){if(t.get("annotations").get(e.id))return t.get("annotations").remove(e),t.save({wait:!0}),!1}),annotationsTool.video.save()),t&&t()},error:function(e){console.warn("Cannot delete annotation: "+e)}})}},LABEL:{name:"label",getContent:function(e){return e.get("value")},destroy:function(e,t){e.destroy({success:function(){annotationsTool.localStorage&&(e.collection&&e.collection.remove(e),annotationsTool.video.save()),t&&t()},error:function(e){console.warn("Cannot delete label: "+e)}})}},TRACK:{name:"track",getContent:function(e){return e.get("name")},destroy:function(e,t){var n=e.get("annotations"),r=function(){var e;if(n.length===0)return;e=n.at(0),e.destroy({error:function(){throw"Cannot delete annotation!"},success:function(){n.remove(e),r()}})};r(),e.destroy({success:function(){annotationsTool.localStorage&&annotationsTool.video.save(),t&&t()},error:function(e){console.warn("Cannot delete track: "+e)}})}},CATEGORY:{name:"category",getContent:function(e){return e.get("name")},destroy:function(e,t){var n=e.get("labels"),r=function(){var e;if(n.length===0)return;e=n.at(0),e.destroy({error:function(){throw"Cannot delete label!"},success:function(){n.remove(e),r()}})};r(),e.destroy({success:function(){annotationsTool.localStorage&&annotationsTool.video.save(),t&&t()},error:function(e){console.warn("Cannot delete category: "+e)}})}},SCALEVALUE:{name:"scale value",getContent:function(e){return e.get("name")},destroy:function(e,t){e.destroy({success:function(){window.annotationsTool.localStorage&&(e.collection&&e.collection.remove(e),annotationsTool.video.save()),t&&t()},error:function(e){console.warn("Cannot delete scale value: "+e)}})}},SCALE:{name:"scale",getContent:function(e){return e.get("name")},destroy:function(e,t){var n=e.get("scaleValues"),r=function(){var e;if(n.length===0)return;e=n.at(0),e.destroy({error:function(){throw"Cannot delete scaleValue!"},success:function(){n.remove(e),r()}})};r(),e.destroy({success:function(){window.annotationsTool.localStorage&&annotationsTool.video.save(),t&&t()},error:function(e){console.warn("Cannot delete scale: "+e)}})}}},annotationsTool}),require(["domReady","annotations-tool-configuration","annotations-tool"],function(e,t,n){e(function(){n.start(t)})}),define("main",function(){});